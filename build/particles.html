<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>LSCP App â€“ Particles</title>
	</head>
	<body>

		<div id="particles">
		</div>

		<!-- LIBS -->
		<script type="text/javascript" src="js/libs/jquery-1.9.1.min.js"></script>
        <script type="text/javascript" src="js/libs/libs.js"></script>

        <script type="text/javascript">
        var config = {number_particles: 100};

        var layer = new collie.Layer({
            width: 600,
            height: 600
        });

        var pool = new collie.Pool(config.number_particles*100, {
            backgroundImage : 'star',
            x: 'center',
            y: 'center',
            zIndex: 1
        });

        collie.ImageManager.addImages({
            star: "img/star.png",
            slot: "img/slot-bg.png",
            'slot-correct': "img/slot-correct-bg.png"
        });

        collie.Renderer.addLayer(layer);
        collie.Renderer.load(document.getElementById("particles"));
        collie.Renderer.start();

        var slot = new collie.DisplayObject({
            backgroundImage: 'slot',
            x: 'center',
            y: 'center',
            height: 300,
            width: 300,
            zIndex: 10
        }).addTo(layer);

        var x = slot.get('x'),
            y = slot.get('y'),
            width = slot.get('width'),
            height = slot.get('height');

        var options = [ // top, right, bottom, left
            {velocityY: [-80, -150], velocityX: [-80, 80], x: [x, x+width], y: y},
            {velocityX: [80, 150], velocityY: [-80, 80], x: x+width-20, y: [y, y+height]},
            {velocityY: [80, 150], velocityX: [-80, 80], x: [x, x+width], y: y+height-20},
            {velocityX: [-80, -150], velocityY: [-80, 80], x: x, y: [y, y+height]}
        ];


        slot.attach('click', function(){
            if (oTimer.isPlaying()) {
                oTimer.stop();
                slot.set('backgroundImage', 'slot');
            } else {
                oTimer.start();
                slot.set('backgroundImage', 'slot-correct');
            }
        });

        var oTimer = collie.Timer.cycle(function addParticleToLayer(e) {
            var particle = pool.get().addTo(layer);
            var op = options[e.frame % 4];
            for (var o in op) {
                if (typeof op[o] == 'object') {
                    particle.set(o, LSCP.randomFromInterval(op[o][0], op[o][1]));
                } else {
                    particle.set(o, op[o]);
                }
            }
            particle.set('velocityRotate', LSCP.randomFromInterval(10, 360));
            collie.Timer.transition(particle, 1000, {
                from: 1,
                to: 0,
                set: "opacity",
                onComplete: function(){
                    layer.removeChild(particle);
//                    pool.release(particle);
                }
            });
        }, 200, {
            useAutoStart: false,
            from: 0,
            to: config.number_particles,
            loop: 10,
            onComplete : function () {
                log('COMPLETE!');
            }
        });

        </script>

	</body>
</html>