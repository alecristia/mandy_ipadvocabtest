(function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?(this._wrapped=a,void 0):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.5.2";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=x.keys(a),e=0,f=g.length;f>e;e++)if(b.call(d,a[g[e]],g[e],a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?void 0:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d},x.sample=function(a,b,c){return arguments.length<2||c?a[x.random(a.length-1)]:x.shuffle(a).slice(0,Math.max(0,b))};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var C=function(a){return function(b,c,d){var e={},f=null==c?x.identity:B(c);return y(b,function(c,g){var h=f.call(d,c,g,b);a(e,h,c)}),e}};x.groupBy=C(function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)}),x.indexBy=C(function(a,b,c){a[b]=c}),x.countBy=C(function(a,b){x.has(a,b)?a[b]++:a[b]=1}),x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:new Date,g=null,f=a.apply(d,e)};return function(){var j=new Date;h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e,f,g,h;return function(){f=this,e=arguments,g=new Date;var i=function(){var j=new Date-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e)))},j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e)),h}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},x.pairs=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},x.invert=function(a){for(var b={},c=x.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h))return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),function(){{var a,b=this,c=b.Backbone,d=[],e=(d.push,d.slice);d.splice}a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="1.1.0";var f=b._;f||"undefined"==typeof require||(f=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender||b.$,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var g=a.Events={on:function(a,b,c){if(!i(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!i(this,"once",a,[b,c])||!b)return this;var d=this,e=f.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,g,h,j,k,l,m;if(!this._events||!i(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(h=a?[a]:f.keys(this._events),j=0,k=h.length;k>j;j++)if(a=h[j],g=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=g.length;m>l;l++)e=g[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=e.call(arguments,1);if(!i(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&j(c,b),d&&j(d,arguments),this},stopListening:function(a,b,c){var d=this._listeningTo;if(!d)return this;var e=!b&&!c;c||"object"!=typeof b||(c=this),a&&((d={})[a._listenId]=a);for(var g in d)a=d[g],a.off(b,c,this),(e||f.isEmpty(a._events))&&delete this._listeningTo[g];return this}},h=/\s+/,i=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(h.test(c)){for(var f=c.split(h),g=0,i=f.length;i>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},j=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},k={listenTo:"on",listenToOnce:"once"};f.each(k,function(a,b){g[b]=function(b,c,d){var e=this._listeningTo||(this._listeningTo={}),g=b._listenId||(b._listenId=f.uniqueId("l"));return e[g]=b,d||"object"!=typeof c||(d=this),b[a](c,d,this),this}}),g.bind=g.on,g.unbind=g.off,f.extend(a,g);var l=a.Model=function(a,b){var c=a||{};b||(b={}),this.cid=f.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(c=this.parse(c,b)||{}),c=f.defaults({},c,f.result(this,"defaults")),this.set(c,b),this.changed={},this.initialize.apply(this,arguments)};f.extend(l.prototype,g,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return f.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return f.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;g=c.unset,i=c.silent,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=f.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],f.isEqual(l[d],b)||h.push(d),f.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,g?delete l[d]:l[d]=b;if(!i){h.length&&(this._pending=!0);for(var m=0,n=h.length;n>m;m++)this.trigger("change:"+h[m],this,l[h[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,f.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,f.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!f.isEmpty(this.changed):f.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)f.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return f.clone(this._previousAttributes)},fetch:function(a){a=a?f.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),b.trigger("sync",b,d,a),void 0):!1},K(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,g,h=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,c=f.extend({validate:!0},c),d&&!c.wait){if(!this.set(d,c))return!1}else if(!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=f.extend({},h,d)),void 0===c.parse&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=h;var b=i.parse(a,c);return c.wait&&(b=f.extend(d||{},b)),f.isObject(b)&&!i.set(b,c)?!1:(j&&j(i,a,c),i.trigger("sync",i,a,c),void 0)},K(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),g=this.sync(e,this,c),d&&c.wait&&(this.attributes=h),g},destroy:function(a){a=a?f.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;K(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=f.result(this,"urlRoot")||f.result(this.collection,"url")||J();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},f.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=f.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,f.extend(b,{validationError:c})),!1):!0}});var m=["keys","values","pairs","invert","pick","omit"];f.each(m,function(a){l.prototype[a]=function(){var b=e.call(arguments);return b.unshift(this.attributes),f[a].apply(f,b)}});var n=a.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,f.extend({silent:!0},b))},o={add:!0,remove:!0,merge:!0},p={add:!0,remove:!1};f.extend(n.prototype,g,{model:l,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return a.sync.apply(this,arguments)},add:function(a,b){return this.set(a,f.extend({merge:!1},b,p))},remove:function(a,b){var c=!f.isArray(a);a=c?[a]:f.clone(a),b||(b={});var d,e,g,h;for(d=0,e=a.length;e>d;d++)h=a[d]=this.get(a[d]),h&&(delete this._byId[h.id],delete this._byId[h.cid],g=this.indexOf(h),this.models.splice(g,1),this.length--,b.silent||(b.index=g,h.trigger("remove",h,this,b)),this._removeReference(h));return c?a[0]:a},set:function(a,b){b=f.defaults({},b,o),b.parse&&(a=this.parse(a,b));var c=!f.isArray(a);a=c?a?[a]:[]:f.clone(a);var d,e,g,h,i,j,k,m=b.at,n=this.model,p=this.comparator&&null==m&&b.sort!==!1,q=f.isString(this.comparator)?this.comparator:null,r=[],s=[],t={},u=b.add,v=b.merge,w=b.remove,x=!p&&u&&w?[]:!1;for(d=0,e=a.length;e>d;d++){if(i=a[d],g=i instanceof l?h=i:i[n.prototype.idAttribute],j=this.get(g))w&&(t[j.cid]=!0),v&&(i=i===h?h.attributes:i,b.parse&&(i=j.parse(i,b)),j.set(i,b),p&&!k&&j.hasChanged(q)&&(k=!0)),a[d]=j;else if(u){if(h=a[d]=this._prepareModel(i,b),!h)continue;r.push(h),h.on("all",this._onModelEvent,this),this._byId[h.cid]=h,null!=h.id&&(this._byId[h.id]=h)}x&&x.push(j||h)}if(w){for(d=0,e=this.length;e>d;++d)t[(h=this.models[d]).cid]||s.push(h);s.length&&this.remove(s,b)}if(r.length||x&&x.length)if(p&&(k=!0),this.length+=r.length,null!=m)for(d=0,e=r.length;e>d;d++)this.models.splice(m+d,0,r[d]);else{x&&(this.models.length=0);var y=x||r;for(d=0,e=y.length;e>d;d++)this.models.push(y[d])}if(k&&this.sort({silent:!0}),!b.silent){for(d=0,e=r.length;e>d;d++)(h=r[d]).trigger("add",h,this,b);(k||x&&x.length)&&this.trigger("sort",this,b)}return c?a[0]:a},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),a=this.add(a,f.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,f.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,f.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return e.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a.id]||this._byId[a.cid]||this._byId[a]},at:function(a){return this.models[a]},where:function(a,b){return f.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),f.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(f.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return f.invoke(this.models,"get",a)},fetch:function(a){a=a?f.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},K(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?f.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(a,b,e){e.wait&&c.add(a,e),d&&d(a,b,e)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof l)return a.collection||(a.collection=this),a;b=b?f.clone(b):{},b.collection=this;var c=new this.model(a,b);return c.validationError?(this.trigger("invalid",this,c.validationError,b),!1):c},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var q=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];f.each(q,function(a){n.prototype[a]=function(){var b=e.call(arguments);return b.unshift(this.models),f[a].apply(f,b)}});var r=["groupBy","countBy","sortBy"];f.each(r,function(a){n.prototype[a]=function(b,c){var d=f.isFunction(b)?b:function(a){return a.get(b)};return f[a](this.models,d,c)}});var s=a.View=function(a){this.cid=f.uniqueId("view"),a||(a={}),f.extend(this,f.pick(a,u)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},t=/^(\S+)\s*(.*)$/,u=["model","collection","el","id","attributes","className","tagName","events"];f.extend(s.prototype,g,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=f.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(f.isFunction(c)||(c=this[a[b]]),c){var d=b.match(t),e=d[1],g=d[2];c=f.bind(c,this),e+=".delegateEvents"+this.cid,""===g?this.$el.on(e,c):this.$el.on(e,g,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(f.result(this,"el"),!1);else{var b=f.extend({},f.result(this,"attributes"));this.id&&(b.id=f.result(this,"id")),this.className&&(b["class"]=f.result(this,"className"));var c=a.$("<"+f.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}}),a.sync=function(b,c,d){var e=w[b];f.defaults(d||(d={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var g={type:e,dataType:"json"};if(d.url||(g.url=f.result(c,"url")||J()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(g.contentType="application/json",g.data=JSON.stringify(d.attrs||c.toJSON(d))),d.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){g.type="POST",d.emulateJSON&&(g.data._method=e);var h=d.beforeSend;d.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),h?h.apply(this,arguments):void 0}}"GET"===g.type||d.emulateJSON||(g.processData=!1),"PATCH"===g.type&&v&&(g.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=d.xhr=a.ajax(f.extend(g,d));return c.trigger("request",c,i,d),i};var v=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),w={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var x=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},y=/\((.*?)\)/g,z=/(\(\?)?:\w+/g,A=/\*\w+/g,B=/[\-{}\[\]+?.,\\\^$|#\s]/g;f.extend(x.prototype,g,{initialize:function(){},route:function(b,c,d){f.isRegExp(b)||(b=this._routeToRegExp(b)),f.isFunction(c)&&(d=c,c=""),d||(d=this[c]);var e=this;return a.history.route(b,function(f){var g=e._extractParameters(b,f);d&&d.apply(e,g),e.trigger.apply(e,["route:"+c].concat(g)),e.trigger("route",c,g),a.history.trigger("route",e,c,g)}),this},navigate:function(b,c){return a.history.navigate(b,c),this},_bindRoutes:function(){if(this.routes){this.routes=f.result(this,"routes");for(var a,b=f.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(B,"\\$&").replace(y,"(?:$1)?").replace(z,function(a,b){return b?a:"([^/]+)"}).replace(A,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return f.map(c,function(a){return a?decodeURIComponent(a):null})}});var C=a.History=function(){this.handlers=[],f.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},D=/^[#\/]|\s+$/g,E=/^\/+|\/+$/g,F=/msie [\w.]+/,G=/\/$/,H=/[?#].*$/;C.started=!1,f.extend(C.prototype,g,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(G,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(D,"")},start:function(b){if(C.started)throw new Error("Backbone.history has already been started");C.started=!0,this.options=f.extend({root:"/"},this.options,b),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var c=this.getFragment(),d=document.documentMode,e=F.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(E,"/"),e&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(c)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=c;var g=this.location,h=g.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!h)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&h&&g.hash&&(this.fragment=this.getHash().replace(D,""),this.history.replaceState({},document.title,this.root+this.fragment+g.search))}return this.options.silent?void 0:this.loadUrl()},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),C.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a===this.fragment?!1:(this.iframe&&this.navigate(a),this.loadUrl(),void 0)},loadUrl:function(a){return a=this.fragment=this.getFragment(a),f.any(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})},navigate:function(a,b){if(!C.started)return!1;b&&b!==!0||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=a.replace(H,""),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);
this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),a.history=new C;var I=function(a,b){var c,d=this;c=a&&f.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},f.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&f.extend(c.prototype,a),c.__super__=d.prototype,c};l.extend=n.extend=x.extend=s.extend=C.extend=I;var J=function(){throw new Error('A "url" property or function must be specified')},K=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this);var addToHome=function(a){function b(){if(y){var b,d=Date.now();if(a.addToHomeConfig)for(b in a.addToHomeConfig)C[b]=a.addToHomeConfig[b];C.autostart||(C.hookOnLoad=!1),l=/ipad/gi.test(x.platform),m=a.devicePixelRatio&&a.devicePixelRatio>1,n=/Safari/i.test(x.appVersion)&&!/CriOS/i.test(x.appVersion),o=x.standalone,p=x.appVersion.match(/OS (\d+_\d+)/i),p=p&&p[1]?+p[1].replace("_","."):0,B=+a.localStorage.getItem("addToHome"),r=a.sessionStorage.getItem("addToHomeSession"),s=C.returningVisitor?B&&B+24192e5>d:!0,B||(B=d),q=s&&d>=B,C.hookOnLoad?a.addEventListener("load",c,!1):!C.hookOnLoad&&C.autostart&&c()}}function c(){if(a.removeEventListener("load",c,!1),s?C.expire&&q&&a.localStorage.setItem("addToHome",Date.now()+6e4*C.expire):a.localStorage.setItem("addToHome",Date.now()),u||n&&q&&!r&&!o&&s){var b="",e=x.platform.split(" ")[0],f=x.language.replace("-","_");t=document.createElement("div"),t.id="addToHomeScreen",t.style.cssText+="left:-9999px;-webkit-transition-property:-webkit-transform,opacity;-webkit-transition-duration:0;-webkit-transform:translate3d(0,0,0);position:"+(5>p?"absolute":"fixed"),C.message in D&&(f=C.message,C.message=""),""===C.message&&(C.message=f in D?D[f]:D.en_us),C.touchIcon&&(b=m?document.querySelector('head link[rel^=apple-touch-icon][sizes="114x114"],head link[rel^=apple-touch-icon][sizes="144x144"],head link[rel^=apple-touch-icon]'):document.querySelector('head link[rel^=apple-touch-icon][sizes="57x57"],head link[rel^=apple-touch-icon]'),b&&(b='<span style="background-image:url('+b.href+')" class="addToHomeTouchIcon"></span>')),t.className=(p>=7?"addToHomeIOS7 ":"")+(l?"addToHomeIpad":"addToHomeIphone")+(b?" addToHomeWide":""),t.innerHTML=b+C.message.replace("%device",e).replace("%icon",p>=4.2?'<span class="addToHomeShare"></span>':'<span class="addToHomePlus">+</span>')+(C.arrow?'<span class="addToHomeArrow"'+(p>=7&&l&&b?' style="margin-left:-32px"':"")+"></span>":"")+(C.closeButton?'<span class="addToHomeClose">×</span>':""),document.body.appendChild(t),C.closeButton&&t.addEventListener("click",g,!1),!l&&p>=6&&window.addEventListener("orientationchange",k,!1),setTimeout(d,C.startDelay)}}function d(){var b,c=208;if(l)switch(5>p?(A=a.scrollY,z=a.scrollX):6>p?c=160:p>=7&&(c=143),t.style.top=A+C.bottomOffset+"px",t.style.left=Math.max(z+c-Math.round(t.offsetWidth/2),9)+"px",C.animationIn){case"drop":b="0.6s",t.style.webkitTransform="translate3d(0,"+-(a.scrollY+C.bottomOffset+t.offsetHeight)+"px,0)";break;case"bubble":b="0.6s",t.style.opacity="0",t.style.webkitTransform="translate3d(0,"+(A+50)+"px,0)";break;default:b="1s",t.style.opacity="0"}else switch(A=a.innerHeight+a.scrollY,5>p?(z=Math.round((a.innerWidth-t.offsetWidth)/2)+a.scrollX,t.style.left=z+"px",t.style.top=A-t.offsetHeight-C.bottomOffset+"px"):(t.style.left="50%",t.style.marginLeft=-Math.round(t.offsetWidth/2)-(a.orientation%180&&p>=6&&7>p?40:0)+"px",t.style.bottom=C.bottomOffset+"px"),C.animationIn){case"drop":b="1s",t.style.webkitTransform="translate3d(0,"+-(A+C.bottomOffset)+"px,0)";break;case"bubble":b="0.6s",t.style.webkitTransform="translate3d(0,"+(t.offsetHeight+C.bottomOffset+50)+"px,0)";break;default:b="1s",t.style.opacity="0"}t.offsetHeight,t.style.webkitTransitionDuration=b,t.style.opacity="1",t.style.webkitTransform="translate3d(0,0,0)",t.addEventListener("webkitTransitionEnd",h,!1),w=setTimeout(f,C.lifespan)}function e(a){y&&!t&&(u=a,c())}function f(){if(clearInterval(v),clearTimeout(w),w=null,t){var b=0,c=0,d="1",e="0";switch(C.closeButton&&t.removeEventListener("click",g,!1),!l&&p>=6&&window.removeEventListener("orientationchange",k,!1),5>p&&(b=l?a.scrollY-A:a.scrollY+a.innerHeight-A,c=l?a.scrollX-z:a.scrollX+Math.round((a.innerWidth-t.offsetWidth)/2)-z),t.style.webkitTransitionProperty="-webkit-transform,opacity",C.animationOut){case"drop":l?(e="0.4s",d="0",b+=50):(e="0.6s",b+=t.offsetHeight+C.bottomOffset+50);break;case"bubble":l?(e="0.8s",b-=t.offsetHeight+C.bottomOffset+50):(e="0.4s",d="0",b-=50);break;default:e="0.8s",d="0"}t.addEventListener("webkitTransitionEnd",h,!1),t.style.opacity=d,t.style.webkitTransitionDuration=e,t.style.webkitTransform="translate3d("+c+"px,"+b+"px,0)"}}function g(){a.sessionStorage.setItem("addToHomeSession","1"),r=!0,f()}function h(){return t.removeEventListener("webkitTransitionEnd",h,!1),t.style.webkitTransitionProperty="-webkit-transform",t.style.webkitTransitionDuration="0.2s",w?(5>p&&w&&(v=setInterval(i,C.iterations)),void 0):(t.parentNode.removeChild(t),t=null,void 0)}function i(){var b=new WebKitCSSMatrix(a.getComputedStyle(t,null).webkitTransform),c=l?a.scrollY-A:a.scrollY+a.innerHeight-A,d=l?a.scrollX-z:a.scrollX+Math.round((a.innerWidth-t.offsetWidth)/2)-z;(c!=b.m42||d!=b.m41)&&(t.style.webkitTransform="translate3d("+d+"px,"+c+"px,0)")}function j(){a.localStorage.removeItem("addToHome"),a.sessionStorage.removeItem("addToHomeSession")}function k(){t.style.marginLeft=-Math.round(t.offsetWidth/2)-(a.orientation%180&&p>=6&&7>p?40:0)+"px"}var l,m,n,o,p,q,r,s,t,u,v,w,x=a.navigator,y="platform"in x&&/iphone|ipod|ipad/gi.test(x.platform),z=0,A=0,B=0,C={autostart:!0,returningVisitor:!1,animationIn:"drop",animationOut:"fade",startDelay:2e3,lifespan:15e3,bottomOffset:14,expire:0,message:"",touchIcon:!1,arrow:!0,hookOnLoad:!0,closeButton:!0,iterations:100},D={ar:'<span dir="rtl">قم بتثبيت هذا التطبيق على <span dir="ltr">%device:</span>انقر<span dir="ltr">%icon</span> ،<strong>ثم اضفه الى الشاشة الرئيسية.</strong></span>',ca_es:"Per instal·lar aquesta aplicació al vostre %device premeu %icon i llavors <strong>Afegir a pantalla d'inici</strong>.",cs_cz:"Pro instalaci aplikace na Váš %device, stiskněte %icon a v nabídce <strong>Přidat na plochu</strong>.",da_dk:"Tilføj denne side til din %device: tryk på %icon og derefter <strong>Føj til hjemmeskærm</strong>.",de_de:"Installieren Sie diese App auf Ihrem %device: %icon antippen und dann <strong>Zum Home-Bildschirm</strong>.",el_gr:"Εγκαταστήσετε αυτήν την Εφαρμογή στήν συσκευή σας %device: %icon μετά πατάτε <strong>Προσθήκη σε Αφετηρία</strong>.",en_us:"Install this web app on your %device: tap %icon and then <strong>Add to Home Screen</strong>.",es_es:"Para instalar esta app en su %device, pulse %icon y seleccione <strong>Añadir a pantalla de inicio</strong>.",fi_fi:"Asenna tämä web-sovellus laitteeseesi %device: paina %icon ja sen jälkeen valitse <strong>Lisää Koti-valikkoon</strong>.",fr_fr:"Ajoutez cette application sur votre %device en cliquant sur %icon, puis <strong>Ajouter à l'écran d'accueil</strong>.",he_il:'<span dir="rtl">התקן אפליקציה זו על ה-%device שלך: הקש %icon ואז <strong>הוסף למסך הבית</strong>.</span>',hr_hr:"Instaliraj ovu aplikaciju na svoj %device: klikni na %icon i odaberi <strong>Dodaj u početni zaslon</strong>.",hu_hu:"Telepítse ezt a web-alkalmazást az Ön %device-jára: nyomjon a %icon-ra majd a <strong>Főképernyőhöz adás</strong> gombra.",it_it:"Installa questa applicazione sul tuo %device: premi su %icon e poi <strong>Aggiungi a Home</strong>.",ja_jp:"このウェブアプリをあなたの%deviceにインストールするには%iconをタップして<strong>ホーム画面に追加</strong>を選んでください。",ko_kr:'%device에 웹앱을 설치하려면 %icon을 터치 후 "홈화면에 추가"를 선택하세요',nb_no:"Installer denne appen på din %device: trykk på %icon og deretter <strong>Legg til på Hjem-skjerm</strong>",nl_nl:"Installeer deze webapp op uw %device: tik %icon en dan <strong>Voeg toe aan beginscherm</strong>.",pl_pl:"Aby zainstalować tę aplikacje na %device: naciśnij %icon a następnie <strong>Dodaj jako ikonę</strong>.",pt_br:"Instale este aplicativo em seu %device: aperte %icon e selecione <strong>Adicionar à Tela Inicio</strong>.",pt_pt:"Para instalar esta aplicação no seu %device, prima o %icon e depois em <strong>Adicionar ao ecrã principal</strong>.",ru_ru:"Установите это веб-приложение на ваш %device: нажмите %icon, затем <strong>Добавить в «Домой»</strong>.",sv_se:"Lägg till denna webbapplikation på din %device: tryck på %icon och därefter <strong>Lägg till på hemskärmen</strong>.",th_th:"ติดตั้งเว็บแอพฯ นี้บน %device ของคุณ: แตะ %icon และ <strong>เพิ่มที่หน้าจอโฮม</strong>",tr_tr:"Bu uygulamayı %device'a eklemek için %icon simgesine sonrasında <strong>Ana Ekrana Ekle</strong> düğmesine basın.",uk_ua:"Встановіть цей веб сайт на Ваш %device: натисніть %icon, а потім <strong>На початковий екран</strong>.",zh_cn:"您可以将此应用程式安装到您的 %device 上。请按 %icon 然后点选<strong>添加至主屏幕</strong>。",zh_tw:"您可以將此應用程式安裝到您的 %device 上。請按 %icon 然後點選<strong>加入主畫面螢幕</strong>。"};return b(),{show:e,close:f,reset:j}}(window);(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m=this;"undefined"!=typeof exports?(a=require("underscore"),b=require("backbone"),"undefined"!=typeof module&&module.exports&&(module.exports=b),exports=b):(a=m._,b=m.Backbone),c=b.Model,d=b.Collection,e=c.prototype,f=d.prototype,g=["change","add","remove","reset","sort","destroy"],j=["reset","sort"],b.Associations={VERSION:"0.5.4"};var n=function(){return l},o=function(b){(!a.isString(b)||a.size(b)<1)&&(b="."),l=b,i=new RegExp("[\\"+l+"\\[\\]]+","g"),k=new RegExp("[^\\"+l+"\\[\\]]+","g")};try{Object.defineProperty(b.Associations,"SEPARATOR",{enumerable:!0,get:n,set:o})}catch(p){}b.Associations.Many=b.Many="Many",b.Associations.One=b.One="One",b.Associations.Self=b.Self="Self",b.Associations.SEPARATOR=".",b.Associations.getSeparator=n,b.Associations.setSeparator=o,o(),h=b.AssociatedModel=b.Associations.AssociatedModel=c.extend({relations:void 0,_proxyCalls:void 0,get:function(a){var b=e.get.call(this,a);return b?b:this._getAttr.apply(this,arguments)},set:function(b,c,d){var e,f;return a.isObject(b)||null==b?(e=b,d=c):(e={},e[b]=c),f=this._set(e,d),this._processPendingEvents(),f},_set:function(b,c){var d,e,f,g,j=this;if(!b)return this;for(d in b)if(e||(e={}),d.match(i)){var k=q(d),l=a.initial(k),m=k[k.length-1],n=this.get(l);n instanceof h&&(g=e[n.cid]||(e[n.cid]={model:n,data:{}}),g.data[m]=b[d])}else g=e[this.cid]||(e[this.cid]={model:this,data:{}}),g.data[d]=b[d];if(e)for(f in e)g=e[f],this._setAttr.call(g.model,g.data,c)||(j=!1);else j=this._setAttr.call(this,b,c);return j},_setAttr:function(f,g){var i;if(g||(g={}),g.unset)for(i in f)f[i]=void 0;return this.parents=this.parents||[],this.relations&&a.each(this.relations,function(e){var i,j,k,l,m=e.key,n=e.relatedModel,o=e.collectionType,p=e.map,q=this.attributes[m],s=q&&q.idAttribute,t=!1;if(!n||n.prototype instanceof c||(n=a.isFunction(n)?n.call(this,e,f):n),n&&a.isString(n)&&(n=n===b.Self?this.constructor:r(n)),o&&a.isString(o)&&(o=r(o)),p&&a.isString(p)&&(p=r(p)),j=e.options?a.extend({},e.options,g):g,!n&&!o)throw new Error("specify either a relatedModel or collectionType");if(f[m]){if(i=a.result(f,m),i=p?p.call(this,i,o?o:n):i,e.type===b.Many){if(o&&!o.prototype instanceof d)throw new Error("collectionType must inherit from Backbone.Collection");q?(q._deferEvents=!0,q[j.reset?"reset":"set"](i instanceof d?i.models:i,j),k=q):(t=!0,i instanceof d?k=i:(k=o?new o:this._createCollection(n),k[j.reset?"reset":"set"](i,j)))}else{if(e.type!==b.One)throw new Error("type attribute must be specified and have the values Backbone.One or Backbone.Many");if(!n)throw new Error("specify a relatedModel for Backbone.One type");if(!(n.prototype instanceof b.AssociatedModel))throw new Error("specify an AssociatedModel for Backbone.One type");k=i instanceof h?i:new n(i,j),q&&k.attributes[s]&&q.attributes[s]===k.attributes[s]?(q._deferEvents=!0,q._set(i instanceof h?i.attributes:i,j),k=q):t=!0}f[m]=k,l=k,(t||l&&!l._proxyCallback)&&(l._proxyCallback=function(){return this._bubbleEvent.call(this,m,l,arguments)},l.on("all",l._proxyCallback,this))}if(f.hasOwnProperty(m)){var u=f[m],v=this.attributes[m];u?(u.parents=u.parents||[],-1==a.indexOf(u.parents,this)&&u.parents.push(this)):v&&v.parents.length>0&&(v.parents=a.difference(v.parents,[this]),v._proxyCallback&&v.off("all",v._proxyCallback,this))}},this),e.set.call(this,f,g)},_bubbleEvent:function(b,c,e){var f,i,k,m=e,n=m[0].split(":"),o=n[0],p="nested-change"==m[0],r=m[1],s=m[2],t=-1,u=c._proxyCalls,v=-1!==a.indexOf(g,o);if(!p){if(a.size(n)>1&&(i=n[1]),-1!==a.indexOf(j,o)&&(s=r),c instanceof d&&v&&r){var w,x=q(i),y=a.initial(x);w=c.find(function(a){if(r===a)return!0;if(!a)return!1;var b=a.get(y);return(b instanceof h||b instanceof d)&&r===b?!0:(b=a.get(x),(b instanceof h||b instanceof d)&&r===b?!0:b instanceof d&&s&&s===b?!0:void 0)}),w&&(t=c.indexOf(w))}if(i=b+(-1===t||"change"!==o&&!i?"":"["+t+"]")+(i?l+i:""),/\[\*\]/g.test(i))return this;if(k=i.replace(/\[\d+\]/g,"[*]"),f=[],f.push.apply(f,m),f[0]=o+":"+i,u=c._proxyCalls=u||{},this._isEventAvailable.call(this,u,i))return this;if(u[i]=!0,"change"===o&&(this._previousAttributes[b]=c._previousAttributes,this.changed[b]=c),this.trigger.apply(this,f),"change"===o&&this.get(i)!=m[2]){var z=["nested-change",i,m[1]];m[2]&&z.push(m[2]),this.trigger.apply(this,z)}return u&&i&&delete u[i],i!==k&&(f[0]=o+":"+k,this.trigger.apply(this,f)),this}},_isEventAvailable:function(b,c){return a.find(b,function(a,b){return-1!==c.indexOf(b,c.length-b.length)})},_createCollection:function(b){var c,e=b;if(a.isString(e)&&(e=r(e)),!(e&&e.prototype instanceof h||a.isFunction(e)))throw new Error("type must inherit from Backbone.AssociatedModel");return c=new d,c.model=e,c},_processPendingEvents:function(){this._processedEvents||(this._processedEvents=!0,this._deferEvents=!1,a.each(this._pendingEvents,function(a){a.c.trigger.apply(a.c,a.a)}),this._pendingEvents=[],a.each(this.relations,function(a){var b=this.attributes[a.key];b&&b._processPendingEvents()},this),delete this._processedEvents)},trigger:function(){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):e.trigger.apply(this,arguments)},toJSON:function(b){var c,d={};return d[this.idAttribute]=this.id,this.visited||(this.visited=!0,d=e.toJSON.apply(this,arguments),this.relations&&a.each(this.relations,function(e){var f=this.attributes[e.key];f&&(c=f.toJSON?f.toJSON(b):f,d[e.key]=a.isArray(c)?a.compact(c):c)},this),delete this.visited),d},clone:function(){return new this.constructor(this.toJSON())},cleanup:function(){a.each(this.relations,function(b){var c=this.attributes[b.key];c&&(c.parents=a.difference(c.parents,[this]))},this),this.off()},_getAttr:function(b){var c,e,f=this,g=q(b);if(!(a.size(g)<1)){for(e=0;e<g.length&&(c=g[e],f);e++)f=f instanceof d?isNaN(c)?void 0:f.at(c):f.attributes[c];return f}}});var q=function(b){return""===b?[""]:a.isString(b)?b.match(k):b||[]},r=function(b){return a.reduce(b.split(l),function(a,b){return a[b]},m)},s=function(b,c,d){var e,f;return a.find(b,function(b){return e=a.find(b.relations,function(a){return b.get(a.key)===c},this),e?(f=b,!0):void 0},this),e&&e.map?e.map.call(f,d,c):d},t={};a.each(["set","remove","reset"],function(a){t[a]=d.prototype[a],f[a]=function(b){return this.model.prototype instanceof h&&this.parents&&(arguments[0]=s(this.parents,this,b)),t[a].apply(this,arguments)}}),t.trigger=f.trigger,f.trigger=function(){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):t.trigger.apply(this,arguments)},f._processPendingEvents=h.prototype._processPendingEvents}).call(this),function(a){"use strict";"function"==typeof define&&define.amd?define(["underscore","backbone"],a):a(_,Backbone)}(function(a,b){"use strict";var c=function(b,c){return b&&b[c]?a.isFunction(b[c])?b[c]():b[c]:null},d=/^(\S+)\s*(.*)$/;return a.extend(b.View.prototype,{_touching:!1,touchPrevents:!0,touchThreshold:10,isTouch:"ontouchstart"in document&&!("callPhantom"in window),delegateEvents:function(b){if(b||(b=c(this,"events"))){this.undelegateEvents();var e=".delegateEvents"+this.cid;a(b).each(function(c,f){if(a.isFunction(c)||(c=this[b[f]]),!c)throw new Error('Method "'+b[f]+'" does not exist');var g=f.match(d),h=g[1],i=g[2],j=a.bind(this._touchHandler,this);c=a.bind(c,this),this._useTouchHandlers(h,i)?(this.$el.on("touchstart"+e,i,j),this.$el.on("touchend"+e,i,{method:c},j)):(h+=e,""===i?this.$el.bind(h,c):this.$el.on(h,i,c))},this)}},_useTouchHandlers:function(a){return this.isTouch&&"click"===a},_touchHandler:function(a){if("changedTouches"in a.originalEvent){var b=a.originalEvent.changedTouches[0],c=b.clientX,d=b.clientY;switch(a.type){case"touchstart":this._touching=[c,d];break;case"touchend":var e=this._touching[0],f=this._touching[1],g=this.touchThreshold;if(e+g>c&&c>e-g&&f+g>d&&d>f-g){if(this._touching=!1,this.touchPrevents){var h=a.currentTarget.tagName;("BUTTON"===h||"A"===h)&&(a.preventDefault(),a.stopPropagation())}a.data.method(a)}}}}}),b}),window.log=function(){log.history=log.history||[],log.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))};var Handlebars=function(){var a=function(){"use strict";function a(a){this.string=a}var b;return a.prototype.toString=function(){return""+this.string},b=a}(),b=function(a){"use strict";function b(a){return h[a]||"&amp;"}function c(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function d(a){return a instanceof g?a.toString():a||0===a?(a=""+a,j.test(a)?a.replace(i,b):a):""}function e(a){return a||0===a?m(a)&&0===a.length?!0:!1:!0}var f={},g=a,h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,j=/[&<>"'`]/;f.extend=c;var k=Object.prototype.toString;f.toString=k;var l=function(a){return"function"==typeof a};l(/x/)&&(l=function(a){return"function"==typeof a&&"[object Function]"===k.call(a)});var l;f.isFunction=l;var m=Array.isArray||function(a){return a&&"object"==typeof a?"[object Array]"===k.call(a):!1};return f.isArray=m,f.escapeExpression=d,f.isEmpty=e,f}(a),c=function(){"use strict";function a(){for(var a=Error.prototype.constructor.apply(this,arguments),b=0;b<c.length;b++)this[c[b]]=a[c[b]]}var b,c=["description","fileName","lineNumber","message","name","number","stack"];return a.prototype=new Error,b=a}(),d=function(a,b){"use strict";function c(a,b){this.helpers=a||{},this.partials=b||{},d(this)}function d(a){a.registerHelper("helperMissing",function(a){if(2===arguments.length)return void 0;throw new Error("Missing helper: '"+a+"'")}),a.registerHelper("blockHelperMissing",function(b,c){var d=c.inverse||function(){},e=c.fn;return m(b)&&(b=b.call(this)),b===!0?e(this):b===!1||null==b?d(this):l(b)?b.length>0?a.helpers.each(b,c):d(this):e(b)}),a.registerHelper("each",function(a,b){var c,d=b.fn,e=b.inverse,f=0,g="";if(m(a)&&(a=a.call(this)),b.data&&(c=q(b.data)),a&&"object"==typeof a)if(l(a))for(var h=a.length;h>f;f++)c&&(c.index=f,c.first=0===f,c.last=f===a.length-1),g+=d(a[f],{data:c});else for(var i in a)a.hasOwnProperty(i)&&(c&&(c.key=i),g+=d(a[i],{data:c}),f++);return 0===f&&(g=e(this)),g}),a.registerHelper("if",function(a,b){return m(a)&&(a=a.call(this)),!b.hash.includeZero&&!a||g.isEmpty(a)?b.inverse(this):b.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn,hash:c.hash})}),a.registerHelper("with",function(a,b){return m(a)&&(a=a.call(this)),g.isEmpty(a)?void 0:b.fn(a)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)})}function e(a,b){p.log(a,b)}var f={},g=a,h=b,i="1.1.2";f.VERSION=i;var j=4;f.COMPILER_REVISION=j;var k={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};f.REVISION_CHANGES=k;var l=g.isArray,m=g.isFunction,n=g.toString,o="[object Object]";f.HandlebarsEnvironment=c,c.prototype={constructor:c,logger:p,log:e,registerHelper:function(a,b,c){if(n.call(a)===o){if(c||b)throw new h("Arg not supported with multiple helpers");g.extend(this.helpers,a)}else c&&(b.not=c),this.helpers[a]=b},registerPartial:function(a,b){n.call(a)===o?g.extend(this.partials,a):this.partials[a]=b}};var p={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(a,b){if(p.level<=a){var c=p.methodMap[a];"undefined"!=typeof console&&console[c]&&console[c].call(console,b)}}};f.logger=p,f.log=e;var q=function(a){var b={};return g.extend(b,a),b};return f.createFrame=q,f}(b,c),e=function(a,b,c){"use strict";function d(a){var b=a&&a[0]||1,c=m;if(b!==c){if(c>b){var d=n[c],e=n[b];throw new Error("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+d+") or downgrade your runtime to an older version ("+e+").")}throw new Error("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+").")}}function e(a,b){if(!b)throw new Error("No environment passed to template");var c;c=b.compile?function(a,c,d,e,f,g){var i=h.apply(this,arguments);if(i)return i;var j={helpers:e,partials:f,data:g};return f[c]=b.compile(a,{data:void 0!==g},b),f[c](d,j)}:function(a,b){var c=h.apply(this,arguments);if(c)return c;throw new l("The partial "+b+" could not be compiled when running in runtime-only mode")};var e={escapeExpression:k.escapeExpression,invokePartial:c,programs:[],program:function(a,b,c){var d=this.programs[a];return c?d=g(a,b,c):d||(d=this.programs[a]=g(a,b)),d},merge:function(a,b){var c=a||b;return a&&b&&a!==b&&(c={},k.extend(c,b),k.extend(c,a)),c},programWithDepth:f,noop:i,compilerInfo:null};return function(c,f){f=f||{};var g,h,i=f.partial?f:b;f.partial||(g=f.helpers,h=f.partials);var j=a.call(e,i,c,g,h,f.data);return f.partial||d(e.compilerInfo),j}}function f(a,b,c){var d=Array.prototype.slice.call(arguments,3),e=function(a,e){return e=e||{},b.apply(this,[a,e.data||c].concat(d))};return e.program=a,e.depth=d.length,e}function g(a,b,c){var d=function(a,d){return d=d||{},b(a,d.data||c)};return d.program=a,d.depth=0,d}function h(a,b,c,d,e,f){var g={partial:!0,helpers:d,partials:e,data:f};if(void 0===a)throw new l("The partial "+b+" could not be found");return a instanceof Function?a(c,g):void 0}function i(){return""}var j={},k=a,l=b,m=c.COMPILER_REVISION,n=c.REVISION_CHANGES;return j.template=e,j.programWithDepth=f,j.program=g,j.invokePartial=h,j.noop=i,j}(b,c,d),f=function(a,b,c,d,e){"use strict";var f,g=a,h=b,i=c,j=d,k=e,l=function(){var a=new g.HandlebarsEnvironment;return j.extend(a,g),a.SafeString=h,a.Exception=i,a.Utils=j,a.VM=k,a.template=function(b){return k.template(b,a)},a},m=l();return m.create=l,f=m}(d,a,c,b,e),g=function(a){"use strict";function b(a,c,d){this.type="program",this.statements=a,this.strip={},d?(this.inverse=new b(d,c),this.strip.right=c.left):c&&(this.strip.left=c.right)}function c(a,b,c,d){this.type="mustache",this.hash=b,this.strip=d;var e=c[3]||c[2];this.escaped="{"!==e&&"&"!==e;var f=this.id=a[0],g=this.params=a.slice(1),h=this.eligibleHelper=f.isSimple;this.isHelper=h&&(g.length||b)}function d(a,b,c){this.type="partial",this.partialName=a,this.context=b,this.strip=c}function e(a,b,c,d){if(a.id.original!==d.path.original)throw new p(a.id.original+" doesn't match "+d.path.original);this.type="block",this.mustache=a,this.program=b,this.inverse=c,this.strip={left:a.strip.left,right:d.strip.right},(b||c).strip.left=a.strip.right,(c||b).strip.right=d.strip.left,c&&!b&&(this.isInverse=!0)}function f(a){this.type="content",this.string=a}function g(a){this.type="hash",this.pairs=a}function h(a){this.type="ID";for(var b="",c=[],d=0,e=0,f=a.length;f>e;e++){var g=a[e].part;if(b+=(a[e].separator||"")+g,".."===g||"."===g||"this"===g){if(c.length>0)throw new p("Invalid path: "+b);".."===g?d++:this.isScoped=!0}else c.push(g)}this.original=b,this.parts=c,this.string=c.join("."),this.depth=d,this.isSimple=1===a.length&&!this.isScoped&&0===d,this.stringModeValue=this.string}function i(a){this.type="PARTIAL_NAME",this.name=a.original}function j(a){this.type="DATA",this.id=a}function k(a){this.type="STRING",this.original=this.string=this.stringModeValue=a}function l(a){this.type="INTEGER",this.original=this.integer=a,this.stringModeValue=Number(a)}function m(a){this.type="BOOLEAN",this.bool=a,this.stringModeValue="true"===a}function n(a){this.type="comment",this.comment=a}var o={},p=a;return o.ProgramNode=b,o.MustacheNode=c,o.PartialNode=d,o.BlockNode=e,o.ContentNode=f,o.HashNode=g,o.IdNode=h,o.PartialNameNode=i,o.DataNode=j,o.StringNode=k,o.IntegerNode=l,o.BooleanNode=m,o.CommentNode=n,o}(c),h=function(){"use strict";var a,b=function(){function a(a,b){return{left:"~"===a[2],right:"~"===b[0]||"~"===b[1]}}function b(){this.yy={}}var c={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,program:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,partial_option0:27,inMustache_repetition0:28,inMustache_option0:29,dataName:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,hash:35,hash_repetition_plus0:36,hashSegment:37,ID:38,EQUALS:39,DATA:40,pathSegments:41,SEP:42,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",38:"ID",39:"EQUALS",40:"DATA",42:"SEP"},productions_:[0,[3,2],[3,1],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[35,1],[37,3],[26,1],[26,1],[26,1],[30,2],[21,1],[41,3],[41,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[36,1],[36,2]],performAction:function(b,c,d,e,f,g){var h=g.length-1;switch(f){case 1:return new e.ProgramNode(g[h-1]);case 2:return new e.ProgramNode([]);case 3:this.$=new e.ProgramNode([],g[h-1],g[h]);break;case 4:this.$=new e.ProgramNode(g[h-2],g[h-1],g[h]);break;case 5:this.$=new e.ProgramNode(g[h-1],g[h],[]);break;case 6:this.$=new e.ProgramNode(g[h]);break;case 7:this.$=new e.ProgramNode([]);break;case 8:this.$=new e.ProgramNode([]);break;case 9:this.$=[g[h]];break;case 10:g[h-1].push(g[h]),this.$=g[h-1];break;case 11:this.$=new e.BlockNode(g[h-2],g[h-1].inverse,g[h-1],g[h]);break;case 12:this.$=new e.BlockNode(g[h-2],g[h-1],g[h-1].inverse,g[h]);break;case 13:this.$=g[h];break;case 14:this.$=g[h];break;case 15:this.$=new e.ContentNode(g[h]);break;case 16:this.$=new e.CommentNode(g[h]);break;case 17:this.$=new e.MustacheNode(g[h-1][0],g[h-1][1],g[h-2],a(g[h-2],g[h]));break;case 18:this.$=new e.MustacheNode(g[h-1][0],g[h-1][1],g[h-2],a(g[h-2],g[h]));break;case 19:this.$={path:g[h-1],strip:a(g[h-2],g[h])};break;case 20:this.$=new e.MustacheNode(g[h-1][0],g[h-1][1],g[h-2],a(g[h-2],g[h]));break;case 21:this.$=new e.MustacheNode(g[h-1][0],g[h-1][1],g[h-2],a(g[h-2],g[h]));break;case 22:this.$=new e.PartialNode(g[h-2],g[h-1],a(g[h-3],g[h]));break;case 23:this.$=a(g[h-1],g[h]);break;case 24:this.$=[[g[h-2]].concat(g[h-1]),g[h]];break;case 25:this.$=[[g[h]],null];break;case 26:this.$=g[h];break;case 27:this.$=new e.StringNode(g[h]);break;case 28:this.$=new e.IntegerNode(g[h]);break;case 29:this.$=new e.BooleanNode(g[h]);break;case 30:this.$=g[h];break;case 31:this.$=new e.HashNode(g[h]);break;case 32:this.$=[g[h-2],g[h]];break;case 33:this.$=new e.PartialNameNode(g[h]);break;case 34:this.$=new e.PartialNameNode(new e.StringNode(g[h]));break;case 35:this.$=new e.PartialNameNode(new e.IntegerNode(g[h]));break;case 36:this.$=new e.DataNode(g[h]);break;case 37:this.$=new e.IdNode(g[h]);break;case 38:g[h-2].push({part:g[h],separator:g[h-1]}),this.$=g[h-2];break;case 39:this.$=[{part:g[h]}];break;case 42:this.$=[];break;case 43:g[h-1].push(g[h]);break;case 46:this.$=[g[h]];break;case 47:g[h-1].push(g[h])}},table:[{3:1,4:2,5:[1,3],8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[3]},{5:[1,16],8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[2,2]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{4:20,6:18,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{4:20,6:22,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{17:23,21:24,30:25,38:[1,28],40:[1,27],41:26},{17:29,21:24,30:25,38:[1,28],40:[1,27],41:26},{17:30,21:24,30:25,38:[1,28],40:[1,27],41:26},{17:31,21:24,30:25,38:[1,28],40:[1,27],41:26},{21:33,26:32,32:[1,34],33:[1,35],38:[1,28],41:26},{1:[2,1]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{10:36,20:[1,37]},{4:38,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,7],22:[1,13],23:[1,14],25:[1,15]},{7:39,8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,6],22:[1,13],23:[1,14],25:[1,15]},{17:23,18:[1,40],21:24,30:25,38:[1,28],40:[1,27],41:26},{10:41,20:[1,37]},{18:[1,42]},{18:[2,42],24:[2,42],28:43,32:[2,42],33:[2,42],34:[2,42],38:[2,42],40:[2,42]},{18:[2,25],24:[2,25]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],38:[2,37],40:[2,37],42:[1,44]},{21:45,38:[1,28],41:26},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],38:[2,39],40:[2,39],42:[2,39]},{18:[1,46]},{18:[1,47]},{24:[1,48]},{18:[2,40],21:50,27:49,38:[1,28],41:26},{18:[2,33],38:[2,33]},{18:[2,34],38:[2,34]},{18:[2,35],38:[2,35]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{21:51,38:[1,28],41:26},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,3],22:[1,13],23:[1,14],25:[1,15]},{4:52,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,5],22:[1,13],23:[1,14],25:[1,15]},{14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,44],21:56,24:[2,44],29:53,30:60,31:54,32:[1,57],33:[1,58],34:[1,59],35:55,36:61,37:62,38:[1,63],40:[1,27],41:26},{38:[1,64]},{18:[2,36],24:[2,36],32:[2,36],33:[2,36],34:[2,36],38:[2,36],40:[2,36]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,65]},{18:[2,41]},{18:[1,66]},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],25:[1,15]},{18:[2,24],24:[2,24]},{18:[2,43],24:[2,43],32:[2,43],33:[2,43],34:[2,43],38:[2,43],40:[2,43]},{18:[2,45],24:[2,45]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],38:[2,26],40:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],38:[2,27],40:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],38:[2,28],40:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],38:[2,29],40:[2,29]},{18:[2,30],24:[2,30],32:[2,30],33:[2,30],34:[2,30],38:[2,30],40:[2,30]},{18:[2,31],24:[2,31],37:67,38:[1,68]},{18:[2,46],24:[2,46],38:[2,46]},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],38:[2,39],39:[1,69],40:[2,39],42:[2,39]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],38:[2,38],40:[2,38],42:[2,38]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{18:[2,47],24:[2,47],38:[2,47]},{39:[1,69]},{21:56,30:60,31:70,32:[1,57],33:[1,58],34:[1,59],38:[1,28],40:[1,27],41:26},{18:[2,32],24:[2,32],38:[2,32]}],defaultActions:{3:[2,2],16:[2,1],50:[2,41]},parseError:function(a){throw new Error(a)
},parse:function(a){function b(){var a;return a=c.lexer.lex()||1,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var l=this.lexer.yylloc;f.push(l);var m=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var n,o,p,q,r,s,t,u,v,w={};;){if(p=d[d.length-1],this.defaultActions[p]?q=this.defaultActions[p]:((null===n||"undefined"==typeof n)&&(n=b()),q=g[p]&&g[p][n]),"undefined"==typeof q||!q.length||!q[0]){var x="";if(!k){v=[];for(s in g[p])this.terminals_[s]&&s>2&&v.push("'"+this.terminals_[s]+"'");x=this.lexer.showPosition?"Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+v.join(", ")+", got '"+(this.terminals_[n]||n)+"'":"Parse error on line "+(i+1)+": Unexpected "+(1==n?"end of input":"'"+(this.terminals_[n]||n)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[n]||n,line:this.lexer.yylineno,loc:l,expected:v})}}if(q[0]instanceof Array&&q.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+n);switch(q[0]){case 1:d.push(n),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(q[1]),n=null,o?(n=o,o=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,l=this.lexer.yylloc,k>0&&k--);break;case 2:if(t=this.productions_[q[1]][1],w.$=e[e.length-t],w._$={first_line:f[f.length-(t||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(t||1)].first_column,last_column:f[f.length-1].last_column},m&&(w._$.range=[f[f.length-(t||1)].range[0],f[f.length-1].range[1]]),r=this.performAction.call(w,h,j,i,this.yy,q[1],e,f),"undefined"!=typeof r)return r;t&&(d=d.slice(0,-1*t*2),e=e.slice(0,-1*t),f=f.slice(0,-1*t)),d.push(this.productions_[q[1]][0]),e.push(w.$),f.push(w._$),u=g[d[d.length-2]][d[d.length-1]],d.push(u);break;case 3:return!0}}return!0}},d=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw new Error(a);this.yy.parser.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b-1),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this},more:function(){return this._more=!0,this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d,e;this._more||(this.yytext="",this.match="");for(var f=this._currentRules(),g=0;g<f.length&&(c=this._input.match(this.rules[f[g]]),!c||b&&!(c[0].length>b[0].length)||(b=c,d=g,this.options.flex));g++);return b?(e=b[0].match(/(?:\r\n?|\n).*/g),e&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-e[e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,f[d],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),a?a:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return"undefined"!=typeof a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.options={},a.performAction=function(a,b,c,d){function e(a,c){return b.yytext=b.yytext.substr(a,b.yyleng-c)}switch(c){case 0:if("\\\\"===b.yytext.slice(-2)?(e(0,1),this.begin("mu")):"\\"===b.yytext.slice(-1)?(e(0,1),this.begin("emu")):this.begin("mu"),b.yytext)return 14;break;case 1:return 14;case 2:return"\\"!==b.yytext.slice(-1)&&this.popState(),"\\"===b.yytext.slice(-1)&&e(0,1),14;case 3:return e(0,4),this.popState(),15;case 4:return 25;case 5:return 16;case 6:return 20;case 7:return 19;case 8:return 19;case 9:return 23;case 10:return 22;case 11:this.popState(),this.begin("com");break;case 12:return e(3,5),this.popState(),15;case 13:return 22;case 14:return 39;case 15:return 38;case 16:return 38;case 17:return 42;case 18:break;case 19:return this.popState(),24;case 20:return this.popState(),18;case 21:return b.yytext=e(1,2).replace(/\\"/g,'"'),32;case 22:return b.yytext=e(1,2).replace(/\\'/g,"'"),32;case 23:return 40;case 24:return 34;case 25:return 34;case 26:return 33;case 27:return 38;case 28:return b.yytext=e(1,2),38;case 29:return"INVALID";case 30:return 5}},a.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s])))/,/^(?:false(?=([~}\s])))/,/^(?:-?[0-9]+(?=([~}\s])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],a.conditions={mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},INITIAL:{rules:[0,1,30],inclusive:!0}},a}();return c.lexer=d,b.prototype=c,c.Parser=b,new b}();return a=b}(),i=function(a,b){"use strict";function c(a){return a.constructor===f.ProgramNode?a:(e.yy=f,e.parse(a))}var d={},e=a,f=b;return d.parser=e,d.parse=c,d}(h,g),j=function(a){"use strict";function b(a){this.value=a}function c(){}var d,e=a.COMPILER_REVISION,f=a.REVISION_CHANGES,g=a.log;c.prototype={nameLookup:function(a,b){var d,e;return 0===a.indexOf("depth")&&(d=!0),e=/^[0-9]+$/.test(b)?a+"["+b+"]":c.isValidJavaScriptVariableName(b)?a+"."+b:a+"['"+b+"']",d?"("+a+" && "+e+")":e},appendToBuffer:function(a){return this.environment.isSimple?"return "+a+";":{appendToBuffer:!0,content:a,toString:function(){return"buffer += "+a+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(a,b,c,d){this.environment=a,this.options=b||{},g("debug",this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!c,this.context=c||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(a,b);var e,f=a.opcodes;this.i=0;for(var h=f.length;this.i<h;this.i++)e=f[this.i],"DECLARE"===e.opcode?this[e.name]=e.value:this[e.opcode].apply(this,e.args),e.opcode!==this.stripNext&&(this.stripNext=!1);return this.pushSource(""),this.createFunctionContext(d)},preamble:function(){var a=[];if(this.isChild)a.push("");else{var b=this.namespace,c="helpers = this.merge(helpers, "+b+".helpers);";this.environment.usePartial&&(c=c+" partials = this.merge(partials, "+b+".partials);"),this.options.data&&(c+=" data = data || {};"),a.push(c)}this.environment.isSimple?a.push(""):a.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=a},createFunctionContext:function(a){var b=this.stackVars.concat(this.registers.list);if(b.length>0&&(this.source[1]=this.source[1]+", "+b.join(", ")),!this.isChild)for(var c in this.context.aliases)this.context.aliases.hasOwnProperty(c)&&(this.source[1]=this.source[1]+", "+c+"="+this.context.aliases[c]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.pushSource("return buffer;");for(var d=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],h=0,i=this.environment.depths.list.length;i>h;h++)d.push("depth"+this.environment.depths.list[h]);var j=this.mergeSource();if(!this.isChild){var k=e,l=f[k];j="this.compilerInfo = ["+k+",'"+l+"'];\n"+j}if(a)return d.push(j),Function.apply(this,d);var m="function "+(this.name||"")+"("+d.join(",")+") {\n  "+j+"}";return g("debug",m+"\n\n"),m},mergeSource:function(){for(var a,b="",c=0,d=this.source.length;d>c;c++){var e=this.source[c];e.appendToBuffer?a=a?a+"\n    + "+e.content:e.content:(a&&(b+="buffer += "+a+";\n  ",a=void 0),b+=e+"\n  ")}return b},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var a=["depth0"];this.setupParams(0,a),this.replaceStack(function(b){return a.splice(1,0,b),"blockHelperMissing.call("+a.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var a=["depth0"];this.setupParams(0,a);var b=this.topStack();a.splice(1,0,b),a[a.length-1]="options",this.pushSource("if (!"+this.lastHelper+") { "+b+" = blockHelperMissing.call("+a.join(", ")+"); }")},appendContent:function(a){this.pendingContent&&(a=this.pendingContent+a),this.stripNext&&(a=a.replace(/^\s+/,"")),this.pendingContent=a},strip:function(){this.pendingContent&&(this.pendingContent=this.pendingContent.replace(/\s+$/,"")),this.stripNext="strip"},append:function(){this.flushInline();var a=this.popStack();this.pushSource("if("+a+" || "+a+" === 0) { "+this.appendToBuffer(a)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(a){this.lastContext!==a&&(this.lastContext=a)},lookupOnContext:function(a){this.push(this.nameLookup("depth"+this.lastContext,a,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(a){return"typeof "+a+" === functionType ? "+a+".apply(depth0) : "+a})},lookup:function(a){this.replaceStack(function(b){return b+" == null || "+b+" === false ? "+b+" : "+this.nameLookup(b,a,"context")})},lookupData:function(){this.push("data")},pushStringParam:function(a,b){this.pushStackLiteral("depth"+this.lastContext),this.pushString(b),"string"==typeof a?this.pushString(a):this.pushStackLiteral(a)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.register("hashTypes","{}"),this.register("hashContexts","{}"))},pushHash:function(){this.hash={values:[],types:[],contexts:[]}},popHash:function(){var a=this.hash;this.hash=void 0,this.options.stringParams&&(this.register("hashContexts","{"+a.contexts.join(",")+"}"),this.register("hashTypes","{"+a.types.join(",")+"}")),this.push("{\n    "+a.values.join(",\n    ")+"\n  }")},pushString:function(a){this.pushStackLiteral(this.quotedString(a))},push:function(a){return this.inlineStack.push(a),a},pushLiteral:function(a){this.pushStackLiteral(a)},pushProgram:function(a){null!=a?this.pushStackLiteral(this.programExpression(a)):this.pushStackLiteral(null)},invokeHelper:function(a,b){this.context.aliases.helperMissing="helpers.helperMissing";var c=this.lastHelper=this.setupHelper(a,b,!0),d=this.nameLookup("depth"+this.lastContext,b,"context");this.push(c.name+" || "+d),this.replaceStack(function(a){return a+" ? "+a+".call("+c.callParams+") : helperMissing.call("+c.helperMissingParams+")"})},invokeKnownHelper:function(a,b){var c=this.setupHelper(a,b);this.push(c.name+".call("+c.callParams+")")},invokeAmbiguous:function(a,b){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var c=this.setupHelper(0,a,b),d=this.lastHelper=this.nameLookup("helpers",a,"helper"),e=this.nameLookup("depth"+this.lastContext,a,"context"),f=this.nextStack();this.pushSource("if ("+f+" = "+d+") { "+f+" = "+f+".call("+c.callParams+"); }"),this.pushSource("else { "+f+" = "+e+"; "+f+" = typeof "+f+" === functionType ? "+f+".call("+c.callParams+") : "+f+"; }")},invokePartial:function(a){var b=[this.nameLookup("partials",a,"partial"),"'"+a+"'",this.popStack(),"helpers","partials"];this.options.data&&b.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+b.join(", ")+")")},assignToHash:function(a){var b,c,d=this.popStack();this.options.stringParams&&(c=this.popStack(),b=this.popStack());var e=this.hash;b&&e.contexts.push("'"+a+"': "+b),c&&e.types.push("'"+a+"': "+c),e.values.push("'"+a+"': ("+d+")")},compiler:c,compileChildren:function(a,b){for(var c,d,e=a.children,f=0,g=e.length;g>f;f++){c=e[f],d=new this.compiler;var h=this.matchExistingProgram(c);null==h?(this.context.programs.push(""),h=this.context.programs.length,c.index=h,c.name="program"+h,this.context.programs[h]=d.compile(c,b,this.context),this.context.environments[h]=c):(c.index=h,c.name="program"+h)}},matchExistingProgram:function(a){for(var b=0,c=this.context.environments.length;c>b;b++){var d=this.context.environments[b];if(d&&d.equals(a))return b}},programExpression:function(a){if(this.context.aliases.self="this",null==a)return"self.noop";for(var b,c=this.environment.children[a],d=c.depths.list,e=[c.index,c.name,"data"],f=0,g=d.length;g>f;f++)b=d[f],1===b?e.push("depth0"):e.push("depth"+(b-1));return(0===d.length?"self.program(":"self.programWithDepth(")+e.join(", ")+")"},register:function(a,b){this.useRegister(a),this.pushSource(a+" = "+b+";")},useRegister:function(a){this.registers[a]||(this.registers[a]=!0,this.registers.list.push(a))},pushStackLiteral:function(a){return this.push(new b(a))},pushSource:function(a){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=void 0),a&&this.source.push(a)},pushStack:function(a){this.flushInline();var b=this.incrStack();return a&&this.pushSource(b+" = "+a+";"),this.compileStack.push(b),b},replaceStack:function(a){var c,d="",e=this.isInline();if(e){var f=this.popStack(!0);if(f instanceof b)c=f.value;else{var g=this.stackSlot?this.topStackName():this.incrStack();d="("+this.push(g)+" = "+f+"),",c=this.topStack()}}else c=this.topStack();var h=a.call(this,c);return e?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+d+h+")")):(/^stack/.test(c)||(c=this.nextStack()),this.pushSource(c+" = ("+d+h+");")),c},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var a=this.inlineStack;if(a.length){this.inlineStack=[];for(var c=0,d=a.length;d>c;c++){var e=a[c];e instanceof b?this.compileStack.push(e):this.pushStack(e)}}},isInline:function(){return this.inlineStack.length},popStack:function(a){var c=this.isInline(),d=(c?this.inlineStack:this.compileStack).pop();return!a&&d instanceof b?d.value:(c||this.stackSlot--,d)},topStack:function(a){var c=this.isInline()?this.inlineStack:this.compileStack,d=c[c.length-1];return!a&&d instanceof b?d.value:d},quotedString:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(a,b,c){var d=[];this.setupParams(a,d,c);var e=this.nameLookup("helpers",b,"helper");return{params:d,name:e,callParams:["depth0"].concat(d).join(", "),helperMissingParams:c&&["depth0",this.quotedString(b)].concat(d).join(", ")}},setupParams:function(a,b,c){var d,e,f,g=[],h=[],i=[];g.push("hash:"+this.popStack()),e=this.popStack(),f=this.popStack(),(f||e)&&(f||(this.context.aliases.self="this",f="self.noop"),e||(this.context.aliases.self="this",e="self.noop"),g.push("inverse:"+e),g.push("fn:"+f));for(var j=0;a>j;j++)d=this.popStack(),b.push(d),this.options.stringParams&&(i.push(this.popStack()),h.push(this.popStack()));return this.options.stringParams&&(g.push("contexts:["+h.join(",")+"]"),g.push("types:["+i.join(",")+"]"),g.push("hashContexts:hashContexts"),g.push("hashTypes:hashTypes")),this.options.data&&g.push("data:data"),g="{"+g.join(",")+"}",c?(this.register("options",g),b.push("options")):b.push(g),b.join(", ")}};for(var h="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),i=c.RESERVED_WORDS={},j=0,k=h.length;k>j;j++)i[h[j]]=!0;return c.isValidJavaScriptVariableName=function(a){return!c.RESERVED_WORDS[a]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(a)?!0:!1},d=c}(d),k=function(a,b,c,d){"use strict";function e(){}function f(a,b){if(null==a||"string"!=typeof a&&a.constructor!==l.ProgramNode)throw new i("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+a);b=b||{},"data"in b||(b.data=!0);var c=j(a),d=(new e).compile(c,b);return(new k).compile(d,b)}function g(a,b,c){function d(){var d=j(a),f=(new e).compile(d,b),g=(new k).compile(f,b,void 0,!0);return c.template(g)}if(null==a||"string"!=typeof a&&a.constructor!==l.ProgramNode)throw new i("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+a);b=b||{},"data"in b||(b.data=!0);var f;return function(a,b){return f||(f=d()),f.call(this,a,b)}}var h={},i=a,j=b.parse,k=c,l=d;return h.Compiler=e,e.prototype={compiler:e,disassemble:function(){for(var a,b,c,d=this.opcodes,e=[],f=0,g=d.length;g>f;f++)if(a=d[f],"DECLARE"===a.opcode)e.push("DECLARE "+a.name+"="+a.value);else{b=[];for(var h=0;h<a.args.length;h++)c=a.args[h],"string"==typeof c&&(c='"'+c.replace("\n","\\n")+'"'),b.push(c);e.push(a.opcode+" "+b.join(" "))}return e.join("\n")},equals:function(a){var b=this.opcodes.length;if(a.opcodes.length!==b)return!1;for(var c=0;b>c;c++){var d=this.opcodes[c],e=a.opcodes[c];if(d.opcode!==e.opcode||d.args.length!==e.args.length)return!1;for(var f=0;f<d.args.length;f++)if(d.args[f]!==e.args[f])return!1}if(b=this.children.length,a.children.length!==b)return!1;for(c=0;b>c;c++)if(!this.children[c].equals(a.children[c]))return!1;return!0},guid:0,compile:function(a,b){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=b;var c=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},c)for(var d in c)this.options.knownHelpers[d]=c[d];return this.accept(a)},accept:function(a){var b,c=a.strip||{};return c.left&&this.opcode("strip"),b=this[a.type](a),c.right&&this.opcode("strip"),b},program:function(a){for(var b=a.statements,c=0,d=b.length;d>c;c++)this.accept(b[c]);return this.isSimple=1===d,this.depths.list=this.depths.list.sort(function(a,b){return a-b}),this},compileProgram:function(a){var b,c=(new this.compiler).compile(a,this.options),d=this.guid++;this.usePartial=this.usePartial||c.usePartial,this.children[d]=c;for(var e=0,f=c.depths.list.length;f>e;e++)b=c.depths.list[e],2>b||this.addDepth(b-1);return d},block:function(a){var b=a.mustache,c=a.program,d=a.inverse;c&&(c=this.compileProgram(c)),d&&(d=this.compileProgram(d));var e=this.classifyMustache(b);"helper"===e?this.helperMustache(b,c,d):"simple"===e?(this.simpleMustache(b),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(b,c,d),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(a){var b,c,d=a.pairs;this.opcode("pushHash");for(var e=0,f=d.length;f>e;e++)b=d[e],c=b[1],this.options.stringParams?(c.depth&&this.addDepth(c.depth),this.opcode("getContext",c.depth||0),this.opcode("pushStringParam",c.stringModeValue,c.type)):this.accept(c),this.opcode("assignToHash",b[0]);this.opcode("popHash")},partial:function(a){var b=a.partialName;this.usePartial=!0,a.context?this.ID(a.context):this.opcode("push","depth0"),this.opcode("invokePartial",b.name),this.opcode("append")},content:function(a){this.opcode("appendContent",a.string)},mustache:function(a){var b=this.options,c=this.classifyMustache(a);"simple"===c?this.simpleMustache(a):"helper"===c?this.helperMustache(a):this.ambiguousMustache(a),a.escaped&&!b.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(a,b,c){var d=a.id,e=d.parts[0],f=null!=b||null!=c;this.opcode("getContext",d.depth),this.opcode("pushProgram",b),this.opcode("pushProgram",c),this.opcode("invokeAmbiguous",e,f)},simpleMustache:function(a){var b=a.id;"DATA"===b.type?this.DATA(b):b.parts.length?this.ID(b):(this.addDepth(b.depth),this.opcode("getContext",b.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(a,b,c){var d=this.setupFullMustacheParams(a,b,c),e=a.id.parts[0];if(this.options.knownHelpers[e])this.opcode("invokeKnownHelper",d.length,e);else{if(this.options.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+e);this.opcode("invokeHelper",d.length,e)}},ID:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth);var b=a.parts[0];b?this.opcode("lookupOnContext",a.parts[0]):this.opcode("pushContext");for(var c=1,d=a.parts.length;d>c;c++)this.opcode("lookup",a.parts[c])},DATA:function(a){if(this.options.data=!0,a.id.isScoped||a.id.depth)throw new i("Scoped data references are not supported: "+a.original);this.opcode("lookupData");for(var b=a.id.parts,c=0,d=b.length;d>c;c++)this.opcode("lookup",b[c])},STRING:function(a){this.opcode("pushString",a.string)},INTEGER:function(a){this.opcode("pushLiteral",a.integer)},BOOLEAN:function(a){this.opcode("pushLiteral",a.bool)},comment:function(){},opcode:function(a){this.opcodes.push({opcode:a,args:[].slice.call(arguments,1)})},declare:function(a,b){this.opcodes.push({opcode:"DECLARE",name:a,value:b})},addDepth:function(a){if(isNaN(a))throw new Error("EWOT");0!==a&&(this.depths[a]||(this.depths[a]=!0,this.depths.list.push(a)))},classifyMustache:function(a){var b=a.isHelper,c=a.eligibleHelper,d=this.options;if(c&&!b){var e=a.id.parts[0];d.knownHelpers[e]?b=!0:d.knownHelpersOnly&&(c=!1)}return b?"helper":c?"ambiguous":"simple"},pushParams:function(a){for(var b,c=a.length;c--;)b=a[c],this.options.stringParams?(b.depth&&this.addDepth(b.depth),this.opcode("getContext",b.depth||0),this.opcode("pushStringParam",b.stringModeValue,b.type)):this[b.type](b)},setupMustacheParams:function(a){var b=a.params;return this.pushParams(b),a.hash?this.hash(a.hash):this.opcode("emptyHash"),b},setupFullMustacheParams:function(a,b,c){var d=a.params;return this.pushParams(d),this.opcode("pushProgram",b),this.opcode("pushProgram",c),a.hash?this.hash(a.hash):this.opcode("emptyHash"),d}},h.precompile=f,h.compile=g,h}(c,i,j,g),l=function(a,b,c,d,e){"use strict";var f,g=a,h=b,i=c.parser,j=c.parse,k=d.Compiler,l=d.compile,m=d.precompile,n=e,o=g.create,p=function(){var a=o();return a.compile=function(b,c){return l(b,c,a)},a.precompile=m,a.AST=h,a.Compiler=k,a.JavaScriptCompiler=n,a.Parser=i,a.parse=j,a};return g=p(),g.create=p,f=g}(f,g,i,k,j);return l}();!function(){var a={},b=null,c=!0,d=!1;if("undefined"!=typeof AudioContext)b=new AudioContext;else if("undefined"!=typeof webkitAudioContext)b=new webkitAudioContext;else if("undefined"!=typeof Audio){c=!1;try{new Audio}catch(e){d=!0}}else c=!1,d=!0;if(c){var f=void 0===b.createGain?b.createGainNode():b.createGain();f.gain.value=1,f.connect(b.destination)}var g=function(){this._volume=1,this._muted=!1,this.usingWebAudio=c,this.noAudio=d,this._howls=[]};g.prototype={volume:function(a){var b=this;if(a=parseFloat(a),a>=0&&1>=a){b._volume=a,c&&(f.gain.value=a);for(var d in b._howls)if(b._howls.hasOwnProperty(d)&&b._howls[d]._webAudio===!1)for(var e=0;e<b._howls[d]._audioNode.length;e++)b._howls[d]._audioNode[e].volume=b._howls[d]._volume*b._volume;return b}return c?f.gain.value:b._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(a){var b=this;b._muted=a,c&&(f.gain.value=a?0:b._volume);for(var d in b._howls)if(b._howls.hasOwnProperty(d)&&b._howls[d]._webAudio===!1)for(var e=0;e<b._howls[d]._audioNode.length;e++)b._howls[d]._audioNode[e].muted=a}};var h=new g,i=null;if(!d){i=new Audio;var j={mp3:!!i.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!i.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!i.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),m4a:!!(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(i.canPlayType("audio/x-mp4;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")}}var k=function(a){var b=this;b._autoplay=a.autoplay||!1,b._buffer=a.buffer||!1,b._duration=a.duration||0,b._format=a.format||null,b._loop=a.loop||!1,b._loaded=!1,b._sprite=a.sprite||{},b._src=a.src||"",b._pos3d=a.pos3d||[0,0,-.5],b._volume=void 0!==a.volume?a.volume:1,b._urls=a.urls||[],b._rate=a.rate||1,b._onload=[a.onload||function(){}],b._onloaderror=[a.onloaderror||function(){}],b._onend=[a.onend||function(){}],b._onpause=[a.onpause||function(){}],b._onplay=[a.onplay||function(){}],b._onendTimer=[],b._webAudio=c&&!b._buffer,b._audioNode=[],b._webAudio&&b._setupAudioNode(),h._howls.push(b),b.load()};if(k.prototype={load:function(){var b=this,c=null;if(d)return b.on("loaderror"),void 0;for(var e=0;e<b._urls.length;e++){var f,g;if(b._format)f=b._format;else{if(g=b._urls[e].toLowerCase().split("?")[0],f=g.match(/.+\.([^?]+)(\?|$)/),f=f&&f.length>=2?f:g.match(/data\:audio\/([^?]+);/),!f)return b.on("loaderror"),void 0;f=f[1]}if(j[f]){c=b._urls[e];break}}if(!c)return b.on("loaderror"),void 0;if(b._src=c,b._webAudio)l(b,c);else{var i=new Audio;b._audioNode.push(i),i.src=c,i._pos=0,i.preload="auto",i.volume=h._muted?0:b._volume*h.volume(),a[c]=b;var k=function(){b._duration=Math.ceil(10*i.duration)/10,0===Object.getOwnPropertyNames(b._sprite).length&&(b._sprite={_default:[0,1e3*b._duration]}),b._loaded||(b._loaded=!0,b.on("load")),b._autoplay&&b.play(),i.removeEventListener("canplaythrough",k,!1)};i.addEventListener("canplaythrough",k,!1),i.load()}return b},urls:function(a){var b=this;return a?(b.stop(),b._urls="string"==typeof a?[a]:a,b._loaded=!1,b.load(),b):b._urls},play:function(a,c){var d=this;return"function"==typeof a&&(c=a),a&&"function"!=typeof a||(a="_default"),d._loaded?d._sprite[a]?(d._inactiveNode(function(e){e._sprite=a;var f,g=e._pos>0?e._pos:d._sprite[a][0]/1e3,i=d._sprite[a][1]/1e3-e._pos,j=!(!d._loop&&!d._sprite[a][2]),k="string"==typeof c?c:Math.round(Date.now()*Math.random())+"";if(function(){var b={id:k,sprite:a,loop:j};f=setTimeout(function(){!d._webAudio&&j&&d.stop(b.id,b.timer).play(a,b.id),d._webAudio&&!j&&(d._nodeById(b.id).paused=!0,d._nodeById(b.id)._pos=0),d._webAudio||j||d.stop(b.id,b.timer),d.on("end",k)},1e3*i),d._onendTimer.push(f),b.timer=d._onendTimer[d._onendTimer.length-1]}(),d._webAudio){var l=d._sprite[a][0]/1e3,m=d._sprite[a][1]/1e3;e.id=k,e.paused=!1,n(d,[j,l,m],k),d._playStart=b.currentTime,e.gain.value=d._volume,void 0===e.bufferSource.start?e.bufferSource.noteGrainOn(0,g,i):e.bufferSource.start(0,g,i)}else{if(4!==e.readyState)return d._clearEndTimer(f),function(){var b=d,f=a,g=c,h=e,i=function(){b.play(f,g),h.removeEventListener("canplaythrough",i,!1)};h.addEventListener("canplaythrough",i,!1)}(),d;e.id=k,e.currentTime=g,e.muted=h._muted,e.volume=d._volume*h.volume(),setTimeout(function(){e.play()},0)}return d.on("play"),"function"==typeof c&&c(k),d}),d):("function"==typeof c&&c(),d):(d.on("load",function(){d.play(a,c)}),d)},pause:function(a,b){var c=this;if(!c._loaded)return c.on("play",function(){c.pause(a)}),c;c._clearEndTimer(b||0);var d=a?c._nodeById(a):c._activeNode();if(d)if(d._pos=c.pos(null,a),c._webAudio){if(!d.bufferSource||d.paused)return c;d.paused=!0,void 0===d.bufferSource.stop?d.bufferSource.noteOff(0):d.bufferSource.stop(0)}else d.pause();return c.on("pause"),c},stop:function(a,b){var c=this;if(!c._loaded)return c.on("play",function(){c.stop(a)}),c;c._clearEndTimer(b||0);var d=a?c._nodeById(a):c._activeNode();if(d)if(d._pos=0,c._webAudio){if(!d.bufferSource||d.paused)return c;d.paused=!0,void 0===d.bufferSource.stop?d.bufferSource.noteOff(0):d.bufferSource.stop(0)}else d.pause(),d.currentTime=0;return c},mute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.mute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=0:c.volume=0),b},unmute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.unmute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=b._volume:c.volume=b._volume),b},volume:function(a,b){var c=this;if(a=parseFloat(a),a>=0&&1>=a){if(c._volume=a,!c._loaded)return c.on("play",function(){c.volume(a,b)}),c;var d=b?c._nodeById(b):c._activeNode();return d&&(c._webAudio?d.gain.value=a:d.volume=a*h.volume()),c}return c._volume},loop:function(a){var b=this;return"boolean"==typeof a?(b._loop=a,b):b._loop},sprite:function(a){var b=this;return"object"==typeof a?(b._sprite=a,b):b._sprite},pos:function(a,c){var d=this;if(!d._loaded)return d.on("load",function(){d.pos(a)}),"number"==typeof a?d:d._pos||0;a=parseFloat(a);var e=c?d._nodeById(c):d._activeNode();if(e)return a>=0?(d.pause(c),e._pos=a,d.play(e._sprite,c),d):d._webAudio?e._pos+(b.currentTime-d._playStart):e.currentTime;if(a>=0)return d;for(var f=0;f<d._audioNode.length;f++)if(d._audioNode[f].paused&&4===d._audioNode[f].readyState)return d._webAudio?d._audioNode[f]._pos:d._audioNode[f].currentTime},pos3d:function(a,b,c,d){var e=this;if(b=void 0!==b&&b?b:0,c=void 0!==c&&c?c:-.5,!e._loaded)return e.on("play",function(){e.pos3d(a,b,c,d)}),e;if(!(a>=0||0>a))return e._pos3d;
if(e._webAudio){var f=d?e._nodeById(d):e._activeNode();f&&(e._pos3d=[a,b,c],f.panner.setPosition(a,b,c))}return e},fade:function(a,b,c,d,e){var f=this,g=Math.abs(a-b),h=a>b?"down":"up",i=g/.01,j=c/i;if(!f._loaded)return f.on("load",function(){f.fade(a,b,c,d,e)}),f;f.volume(a,e);for(var k=1;i>=k;k++)!function(){var a=f._volume+("up"===h?.01:-.01)*k,c=Math.round(1e3*a)/1e3,g=b;setTimeout(function(){f.volume(c,e),c===g&&d&&d()},j*k)}()},fadeIn:function(a,b,c){return this.volume(0).play().fade(0,a,b,c)},fadeOut:function(a,b,c,d){var e=this;return e.fade(e._volume,a,b,function(){c&&c(),e.pause(d),e.on("end")},d)},_nodeById:function(a){for(var b=this,c=b._audioNode[0],d=0;d<b._audioNode.length;d++)if(b._audioNode[d].id===a){c=b._audioNode[d];break}return c},_activeNode:function(){for(var a=this,b=null,c=0;c<a._audioNode.length;c++)if(!a._audioNode[c].paused){b=a._audioNode[c];break}return a._drainPool(),b},_inactiveNode:function(a){for(var b=this,c=null,d=0;d<b._audioNode.length;d++)if(b._audioNode[d].paused&&4===b._audioNode[d].readyState){a(b._audioNode[d]),c=!0;break}if(b._drainPool(),!c){var e;b._webAudio?(e=b._setupAudioNode(),a(e)):(b.load(),e=b._audioNode[b._audioNode.length-1],e.addEventListener("loadedmetadata",function(){a(e)}))}},_drainPool:function(){var a,b=this,c=0;for(a=0;a<b._audioNode.length;a++)b._audioNode[a].paused&&c++;for(a=b._audioNode.length-1;a>=0&&!(5>=c);a--)b._audioNode[a].paused&&(b._webAudio&&b._audioNode[a].disconnect(0),c--,b._audioNode.splice(a,1))},_clearEndTimer:function(a){var b=this,c=b._onendTimer.indexOf(a);c=c>=0?c:0,b._onendTimer[c]&&(clearTimeout(b._onendTimer[c]),b._onendTimer.splice(c,1))},_setupAudioNode:function(){var a=this,c=a._audioNode,d=a._audioNode.length;return c[d]=void 0===b.createGain?b.createGainNode():b.createGain(),c[d].gain.value=a._volume,c[d].paused=!0,c[d]._pos=0,c[d].readyState=4,c[d].connect(f),c[d].panner=b.createPanner(),c[d].panner.setPosition(a._pos3d[0],a._pos3d[1],a._pos3d[2]),c[d].panner.connect(c[d]),c[d]},on:function(a,b){var c=this,d=c["_on"+a];if("function"==typeof b)d.push(b);else for(var e=0;e<d.length;e++)b?d[e].call(c,b):d[e].call(c);return c},off:function(a,b){for(var c=this,d=c["_on"+a],e=""+b,f=0;f<d.length;f++)if(e===""+d[f]){d.splice(f,1);break}return c},unload:function(){for(var b=this,c=b._audioNode,d=0;d<b._audioNode.length;d++)c[d].paused||b.stop(c[d].id),b._webAudio?c[d].disconnect(0):c[d].src="";var e=h._howls.indexOf(b);null!==e&&e>=0&&h._howls.splice(e,1),delete a[b._src],b=null}},c)var l=function(c,d){if(d in a)c._duration=a[d].duration,m(c);else{var e=new XMLHttpRequest;e.open("GET",d,!0),e.responseType="arraybuffer",e.onload=function(){b.decodeAudioData(e.response,function(b){b&&(a[d]=b,m(c,b))},function(){c.on("loaderror")})},e.onerror=function(){c._webAudio&&(c._buffer=!0,c._webAudio=!1,c._audioNode=[],delete c._gainNode,c.load())};try{e.send()}catch(f){e.onerror()}}},m=function(a,b){a._duration=b?b.duration:a._duration,0===Object.getOwnPropertyNames(a._sprite).length&&(a._sprite={_default:[0,1e3*a._duration]}),a._loaded||(a._loaded=!0,a.on("load")),a._autoplay&&a.play()},n=function(c,d,e){var f=c._nodeById(e);f.bufferSource=b.createBufferSource(),f.bufferSource.buffer=a[c._src],f.bufferSource.connect(f.panner),f.bufferSource.loop=d[0],d[0]&&(f.bufferSource.loopStart=d[1],f.bufferSource.loopEnd=d[1]+d[2]),f.bufferSource.playbackRate.value=c._rate};"function"==typeof define&&define.amd&&define(function(){return{Howler:h,Howl:k}}),"undefined"!=typeof exports&&(exports.Howler=h,exports.Howl=k),window.Howler=h,window.Howl=k}();var collie=collie||{};!function(){collie.version="1.1.1",collie.Class=function(a,b){var c,d=null,e=function(){return!0};if("$init"in a&&(d=a.$init,delete a.$init),"undefined"==typeof b)c=function(){var a=arguments;return this instanceof c?(a.length&&a[0]===e&&(a=a[1]),null!==d&&d.apply(this,a),void 0):new c(e,a)};else{c=function(){var a=arguments;return this instanceof c?(a.length&&a[0]===e&&(a=a[1]),b.apply(this,a),null!==d&&d.apply(this,a),void 0):new c(e,a)};var f=function(){};f.prototype=b.prototype,c.$super=b.prototype,c.prototype=new f,c.prototype.constructor=c}for(var g in a)a.hasOwnProperty(g)&&"prototype"!==g&&(c.prototype[g]=a[g]);return c},collie.util=new(collie.Class({$init:function(){this._sCSSPrefix=null,this._htDeviceInfo=null,this._bSupport3d=null,this._bSupportCSS3=null,this._htBoundary={left:0,right:0,top:0,bottom:0}},getDisplayObjectById:function(a){return collie.DisplayObject.htFactory[a]},getDisplayObjectByName:function(a){for(var b in collie.DisplayObject.htFactory)if(collie.DisplayObject.htFactory[b].get("name")===a)return collie.DisplayObject.htFactory[b];return!1},getDeviceInfo:function(a){if(null!==this._htDeviceInfo&&"undefined"==typeof a)return this._htDeviceInfo;var b=null,c=!1,d="undefined"!=typeof CanvasRenderingContext2D,e=!1,f=!1,g=!1,h=/chrome/i.test(a)?!0:!1,a=a||navigator.userAgent,i=0;return/android/i.test(a)?(e=!0,b=a.toString().match(/android ([0-9]\.[0-9])\.?([0-9]?)/i),b&&b[1]&&(i=(parseFloat(b[1])+(b[2]?.01*b[2]:0)).toFixed(2))):/(iphone|ipad|ipod)/i.test(a)?(f=!0,b=a.toString().match(/([0-9]_[0-9])/i),b&&b[1]&&(i=parseFloat(b[1].replace(/_/,".")))):(c=!0,/(MSIE)/i.test(a)&&(g=!0,b=a.toString().match(/MSIE ([0-9])/i),b&&b[1]&&(i=parseInt(b[1],10)))),this._htDeviceInfo={supportCanvas:d,desktop:c,android:e?i:!1,ios:f?i:!1,ie:g?i:!1,chrome:h},this._htDeviceInfo},getCSSPrefix:function(a,b){var c="";if(null===this._sCSSPrefix&&(this._sCSSPrefix="","undefined"!=typeof document.body.style.webkitTransform?this._sCSSPrefix="-webkit-":"undefined"!=typeof document.body.style.MozTransform?this._sCSSPrefix="-moz-":"undefined"!=typeof document.body.style.OTransform?this._sCSSPrefix="-o-":"undefined"!=typeof document.body.style.msTransform&&(this._sCSSPrefix="-ms-")),c=this._sCSSPrefix+(a?a:""),b){var d=c.split("-");c="";for(var e=0,f=d.length;f>e;e++)d[e]&&(c+=c?d[e].substr(0,1).toUpperCase()+d[e].substr(1):d[e]);("-moz-"===this._sCSSPrefix||"-o-"===this._sCSSPrefix)&&(c=c.substr(0,1).toUpperCase()+c.substr(1))}return c},getSupportCSS3:function(){return null===this._bSupportCSS3&&(this._bSupportCSS3="undefined"!=typeof document.body.style[collie.util.getCSSPrefix("transform",!0)]||"undefined"!=typeof document.body.style.transform),this._bSupportCSS3},getSupportCSS3d:function(){return null===this._bSupport3d&&(this._bSupport3d=("undefined"!=typeof document.body.style[collie.util.getCSSPrefix("perspective",!0)]||"undefined"!=typeof document.body.style.perspective)&&(!collie.util.getDeviceInfo().android||collie.util.getDeviceInfo().android>=4)),this._bSupport3d},toRad:function(a){return a*Math.PI/180},toDeg:function(a){return 180*a/Math.PI},approximateValue:function(a){return Math.round(1e7*a)/1e7},fixAngle:function(a){var b=collie.util.toDeg(a);return b-=360*Math.floor(b/360),collie.util.toRad(b)},getDistance:function(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))},getBoundary:function(a){for(var b=a[0][0],c=a[0][0],d=a[0][1],e=a[0][1],f=1,g=a.length;g>f;f++)b=Math.min(b,a[f][0]),c=Math.max(c,a[f][0]),d=Math.min(d,a[f][1]),e=Math.max(e,a[f][1]);return{left:b,right:c,top:d,bottom:e}},getBoundaryToPoints:function(a){return[[a.left,a.top],[a.right,a.top],[a.right,a.bottom],[a.left,a.bottom]]},queryString:function(){var a={};if(location.search)for(var b=location.search.substr(1).split("&"),c=0,d=b.length;d>c;c++){var e=b[c].split("=");a[e.shift()]=e.join("=")}return a},cloneObject:function(a){var b={};for(var c in a)b[c]=a[c];return b},pushWithSort:function(a,b){for(var c=!1,d=0,e=a.length;e>d;d++)if(a[d]._htOption.zIndex>b._htOption.zIndex){a.splice(d,0,b),c=!0;break}c||a.push(b)},addEventListener:function(a,b,c,d){"string"==typeof a&&(a=document.getElementById(a)),"addEventListener"in a?a.addEventListener(b,c,d):a.attachEvent("on"+b,c,d)},removeEventListener:function(a,b,c,d){"string"==typeof a&&(a=document.getElementById(a)),"removeEventListener"in a?a.removeEventListener(b,c,d):a.detachEvent("on"+b,c,d)},stopEventDefault:function(a){a=a||window.event,"preventDefault"in a&&a.preventDefault(),a.returnValue=!1},getPosition:function(a){"string"==typeof a&&(a=document.getElementById(a));var b=a.ownerDocument||a.document||document,c=b.documentElement,d=b.body,e={};if("getBoundingClientRect"in a){var f=a.getBoundingClientRect();e.x=f.left,e.x+=c.scrollLeft||d.scrollLeft,e.y=f.top,e.y+=c.scrollTop||d.scrollTop,e.width=f.width,e.height=f.height}else{e.x=0,e.y=0,e.width=a.offsetWidth,e.height=a.offsetHeight;for(var g=a;g;g=g.offsetParent)e.x+=g.offsetLeft,e.y+=g.offsetTop;for(var g=a.parentNode;g&&"BODY"!==g.tagName;g=g.parentNode)"TR"===g.tagName&&(e.y+=2),e.x-=g.scrollLeft,e.y-=g.scrollTop}return e}})),collie.util.getDeviceInfo().ios&&window.addEventListener("load",function(){setTimeout(function(){document.body.scrollTop=0},300)}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});var a=window.CanvasRenderingContext2D&&CanvasRenderingContext2D.prototype;a&&a.lineTo&&(a._dashedLineProperty={index:0,length:0},a.resetDashedLine=function(){this._dashedLineProperty={index:0,length:0}},a.dashedLine=function(a,b,c,d,e,f){e||(e=[10,5]);for(var g=c-a,h=d-b,i=Math.sqrt(g*g+h*h),j=Math.atan2(h,g),k=e.length,l=this._dashedLineProperty.index||0,m=this._dashedLineProperty.length||0,n=0,o=0;i>m;)(0!==n||0===m)&&(m+=e[l++%k]*f),m>i&&(this._dashedLineProperty.length=m-i,m=i),n=a+m*Math.cos(j),o=b+m*Math.sin(j),l%2===1?this.lineTo(n,o):this.moveTo(n,o);this._dashedLineProperty.index=l}),collie.raphaelDashArray={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]}}(),collie.Effect=function(a){if(this instanceof arguments.callee)throw new Error("You can't create a instance of this");var b=/^(\-?[0-9\.]+)(%|px|pt|em)?$/,c=/^rgb\(([0-9]+)\s?,\s?([0-9]+)\s?,\s?([0-9]+)\)$/i,d=/^#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,e=/^#([0-9A-F])([0-9A-F])([0-9A-F])$/i,f=function(a){var f,g=a;return b.test(a)?(g=parseFloat(a),f=RegExp.$2||""):c.test(a)?(g=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)],f="color"):d.test(a=a.replace(e,"#$1$1$2$2$3$3"))&&(g=[parseInt(RegExp.$1,16),parseInt(RegExp.$2,16),parseInt(RegExp.$3,16)],f="color"),{nValue:g,sUnit:f}};return function(b,c){var d;if(arguments.length>1?(b=f(b),c=f(c),d=c.sUnit):(c=f(b),b=null,d=c.sUnit),b&&c&&b.sUnit!=c.sUnit)throw new Error("unit error");b=b&&b.nValue,c=c&&c.nValue;var e=function(e){var f=a(e),g=function(a,b){return(b-a)*f+a+d};if("color"==d){var h=Math.max(0,Math.min(255,parseInt(g(b[0],c[0]),10)))<<16;h|=Math.max(0,Math.min(255,parseInt(g(b[1],c[1]),10)))<<8,h|=Math.max(0,Math.min(255,parseInt(g(b[2],c[2]),10))),h=h.toString(16).toUpperCase();for(var i=0;6-h.length;i++)h="0"+h;return"#"+h}return g(b,c)};return null===b&&(e.setStart=function(a){if(a=f(a),a.sUnit!=d)throw new Error("unit eror");b=a.nValue}),e}},collie.Effect.linear=collie.Effect(function(a){return a}),collie.Effect.easeInSine=collie.Effect(function(a){return 1==a?1:-Math.cos(a*(Math.PI/2))+1}),collie.Effect.easeOutSine=collie.Effect(function(a){return Math.sin(a*(Math.PI/2))}),collie.Effect.easeInOutSine=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeInSine(0,1)(2*a):.5*collie.Effect.easeOutSine(0,1)(2*a-1)+.5}),collie.Effect.easeOutInSine=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeOutSine(0,1)(2*a):.5*collie.Effect.easeInSine(0,1)(2*a-1)+.5}),collie.Effect.easeInQuad=collie.Effect(function(a){return a*a}),collie.Effect.easeOutQuad=collie.Effect(function(a){return-(a*(a-2))}),collie.Effect.easeInOutQuad=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeInQuad(0,1)(2*a):.5*collie.Effect.easeOutQuad(0,1)(2*a-1)+.5}),collie.Effect.easeOutInQuad=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeOutQuad(0,1)(2*a):.5*collie.Effect.easeInQuad(0,1)(2*a-1)+.5}),collie.Effect.easeInCubic=collie.Effect(function(a){return Math.pow(a,3)}),collie.Effect.easeOutCubic=collie.Effect(function(a){return Math.pow(a-1,3)+1}),collie.Effect.easeInOutCubic=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeIn(0,1)(2*a):.5*collie.Effect.easeOut(0,1)(2*a-1)+.5}),collie.Effect.easeOutInCubic=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeOut(0,1)(2*a):.5*collie.Effect.easeIn(0,1)(2*a-1)+.5}),collie.Effect.easeInQuart=collie.Effect(function(a){return Math.pow(a,4)}),collie.Effect.easeOutQuart=collie.Effect(function(a){return-(Math.pow(a-1,4)-1)}),collie.Effect.easeInOutQuart=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeInQuart(0,1)(2*a):.5*collie.Effect.easeOutQuart(0,1)(2*a-1)+.5}),collie.Effect.easeOutInQuart=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeOutQuart(0,1)(2*a):.5*collie.Effect.easeInQuart(0,1)(2*a-1)+.5}),collie.Effect.easeInQuint=collie.Effect(function(a){return Math.pow(a,5)}),collie.Effect.easeOutQuint=collie.Effect(function(a){return Math.pow(a-1,5)+1}),collie.Effect.easeInOutQuint=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeInQuint(0,1)(2*a):.5*collie.Effect.easeOutQuint(0,1)(2*a-1)+.5}),collie.Effect.easeOutInQuint=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeOutQuint(0,1)(2*a):.5*collie.Effect.easeInQuint(0,1)(2*a-1)+.5}),collie.Effect.easeInCircle=collie.Effect(function(a){return-(Math.sqrt(1-a*a)-1)}),collie.Effect.easeOutCircle=collie.Effect(function(a){return Math.sqrt(1-(a-1)*(a-1))}),collie.Effect.easeInOutCircle=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeInCircle(0,1)(2*a):.5*collie.Effect.easeOutCircle(0,1)(2*a-1)+.5}),collie.Effect.easeOutInCircle=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeOutCircle(0,1)(2*a):.5*collie.Effect.easeInCircle(0,1)(2*a-1)+.5}),collie.Effect.easeInBack=collie.Effect(function(a){var b=1.70158;return 1==a?1:a/1*(a/1)*((1+b)*a-b)}),collie.Effect.easeOutBack=collie.Effect(function(a){var b=1.70158;return 0===a?0:(a=a/1-1)*a*((b+1)*a+b)+1}),collie.Effect.easeInOutBack=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeInBack(0,1)(2*a):.5*collie.Effect.easeOutBack(0,1)(2*a-1)+.5}),collie.Effect.easeInElastic=collie.Effect(function(a){var b,c=0,d=0;return 0===a?0:1==(a/=1)?1:(c||(c=.3),!d||1>d?(d=1,b=c/4):b=c/(2*Math.PI)*Math.asin(1/d),-(d*Math.pow(2,10*(a-=1))*Math.sin(2*(a-1)*Math.PI/c)))}),collie.Effect.easeOutElastic=collie.Effect(function(a){var b,c=0,d=0;return 0===a?0:1==(a/=1)?1:(c||(c=.3),!d||1>d?(d=1,b=c/4):b=c/(2*Math.PI)*Math.asin(1/d),d*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/c)+1)}),collie.Effect.easeInOutElastic=collie.Effect(function(a){var b,c=0,d=0;return 0===a?0:2==(a/=.5)?1:(c||(c=.3*1.5),!d||1>d?(d=1,b=c/4):b=c/(2*Math.PI)*Math.asin(1/d),1>a?-.5*d*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/c):d*Math.pow(2,-10*(a-=1))*Math.sin(2*(a-b)*Math.PI/c)*.5+1)}),collie.Effect.easeOutBounce=collie.Effect(function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}),collie.Effect.easeInBounce=collie.Effect(function(a){return 1-collie.Effect.easeOutBounce(0,1)(1-a)}),collie.Effect.easeInOutBounce=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeInBounce(0,1)(2*a):.5*collie.Effect.easeOutBounce(0,1)(2*a-1)+.5}),collie.Effect.easeInExpo=collie.Effect(function(a){return 0===a?0:Math.pow(2,10*(a-1))}),collie.Effect.easeOutExpo=collie.Effect(function(a){return 1==a?1:-Math.pow(2,-10*a/1)+1}),collie.Effect.easeInOutExpo=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeInExpo(0,1)(2*a):.5*collie.Effect.easeOutExpo(0,1)(2*a-1)+.5}),collie.Effect.easeOutInExpo=collie.Effect(function(a){return.5>a?.5*collie.Effect.easeOutExpo(0,1)(2*a):.5*collie.Effect.easeInExpo(0,1)(2*a-1)+.5}),collie.Effect._cubicBezier=function(a,b,c,d){return function(e){function f(a){return((l*a+k)*a+j)*a}function g(a){return((o*a+n)*a+m)*a}function h(a){return(3*l*a+2*k)*a+j}function i(a,b){var c,d,e,g,i,j;for(e=a,j=0;8>j;j++){if(g=f(e)-a,Math.abs(g)<b)return e;if(i=h(e),Math.abs(i)<1e-6)break;e-=g/i}if(c=0,d=1,e=a,c>e)return c;if(e>d)return d;for(;d>c;){if(g=f(e),Math.abs(g-a)<b)return e;a>g?c=e:d=e,e=.5*(d-c)+c}return e}var j=3*a,k=3*(c-a)-j,l=1-j-k,m=3*b,n=3*(d-b)-m,o=1-m-n;return g(i(e,.005))}},collie.Effect.cubicBezier=function(a,b,c,d){return collie.Effect(collie.Effect._cubicBezier(a,b,c,d))},collie.Effect.cubicEase=collie.Effect.cubicBezier(.25,.1,.25,1),collie.Effect.cubicEaseIn=collie.Effect.cubicBezier(.42,0,1,1),collie.Effect.cubicEaseOut=collie.Effect.cubicBezier(0,0,.58,1),collie.Effect.cubicEaseInOut=collie.Effect.cubicBezier(.42,0,.58,1),collie.Effect.cubicEaseOutIn=collie.Effect.cubicBezier(0,.42,1,.58),collie.Effect.overphase=collie.Effect(function(a){return a/=.652785,(Math.sqrt((2-a)*a)+.1*a).toFixed(5)}),collie.Effect.sinusoidal=collie.Effect(function(a){return-Math.cos(a*Math.PI)/2+.5}),collie.Effect.mirror=collie.Effect(function(a){return.5>a?collie.Effect.sinusoidal(0,1)(2*a):collie.Effect.sinusoidal(0,1)(1-2*(a-.5))}),collie.Effect.pulse=function(a){return collie.Effect(function(b){return-Math.cos(b*(a-.5)*2*Math.PI)/2+.5})},collie.Effect.wave=function(a,b){return collie.Effect(function(c){return(b||1)*Math.sin(360*a*c*Math.PI/180).toFixed(5)})},collie.Effect.easeIn=collie.Effect.easeInCubic,collie.Effect.easeOut=collie.Effect.easeOutCubic,collie.Effect.easeInOut=collie.Effect.easeInOutCubic,collie.Effect.easeOutIn=collie.Effect.easeOutInCubic,collie.Effect.bounce=collie.Effect.easeOutBounce,collie.Effect.elastic=collie.Effect.easeInElastic,collie.Component=collie.Class({$init:function(){this._bInitOption=!1,this._htOption={},this._htOptionSetter={},this._htHandler={}},option:function(a,b,c){if("object"==typeof a)if(this._bInitOption)for(var d in a)this.option(d,a[d],c);else this._htOption=collie.util.cloneObject(a),this._bInitOption=!0;else{if("string"!=typeof a)return this._htOption;if(void 0===b)return this._htOption[a];c&&"undefined"!=typeof this._htOption[a]||(this._htOption[a]=b,void 0!==this._htOptionSetter[a]&&this._htOptionSetter[a](b),this._bInitOption=!0)}},get:function(a){return this.option(a)},set:function(a,b,c){return this.option(a,b,c),this},unset:function(a){this._htOption&&"undefined"!=typeof this._htOption[a]&&delete this._htOption[a]},optionSetter:function(a,b){this._htOptionSetter[a]=b},fireEvent:function(a,b){if("undefined"!=typeof this._htHandler[a]&&this._htHandler[a].length>0){b=b||{},oCustomEvent=new collie.ComponentEvent(a,b);for(var c=this._htHandler[a].concat(),d=!1,e=0,f=c.length;f>e;e++)this._htHandler[a][e](oCustomEvent),oCustomEvent.isStop()&&(d=!0);if(d)return!1}return!0},attach:function(a,b){if("string"!=typeof a)for(var c in a)this.attach(c,a[c]);else{this._htHandler[a]=this._htHandler[a]||[];var d=this._htHandler[a];if(!b)return this;for(var c=0,e=d.length;e>c;c++)if(d[c]===b)return this;d.push(b)}return this},detach:function(a,b){if("string"!=typeof a)for(var c in a)this.detach(c,a[c]);else if(void 0!==this._htHandler[a]){var d=this._htHandler[a];if(b){for(var c=0,e=d.length;e>c;c++)if(d[c]===b){this._htHandler[a].splice(c,1),this._htHandler[a].length<1&&delete this._htHandler[a];break}}else delete this._htHandler[a]}},detachAll:function(a){a?void 0!==this._htHandler[a]&&(this._htHandler[a]=[]):this._htHandler={}}}),collie.ComponentEvent=collie.Class({$init:function(a,b){if(this.type=a,this._bCanceled=!1,b)for(var c in b)this[c]=b[c]},stop:function(){this._bCanceled=!0},isStop:function(){return this._bCanceled}}),collie.SpriteSheet=collie.Class({$init:function(){this._htSpriteSheet={}},add:function(a,b,c,d,e,f,g){if("object"==typeof b)if(b instanceof Array)for(var h=0,i=b.length;i>h;h++)this.add.apply(this,[a,h].concat(b[h]));else for(var h in b)this.add.apply(this,[a,h].concat(b[h]));else this._htSpriteSheet[a]=this._htSpriteSheet[a]||{},"undefined"!=typeof e?collie.ImageManager.getImage(a,function(h){this._addWithSpriteLength(h,a,b,c,d,e,f,g)}.bind(this)):this._htSpriteSheet[a][b]=[c,d]},_addWithSpriteLength:function(a,b,c,d,e,f,g,h){var j=this._htSpriteSheet[b][c]=[],k=a.width,l=a.height;collie.Renderer.isRetinaDisplay()&&(k/=2,l/=2);var m=d,n=e;for(i=0;h>i&&(m>=k&&(m=0,n+=g),!(n>=l));i++)j.push([m,n]),m+=f},remove:function(a){this._htSpriteSheet[a]&&delete this._htSpriteSheet[a]},get:function(a){return this._htSpriteSheet[a]?this._htSpriteSheet[a]:!1},reset:function(){this._htSpriteSheet={}}}),collie.ImageManager=collie.ImageManager||new(collie.Class({RETRY_COUNT:3,RETRY_DELAY:500,USE_PRERENDERING_DOM:!1,$init:function(){this._aImages=[],this._htImageNames={},this._htImageRetryCount={},this._htImageWhileLoading={},this._nCount=0,this._oSpriteSheet=new collie.SpriteSheet},_addImage:function(a,b){var c=this._aImages.push({element:a,name:b}),d=this._htImageNames[b];if(this._htImageNames[b]=c-1,delete this._htImageRetryCount[b],d&&d instanceof Array){for(var e=0,f=d.length;f>e;e++)d[e](a,b);d=null}this.fireEvent("process",{name:b,url:a.src,count:c,total:this._nCount,ratio:Math.round(c/this._nCount*1e3)/1e3}),this._nCount===c&&this.fireEvent("complete")},_markImage:function(a){this._htImageNames[a]||(this._htImageNames[a]=[]),this._htImageRetryCount[a]||(this._htImageRetryCount[a]=0)},_makeHash:function(){this._htImageNames={};for(var a=0,b=this._aImages.length;b>a;a++)this._htImageNames[this._aImages[a].name]=a},getImage:function(a,b){return a||0===a?(a in this._htImageNames||this._markImage(a),this._htImageNames[a]instanceof Array?b&&this._addMarkCallback(a,b):b?(b(this._aImages[this._htImageNames[a]].element),void 0):this._aImages[this._htImageNames[a]].element):!1},_addMarkCallback:function(a,b,c){if(a in this._htImageNames&&this._htImageNames[a]instanceof Array){if(c){var d=function e(b){b.name===a&&(c(),this.detach("error",e))};this.attach("error",d)}return b&&this._htImageNames[a].push(b),!0}return!1},removeImage:function(a){if(!(a in this._htImageNames))return!1;var b=this._aImages.splice(this._htImageNames[a],1);this._makeHash(),b.onload=null,b.onerror=null,b.src=null,b=null,this._oSpriteSheet.remove(a)},remove:function(a){this.removeImage(a)},add:function(){"object"==typeof arguments[0]?this.addImages.apply(this,arguments):this.addImage.apply(this,arguments)},addImages:function(a,b,c){var d=null,e=null,f=0,g=0,h=[];for(var i in a)f++;b&&null!==b&&(d=function(){g++,g>=f&&b(a)}.bind(this)),c&&null!==c&&(e=function(a,b,d){h.push([a,b,d]),h.length+g>=f&&c(h)}.bind(this));for(var i in a)this.addImage(i,a[i],d,e)},addImage:function(a,b,c,d){if(this.getImage(a))return c&&null!==c&&c(this.getImage(a),a,b),void 0;if(!(a in this._htImageWhileLoading&&this._addMarkCallback(a,c,d))){this._nCount++,this._markImage(a);var e=new Image;this.USE_PRERENDERING_DOM&&"dom"===collie.Renderer.getRenderingMode()&&collie.util.getSupportCSS3d()&&!collie.util.getDeviceInfo().android&&(e.style.webkitTransform="translateZ(0)",e.style.position="absolute",e.style.visibility="hidden",collie.Renderer.getElement().appendChild(e)),this._htImageWhileLoading[a]=e,e.onload=function(){this._addImage(e,a),c&&null!==c&&c(e,a,b),e.onerror=e.onload=null,this._deleteWhileLoading(a)}.bind(this),e.onerror=function(){return this._htImageRetryCount[a]<this.RETRY_COUNT?(this._htImageRetryCount[a]++,this.fireEvent("retry",{count:this._aImages.length,total:this._nCount,name:a,url:b,delay:this.RETRY_DELAY,retryCount:this._htImageRetryCount[a]}),setTimeout(function(){e.src="about:blank",e.src=b},this.RETRY_DELAY),void 0):(d&&null!==d&&d(e,a,b),this.fireEvent("error",{count:this._aImages.length,total:this._nCount,name:a,url:b}),e.onerror=e.onload=null,this._deleteWhileLoading(a),void 0)}.bind(this),e.src=b}},_deleteWhileLoading:function(a){delete this._htImageWhileLoading[a]},abort:function(){for(var a in this._htImageWhileLoading)this._htImageWhileLoading[a].onload=this._htImageWhileLoading[a].onerror=null,this._htImageWhileLoading[a].src=null,this._htImageWhileLoading[a]=null;this._htImageWhileLoading={},this._htImageStartedLoading={}},reset:function(){this.abort(),this._aImages=[],this._htImageNames={},this._htImageRetryCount={},this._htImageWhileLoading={},this._nCount=0,this._oSpriteSheet.reset()},cancelGetImage:function(a,b){if(this._htImageNames[a]instanceof Array)for(var c=0,d=this._htImageNames[a].length;d>c;c++)if(this._htImageNames[a][c]===b)return this._htImageNames[a].splice(c,1),void 0},addSprite:function(a,b,c,d){this._oSpriteSheet.add(a,b,c,d)},getSprite:function(a){return this._oSpriteSheet.get(a)},removeSprite:function(a){this._oSpriteSheet.remove(a)}},collie.Component)),collie.Matrix={multiple:function(a,b){for(var c=[],d=0,e=b.length;e>d;d++){for(var f=[],g=0,h=b[0].length;h>g;g++){for(var i=0,j=0,k=a[0].length;k>j;j++)i+=a[d][j]*b[j][g];f.push(i)}c.push(f)}return c},translate:function(a,b){return[[1,0,a],[0,1,b],[0,0,1]]},scale:function(a,b){return[[a,0,0],[0,b,0],[0,0,1]]},rotate:function(a){var b=collie.util.toRad(a),c=Math.cos(b),d=Math.sin(b);return[[c,-d,0],[d,c,0],[0,0,1]]},transform:function(a,b,c){var d=this.multiple(a,[[b],[c],[1]]);return{x:d[0][0],y:d[1][0]}}},collie.Transform={_htBoundary:{left:0,top:0,right:0,bottom:0},_bIsIEUnder8:collie.util.getDeviceInfo().ie&&collie.util.getDeviceInfo().ie<9,getBoundary:function(a,b){var c=a.get(),d=[[0,0],[c.width,0],[c.width,c.height],[0,c.height]],e=this.points(a,d),f=collie.util.getBoundary(e);return this._htBoundary.left=f.left,this._htBoundary.right=f.right,this._htBoundary.bottom=f.bottom,this._htBoundary.top=f.top,this._htBoundary.isTransform=this.isUseTransform(a),b&&(this._htBoundary.points=e),this._htBoundary},points:function(a,b){var c;if(this._bIsIEUnder8||(c=this.getMatrixRecusively(a)),!c)return b;for(var d=[],e=0,f=b.length;f>e;e++){var g=collie.Matrix.transform(c,b[e][0],b[e][1]);d.push([g.x,g.y])}return d},getMatrixRecusively:function(a){for(var b=a,c=null,d=0,e=0;b;){if(this.isUseTransform(b)){var f=this.getMatrix(b,d,e);c=null!==c?collie.Matrix.multiple(c,f):f}d-=b._htOption.x,e-=b._htOption.y,b=b.getParent()}return c},getMatrix:function(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0);var d=a.getOrigin(),e=a.get(),f=collie.Matrix.translate(d.x+b,d.y+c);return 0!==e.angle&&(f=collie.Matrix.multiple(f,collie.Matrix.rotate(e.angle))),(1!==e.scaleX||1!==e.scaleY)&&(f=collie.Matrix.multiple(f,collie.Matrix.scale(e.scaleX,e.scaleY))),f=collie.Matrix.multiple(f,collie.Matrix.translate(-(d.x+b),-(d.y+c)))},isUseTransform:function(a){return 1!==a._htOption.scaleX||1!==a._htOption.scaleY||0!==a._htOption.angle}},collie.LayerCanvas=collie.Class({$init:function(a){this._oLayer=a,this._oEvent=a.getEvent(),this._htDeviceInfo=collie.util.getDeviceInfo(),this._initCanvas()},_initCanvas:function(){var a=this._getLayerSize();this._elCanvas=document.createElement("canvas"),this._elCanvas.width=a.width,this._elCanvas.height=a.height,this._elCanvas.className="_collie_layer",this._elCanvas.style.position="absolute",this._elCanvas.style.left=this._oLayer.option("x")+"px",this._elCanvas.style.top=this._oLayer.option("y")+"px",collie.Renderer.isRetinaDisplay()&&(this._elCanvas.style.width=a.width/2+"px",this._elCanvas.style.height=a.height/2+"px"),this._oContext=this._elCanvas.getContext("2d")},_getLayerSize:function(a,b){return a=a||this._oLayer.option("width"),b=b||this._oLayer.option("height"),collie.Renderer.isRetinaDisplay()&&(a*=2,b*=2),{width:a,height:b}},getContext:function(){return this._oContext},getElement:function(){return this._elCanvas},clear:function(a){a=a||this.getContext(),!this._htDeviceInfo.android||this._htDeviceInfo.android<4.12&&this._htDeviceInfo.android>=4.2?a.clearRect(0,0,this._elCanvas.width+1,this._elCanvas.height+1):this._elCanvas.width=this._elCanvas.width},resize:function(a,b,c){var d=this._getLayerSize(a,b);if(c){this._elCanvas.style.width=a+"px",this._elCanvas.style.height=b+"px";var e=a/this._oLayer.option("width"),f=b/this._oLayer.option("height");this._oEvent.setEventRatio(e,f)}else{var g="number"==typeof a?d.width:this._elCanvas.width,h="number"==typeof b?d.height:this._elCanvas.height;this.clear(this._oContext),this._oLayer.setChanged(),this._elCanvas.width=g,this._elCanvas.height=h,collie.Renderer.isRetinaDisplay()&&(this._elCanvas.style.width=g/2+"px",this._elCanvas.style.height=h/2+"px")}}}),collie.LayerDOM=collie.Class({$init:function(a){this._oLayer=a,this._oEvent=a.getEvent(),this._htOption=a.option(),this._initElement(),this._rxDisplayObjectId=new RegExp(collie.DisplayObjectDOM.ID+"([0-9]+)")},_initElement:function(){this._el=document.createElement("div"),this._el.className="_collie_layer",this._el.style.position="absolute",this._el.style.left=this._htOption.x+"px",this._el.style.top=this._htOption.y+"px",this._el.style.width=this._htOption.width+"px",this._el.style.height=this._htOption.height+"px",this._el.style.overflow="hidden"},findDisplayObjectElement:function(a){for(;a&&1==a.nodeType;){if(this.isDisplayObjectElement(a)&&a.parentNode===this._el)return a;a=a.parentNode}return!1},isDisplayObjectElement:function(a){return"classList"in a?a.classList.contains(collie.DisplayObjectDOM.CLASSNAME):(" "+a.className+" ").indexOf(" "+collie.DisplayObjectDOM.CLASSNAME+" ")>-1},getElement:function(){return this._el},clear:function(){return!0},resize:function(a,b,c){if(c){var d=parseFloat(a/this._oLayer.option("width")).toFixed(2),e=parseFloat(b/this._oLayer.option("height")).toFixed(2);this._oEvent.setEventRatio(d,e),this._el.style[collie.util.getCSSPrefix("transform-origin",!0)]="0 0",collie.util.getSupportCSS3d()?this._el.style[collie.util.getCSSPrefix("transform",!0)]="scale3d("+d+", "+e+", 1)":collie.util.getSupportCSS3()?this._el.style[collie.util.getCSSPrefix("transform",!0)]="scale("+d+", "+e+")":this._el.style.filter="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand',M11="+d+",M12=0,M21=0,M22="+e+");"}else this._el.style.width=a+"px",this._el.style.height=b+"px"}}),collie.LayerEvent=collie.Class({THRESHOLD_CLICK:7,$init:function(a){this._oLayer=a,this._bHasTouchEvent=!!("ontouchstart"in window),this._fOnEvent=this._onEvent.bind(this),this._oMousedownObject=null,this._htEventRatio={width:1,height:1},this._bAttached=!1},attachEvent:function(){var a=this._oLayer.getParent();this._bHasTouchEvent?(collie.util.addEventListener(a,"touchstart",this._fOnEvent),collie.util.addEventListener(a,"touchend",this._fOnEvent),collie.util.addEventListener(a,"touchmove",this._fOnEvent),collie.util.addEventListener(a,"touchcancel",this._fOnEvent)):(collie.util.addEventListener(a,"mousedown",this._fOnEvent),collie.util.addEventListener(a,"mouseup",this._fOnEvent),collie.util.addEventListener(a,"mousemove",this._fOnEvent)),this._bAttached=!0},detachEvent:function(){var a=this._oLayer.getParent();this._bAttached&&(this._bHasTouchEvent?(collie.util.removeEventListener(a,"touchstart",this._fOnEvent),collie.util.removeEventListener(a,"touchend",this._fOnEvent),collie.util.removeEventListener(a,"touchmove",this._fOnEvent),collie.util.removeEventListener(a,"touchcancel",this._fOnEvent)):(collie.util.removeEventListener(a,"mousedown",this._fOnEvent),collie.util.removeEventListener(a,"mouseup",this._fOnEvent),collie.util.removeEventListener(a,"mousemove",this._fOnEvent)),this._bAttached=!1)},_onEvent:function(a){if(this._oLayer._htOption.useEvent){a=a||window.event;var b=this._bHasTouchEvent?a.changedTouches[0]:a||window.event,c=this._bHasTouchEvent?this._getEventTargetElement(a):a.target||a.srcElement,d=c.ownerDocument||document,e=d.body||d.documentElement,f=this._bHasTouchEvent?b.pageX:b.pageX||b.clientX+e.scrollLeft-d.body.clientLeft,g=this._bHasTouchEvent?b.pageY:b.pageY||b.clientY+e.scrollTop-d.body.clientTop,h=a.type,i=this._oLayer.getParentPosition(),j=f-i.x-this._oLayer._htOption.x,k=g-i.y-this._oLayer._htOption.y;
j/=this._htEventRatio.width,k/=this._htEventRatio.height,"touchcancel"===h&&null!==this._htEventStartPos&&(j=this._htEventStartPos.x,k=this._htEventStartPos.y),h=this._convertEventType(h),("mousemove"===h||"mousedown"===h)&&collie.Renderer.isPreventDefault()&&collie.util.stopEventDefault(a),"mousedown"===h&&(this._htEventStartPos={x:j,y:k});var l=this._fireEvent(a,h,j,k);if("mouseup"===h){var m=this.THRESHOLD_CLICK,n=this.THRESHOLD_CLICK;this._htEventStartPos&&this._htEventStartPos.x-m<=j&&j<=this._htEventStartPos.x+m&&this._htEventStartPos.y-n<=k&&k<=this._htEventStartPos.y+n&&this._fireEvent(a,"click",j,k),this._htEventStartPos=null}collie.Renderer.setEventStatus(h,l)}},_fireEvent:function(a,b,c,d){var e=null,f=!0;if("mousemove"!==b&&!collie.Renderer.isStopEvent(b)){var g=this._oLayer.getChildren();e=this._getTargetOnHitEvent(g,c,d),e&&(f=this._bubbleEvent(e,b,a,c,d),"mousedown"===b&&this._setMousedownObject(e),"mouseup"===b&&this._unsetMousedownObject(e))}return"mouseup"===b&&null!==this._getMousedownObject()&&(e=this._getMousedownObject(),this._bubbleEvent(e,b,a,c,d),this._unsetMousedownObject(e)),f&&this._oLayer.fireEvent(b,{event:a,displayObject:e,x:c,y:d}),!!e},_getTargetOnHitEvent:function(a,b,c){var d=null;if(!(a instanceof Array))return this._isPointInDisplayObjectBoundary(a,b,c)?a:!1;for(var e=a.length-1;e>=0;e--){if(a[e].hasChild()&&(d=this._getTargetOnHitEvent(a[e].getChildren(),b,c)))return d;if(d=this._getTargetOnHitEvent(a[e],b,c))return d}},_convertEventType:function(a){var b=a;switch(a){case"touchstart":b="mousedown";break;case"touchmove":b="mousemove";break;case"touchend":case"touchcancel":b="mouseup";break;case"tap":b="click"}return b},_getEventTargetElement:function(a){for(var b=a.target;1!=b.nodeType;)b=b.parentNode;return b},_bubbleEvent:function(a,b,c,d,e,f){return a.fireEvent(b,{displayObject:f||a,event:c,x:d,y:e})===!1?!1:a.getParent()&&!this._bubbleEvent(a.getParent(),b,c,d,e,a)?!1:!0},_isPointInDisplayObjectBoundary:function(a,b,c){if(!a._htOption.useEvent||!a._htOption.visible||!a._htOption.width||!a._htOption.height||"auto"===a._htOption.useEvent&&!a.hasAttachedHandler())return!1;var d=a.getHitAreaBoundary();if(d.left<=b&&b<=d.right&&d.top<=c&&c<=d.bottom){if(a._htOption.hitArea){var e=a.getRelatedPosition();b-=e.x,c-=e.y;var f=a._htOption.hitArea;return f=collie.Transform.points(a,f),this._isPointInPolygon(f,b,c)}return!0}return!1},_isPointInPolygon:function(a,b,c){for(var d=!1,e=0,f=a.length-1,g=a.length;g>e;f=e++)a[e][1]>c!=a[f][1]>c&&b<(a[f][0]-a[e][0])*(c-a[e][1])/(a[f][1]-a[e][1])+a[e][0]&&(d=!d);return d},_setMousedownObject:function(a){this._oMousedownObject=a},_unsetMousedownObject:function(a){this._oMousedownObject===a&&(this._oMousedownObject=null)},_getMousedownObject:function(){return this._oMousedownObject},setEventRatio:function(a,b){this._htEventRatio.width=a||this._htEventRatio.width,this._htEventRatio.height=b||this._htEventRatio.height},getEventRatio:function(){return this._htEventRatio}}),collie.Layer=collie.Class({type:"layer",$init:function(a){this.option({x:0,y:0,width:320,height:480,useEvent:!0,visible:!0,freeze:!1,renderingMode:"inherit"}),this._sAlignLeft=null,this._sAlignTop=null,void 0!==a&&("x"in a&&("left"===a.x||"right"===a.x||"center"===a.x)&&(this._sAlignLeft=a.x,a.x=0),"y"in a&&("top"===a.y||"bottom"===a.y||"center"===a.y)&&(this._sAlignTop=a.y,a.y=0),this.option(a)),this._renderingMode="inherit"===this._htOption.renderingMode?collie.Renderer.getRenderingMode():this._htOption.renderingMode,"canvas"!==this._renderingMode||collie.util.getDeviceInfo().supportCanvas||(this._renderingMode="dom"),this.drawCount=0,this.optionSetter("visible",this._setVisible.bind(this)),this._elParent=null,this._bChanged=!1,this._aDisplayObjects=[],this._bLoaded=!1,this._oEvent=new collie.LayerEvent(this),this._makeDrawing(),this._setVisible()},_makeDrawing:function(){this._oDrawing="dom"===this._renderingMode?new collie.LayerDOM(this):new collie.LayerCanvas(this)},getDrawing:function(){return this._oDrawing},getRenderingMode:function(){return this._renderingMode},getEvent:function(){return this._oEvent},getParent:function(){return this._elParent||!1},load:function(a,b){this.unload(),this._bLoaded=!0,this._elParent=this._elParent||a,this._elParent.style.width=Math.max(parseInt(this._elParent.style.width||0,10),this.option("width"))+"px",this._elParent.style.height=Math.max(parseInt(this._elParent.style.height||0,10),this.option("height"))+"px",this.getElement().style.zIndex=b,null!==this._sAlignLeft&&this.offset(this._sAlignLeft,null,!0),null!==this._sAlignTop&&this.offset(null,this._sAlignTop,!0),this._elParent.appendChild(this.getElement())},unload:function(){this.isLoaded()&&(this._oEvent.detachEvent(),this._elParent.removeChild(this.getElement()),this._elParent=null,this._bLoaded=!1)},attachEvent:function(){this._oEvent.attachEvent()},detachEvent:function(){this._oEvent.detachEvent()},_setVisible:function(){this.getElement()&&(this.getElement().style.display=this.option("visible")?"block":"none")},isLoaded:function(){return this._bLoaded},addChild:function(a){collie.util.pushWithSort(this._aDisplayObjects,a),a.setLayer(this),this.setChanged()},addChildren:function(a){for(var b=0,c=a.length;c>b;b++)this.addChild(a[b])},removeChild:function(a,b){if(a.unsetLayer(),"undefined"!=typeof b)this._aDisplayObjects.splice(b,1);else for(var c=0,d=this._aDisplayObjects.length;d>c;c++)if(this._aDisplayObjects[c]===a){this._aDisplayObjects.splice(c,1);break}this.setChanged()},removeChildren:function(a){for(var b=a.length-1;b>=0;b--)a[b]&&this.removeChild(a[b],b)},addTo:function(a){return a=a||collie.Renderer,a.addLayer(this),this},changeDisplayObjectZIndex:function(a){this.removeChild(a),this.addChild(a)},getChildren:function(){return this._aDisplayObjects},hasChild:function(){return this._aDisplayObjects&&this._aDisplayObjects.length>0},setChanged:function(){this._bChanged=!0},isChanged:function(){return this._bChanged},unsetChanged:function(){this._bChanged=!1},getContext:function(){return"getContext"in this._oDrawing?this._oDrawing.getContext():!1},getElement:function(){return"getElement"in this._oDrawing?this._oDrawing.getElement():!1},update:function(a){if(this.drawCount=0,this.isChanged()&&!this.option("freeze")){this.clear(),this.unsetChanged();for(var b=this.option("width"),c=this.option("height"),d=0,e=this._aDisplayObjects.length;e>d;d++)this._aDisplayObjects[d].update(a,0,0,b,c)}},clear:function(){this._oDrawing.clear()},resize:function(a,b,c){c||(this.option("width",a||this._htOption.width),this.option("height",b||this._htOption.height)),this._oDrawing&&this._oDrawing.resize(a,b,c),this._elParent&&(this._elParent.style.width=Math.max(parseInt(this._elParent.style.width||0,10),a||this.option("width"))+"px",this._elParent.style.height=Math.max(parseInt(this._elParent.style.height||0,10),b||this.option("height"))+"px"),this.fireEvent("resize")},offset:function(a,b,c){var d=this.getElement();if("undefined"!=typeof a&&null!==a){switch(a){case"left":a=0;break;case"right":a=parseInt(this._elParent.style.width,10)-this._htOption.width;break;case"center":a=parseInt(this._elParent.style.width,10)/2-this._htOption.width/2}this.option("x",a),d.style.left=a+"px",c||(this._sAlignLeft=null)}if("undefined"!=typeof b&&null!==b){switch(b){case"top":b=0;break;case"bottom":b=parseInt(this._elParent.style.height,10)-this._htOption.height;break;case"center":b=parseInt(this._elParent.style.height,10)/2-this._htOption.height/2}this.option("y",b),d.style.top=b+"px",c||(this._sAlignTop=null)}},setParent:function(a){"string"==typeof a&&(a=document.getElementById(a)),this._bLoaded?(this._oEvent.detachEvent(),this._elParent.removeChild(this.getElement()),this._elParent=a,this._elParent.appendChild(this.getElement()),this._oEvent.attachEvent()):this._elParent=a},getParentPosition:function(){return null!==this._elParent?this._elParent===collie.Renderer.getElement()?collie.Renderer.getPosition():collie.util.getPosition(this._elParent):void 0},clone:function(a){var b=new this.constructor(this._htOption);if(a&&this._aDisplayObjects.length)for(var c=0,d=this._aDisplayObjects.length;d>c;c++)this._aDisplayObjects[c].clone(!0).addTo(b);return b}},collie.Component),collie.DisplayObjectCanvas=collie.Class({$init:function(a){this._oDisplayObject=a,this._bUseCache=!1,this._oDebugHitArea=null,this._htEvent={},this._oLayer=null,this._htInfo=this._oDisplayObject.get(),this._bIsRetinaDisplay=null,this._htInfo.useCache&&this.loadCache()},loadCache:function(){this._bUseCache||(this._bUseCache=!0,this._elCache=document.createElement("canvas"),this._elCache.width=this._htInfo.width,this._elCache.height=this._htInfo.height,this._oContextCache=this._elCache.getContext("2d"))},unloadCache:function(){this._bUseCache&&(this._oContextCache=null,this._elCache=null,this._bUseCache=!1)},clearCache:function(){this._bUseCache&&(this._oContextCache.clearRect(0,0,this._elCache.width,this._elCache.height),this._elCache.width=this._htInfo.width*(this._bIsRetinaDisplay?2:1),this._elCache.height=this._htInfo.height*(this._bIsRetinaDisplay?2:1))},drawImage:function(a,b,c,d,e,f,g,h,j){var k=this._oDisplayObject.getImage(),l=this._oDisplayObject._nImageWidth,m=this._oDisplayObject._nImageHeight;if(collie.Renderer.isRetinaDisplay()){for(i=1,len=arguments.length;len>i;i++)arguments[i]*=2;l*=2,m*=2}try{a.drawImage(k,b,c,d,e,f,g,h,j)}catch(n){throw new Error("invalid drawImage value : "+b+","+c+","+d+","+e+","+f+","+g+","+h+","+j+","+this._oDisplayObject.getImage().src+", original : "+this._oDisplayObject.getImage().width+","+this._oDisplayObject.getImage().height+",source : "+k.width+","+k.height+", isCached : "+(null!==this._elImageCached?"true":"false"))}},load:function(){this._oLayer=this._oDisplayObject.getLayer(),this._oContext=this._oDisplayObject.getLayer().getContext(),this._bIsRetinaDisplay=collie.Renderer.isRetinaDisplay()},unload:function(){this._oLayer=null,this._oContext=null},draw:function(a,b,c,d,e,f){var g=f?!0:!1;f=f||this._oContext;var h=this._bUseCache?this._oContextCache:f,i=f,j=this._htInfo,k=(this._oDisplayObject.getDirty(),this._oDisplayObject.getOrigin()),l=j.width,m=j.height,n=k.x,o=k.y,p=b,q=c,r=this._bIsRetinaDisplay?2:1,s=0,t=!1,u=f;if(j.useCache&&(f=this._oContextCache),this._bIsRetinaDisplay&&(b*=2,c*=2,n*=2,o*=2,l*=2,m*=2),(this._bUseCache||1!==j.scaleX||1!==j.scaleY||0!==j.angle||1!==j.opacity)&&(t=!0,this._bUseCache&&(u=g?i:this._oContext),u.save(),u.translate(b+n,c+o),1!==j.opacity&&(s=u.globalAlpha,u.globalAlpha=0===u.globalAlpha?j.opacity:u.globalAlpha*j.opacity),0!==j.angle&&u.rotate(collie.util.toRad(j.angle)),(1!==j.scaleX||1!==j.scaleY)&&u.scale(j.scaleX,j.scaleY),u.translate(-n,-o),b=c=0),this._htEvent.displayObject=this,this._htEvent.context=h,this._htEvent.x=b,this._htEvent.y=c,!this._bUseCache||this._oDisplayObject.isChanged()&&!this._oDisplayObject.isChanged(!0)){if(this.clearCache(),j.backgroundColor&&(h.fillStyle=j.backgroundColor,h.fillRect(b,c,l,m)),this._oDisplayObject.getImage()){var v=(this._oDisplayObject.getImage(),this._oDisplayObject.getImageSize());if(j.backgroundRepeat&&"no-repeat"!==j.backgroundRepeat){var w="repeat"===j.backgroundRepeat||"repeat-x"===j.backgroundRepeat?Math.ceil(j.width/v.width):1,x="repeat"===j.backgroundRepeat||"repeat-y"===j.backgroundRepeat?Math.ceil(j.height/v.height):1;if(w>0||x>0)for(var y=0;w>y;y++)for(var z=0;x>z;z++){var A=y*v.width+v.width,B=z*v.height+v.height,C=A>j.width?v.width-(A-j.width):v.width,D=B>j.height?v.height-(B-j.height):v.height;this.drawImage(h,0,0,C,D,b/r+y*v.width,c/r+z*v.height,C,D)}}else{var E=Math.min(v.width,j.width),F=Math.min(v.height,j.height);this.drawImage(h,j.offsetX,j.offsetY,j.fitImage?v.width:E,j.fitImage?v.height:F,b/r,c/r,j.fitImage?j.width:E,j.fitImage?j.height:F)}}"onCanvasDraw"in this._oDisplayObject&&this._oDisplayObject.onCanvasDraw(this._htEvent)}if(j.debugHitArea&&j.hitArea&&null===this._oDebugHitArea&&(this._oDebugHitArea=new collie.Polyline({x:0,y:0,width:j.width,height:j.height,strokeColor:j.debugHitArea===!0?"yellow":j.debugHitArea,strokeWidth:3}).addTo(this._oDisplayObject),this._oDebugHitArea.setPointData(j.hitArea)),this._oDisplayObject.hasChild()&&(!j.useCache||this._oDisplayObject.isChanged()&&!this._oDisplayObject.isChanged(!0)))for(var G=this._oDisplayObject.getChildren(),H=0,I=G.length;I>H;H++)G[H].update(a,j.useCache||t?0:p,j.useCache||t?0:q,d,e,g||j.useCache?f:null),G[H].unsetChanged(),G[H]._resetDirty();j.useCache&&(g?i:this._oContext).drawImage(f.canvas,0,0),this._oLayer.drawCount++,t&&u.restore()}}),collie.DisplayObjectDOM=collie.Class({$init:function(a){this._oDisplayObject=a,this._htInfo=this._oDisplayObject.get(),this._oLayer=null,this._elImage=null,this._aTransformValue=[],this._sTransformValue=null,this._sTransform=collie.util.getCSSPrefix("transform",!0),this._sOrigin=collie.util.getCSSPrefix("transform-origin",!0),this._bSupportCSS3=collie.util.getSupportCSS3(),this._bSupportCSS3d=collie.util.getSupportCSS3d(),this._bUseTransform=this._bSupportCSS3||this._bSupportCSS3d,this._htDeviceInfo=collie.util.getDeviceInfo(),this._bIsAndroid=!!this._htDeviceInfo.android,this._nAndroidVersion=this._htDeviceInfo.android,this._bIsIEUnder8=this._htDeviceInfo.ie&&this._htDeviceInfo.ie<9,this._bUseTranslateZ=!0,this._bIsRetinaDisplay=null,this._htEvent={},this._oEmptyObject={},this._sCacheTransformValue=null,this._initElement()},_initElement:function(){this._elContainer=document.createElement("div"),this._elContainer.id=collie.DisplayObjectDOM.ID+this._oDisplayObject.getId()+(this._htInfo.name?"_"+this._htInfo.name:""),this._elContainer.className=collie.DisplayObjectDOM.CLASSNAME,this._elContainerStyle=this._elContainer.style,this._elContainerStyle.position="absolute",this._bIsIEUnder8&&(this._elContainerStyle.width=this._htInfo.width+"px",this._elContainerStyle.height=this._htInfo.height+"px"),this._el=document.createElement("div"),this._elStyle=this._el.style,this._bSupportCSS3d&&(this._elStyle[this._sTransform]="translateZ(0)"),this._elStyle.position="absolute",this._elStyle.width=this._htInfo.width+"px",this._elStyle.height=this._htInfo.height+"px",this._elStyle.overflow="hidden",this._elContainer.appendChild(this._el)},load:function(){this._oLayer=this._oDisplayObject.getLayer(),this._oDisplayObject.getParent()?this._oDisplayObject.getParent().getDrawing().getElement().appendChild(this._elContainer):this._oLayer.getElement().appendChild(this._elContainer),this._bIsRetinaDisplay=collie.Renderer.isRetinaDisplay()},unload:function(){this._oLayer=null,this._elContainer.parentNode.removeChild(this._elContainer)},getElement:function(){return this._elContainer},getItemElement:function(){return this._el},draw:function(a,b,c){this._htEvent.displayObject=this,this._htEvent.element=this._el,this._htEvent.x=b,this._htEvent.y=c;{var d=this._htInfo,e=this._oDisplayObject.getDirty()||this._oEmptyObject,f=this._oDisplayObject.getOrigin();this._bIsRetinaDisplay?2:1}e.visible&&(this._elContainerStyle.display=d.visible?"block":"none"),e.width&&(this._elStyle.width=d.width+"px",this._bIsIEUnder8&&(this._elContainerStyle.width=d.width+"px")),e.height&&(this._elStyle.height=d.height+"px"),e.opacity&&(this._bIsIEUnder8?this._elContainerStyle.filter="alpha(opacity="+100*d.opacity+")":(this._elContainerStyle.opacity=d.opacity,this._elImage&&this._nAndroidVersion&&this._nAndroidVersion>=4.1&&(this._elImage.style.opacity=d.opacity))),e.zIndex&&(this._elContainerStyle.zIndex=d.zIndex),e.backgroundColor&&(this._elStyle.backgroundColor=d.backgroundColor),this._bUseTransform?this._aTransformValue.push(this._makeTranslate(d.x,d.y,d.zIndex)):(e.x||e.y)&&(this._elContainerStyle.left=d.x+"px",this._elContainerStyle.top=d.y+"px"),this._bUseTransform&&((e.originX||e.originY||e.width||e.height)&&(this._elContainerStyle[this._sOrigin]=f.x+"px "+f.y+"px"),0!==d.angle&&this._aTransformValue.push("rotate",this._bSupportCSS3d&&!this._bIsAndroid?"Z":"","(",d.angle,"deg) "),(1!==d.scaleX||1!==d.scaleY)&&this._aTransformValue.push("scale(",d.scaleX,", ",d.scaleY,") ")),this._bUseTransform&&this._applyTransform(),this._drawImage(d,e),"onDOMDraw"in this._oDisplayObject&&this._oDisplayObject.onDOMDraw(this._htEvent),this._oLayer.drawCount++},_drawImage:function(a,b){var c=this._oDisplayObject.getImage(),d=a.backgroundRepeat&&"no-repeat"!==a.backgroundRepeat,e=0,f=0;if(this._oDisplayObject._htOption.fitImage)e=this._oDisplayObject._htOption.width,f=this._oDisplayObject._htOption.height;else{var g=this._oDisplayObject.getImageSize();e=g.width,f=g.height}if((b.backgroundImage||b.backgroundRepeat)&&(null!==this._elImage&&(!a.backgroundImage||a.backgroundRepeat&&"no-repeat"!==a.backgroundRepeat)&&(this._el.removeChild(this._elImage),this._elImage=null),a.backgroundImage&&c))if(!d&&a.backgroundImage){var h;null===this._elImage?(this._elImage=c.cloneNode(),h=this._elImage.style,h.position="absolute",h.top=0,h.left=0,h.width=e+"px",h.height=f+"px",h.visibility="visible",this._nAndroidVersion&&this._nAndroidVersion>=4.1&&(h.opacity=a.opacity),this._bSupportCSS3d&&this._bUseTranslateZ&&(h[this._sTransform]="translateZ(0)"),this._el.hasChildNodes()?this._el.insertBefore(this._elImage,this._el.childNodes[0]):this._el.appendChild(this._elImage)):(this._elImage.src=c.src,h=this._elImage.style,h.width=e+"px",h.height=f+"px",h.visibility="visible")}else d&&(this._elStyle.backgroundImage='url("'+c.src+'")',this._elStyle.backgroundRepeat=a.backgroundRepeat);a.backgroundImage&&null!==this._elImage&&(this._bIsRetinaDisplay&&d&&(b.width||htDirth.height||b.backgroundRepeat||b.backgroundImage)&&(this._elStyle.backgroundSize=a.width+"px "+a.height+"px"),(b.offsetX||b.offsetY)&&(this._bUseTransform?this._elImage.style[this._sTransform]=this._makeTranslate(-a.offsetX,-a.offsetY,1):(this._elImage.style.left=-a.offsetX+"px",this._elImage.style.top=-a.offsetY+"px")))},_makeTranslate:function(a,b,c){var d="",e=0!==this._htInfo.angle&&this._bIsAndroid?!1:this._bSupportCSS3d;return e?d="translate3d("+a+"px, "+b+"px, "+c+"px) ":this._bSupportCSS3&&(d="translate("+a+"px, "+b+"px) "),d},_applyTransform:function(){var a=this._aTransformValue.join("");this._sCacheTransformValue!==a&&(this._elContainerStyle[this._sTransform]=a,this._sCacheTransformValue=a,this._bIsAndroid&&this._bUseTranslateZ&&0!==this._htInfo.angle?(this._elStyle[this._sTransform]="",this._elImage&&this._oDisplayObject.setChanged(),this._bUseTranslateZ=!1):this._bUseTranslateZ||0!==this._htInfo.angle&&this._bIsAndroid||!this._bSupportCSS3d||(this._elStyle[this._sTransform]="translateZ(0)",this._elImage&&this._oDisplayObject.setChanged(),this._bUseTranslateZ=!0)),this._aTransformValue=[]}},collie.Component),collie.DisplayObjectDOM.CLASSNAME="_collie_displayObject",collie.DisplayObjectDOM.ID="_collie_displayObject_",collie.DisplayObject=collie.Class({type:"displayobject",$init:function(a){this._bInitOption=!0,this._htOption={name:"",width:"auto",height:"auto",x:0,y:0,zIndex:0,opacity:1,angle:0,scaleX:1,scaleY:1,originX:"center",originY:"center",offsetX:0,offsetY:0,spriteX:null,spriteY:null,spriteLength:0,spriteSheet:null,rangeX:null,rangeY:null,positionRepeat:!1,backgroundColor:"",backgroundImage:"",backgroundRepeat:"no-repeat",hitArea:null,debugHitArea:!1,useCache:!1,useEvent:"auto",fitImage:!1,velocityX:0,velocityY:0,velocityRotate:0,forceX:0,forceY:0,forceRotate:0,mass:1,friction:0,useRealTime:!0,visible:!0},a&&this.option(a),this._htDirty={},this._htMatrix={},this._sId=++collie.DisplayObject._idx,this._elImage=null,this._aDisplayObjects=[],this._oLayer=null,this._oParent=null,this._oDrawing=null,this._bIsSetOption=!1,this._bChanged=!0,this._bChangedTransforms=!0,this._bCustomSize=!1,this._aChangedQueue=null,this._htGetImageData=null,this._htRelatedPosition={},this._htParentRelatedPosition={},this._htBoundary={},this._sRenderingMode=null,this._bRetinaDisplay=collie.Renderer.isRetinaDisplay(),this._oTimerMove=null,this._nPositionRight=null,this._nPositionBottom=null,this._nImageWidth=0,this._nImageHeight=0,this._htImageSize=null,this._htSpriteSheet=null,this._htOrigin={x:0,y:0},this.set(this._htOption),this._bIsSetOption=!0},set:function(a,b,c,d){if("object"==typeof a)for(var e in a)this.set(e,a[e]);else{if(this._bIsSetOption&&this._htOption[a]===b)return;("width"===a||"height"===a)&&("auto"!==b?this._bCustomSize=!0:b="auto"===b&&null!==this.getImage()?this.getImageSize()[a]:100),this._htOption[a]=b,this.setDirty(a),c||this._setter(a,b),d||this.setChanged("x"===a||"y"===a||"angle"===a||"scaleX"===a||"scaleY"===a||"opacity"===a?!0:!1)}return this},_setter:function(a,b){"zIndex"===a&&(this._oParent?this._oParent.changeDisplayObjectZIndex(this):this.getLayer()&&this._oLayer.changeDisplayObjectZIndex(this)),("x"===a||"y"===a)&&("string"==typeof b&&this.align("x"===a?b:!1,"y"===a?b:!1),this._fixPosition(),this.resetPositionCache()),"backgroundImage"===a&&this.setImage(b),("spriteX"===a||"spriteY"===a||"spriteSheet"===a)&&this._setSpritePosition(a,b),("width"===a||"height"===a)&&(null!==this._htOption.spriteX&&this._setSpritePosition("spriteX",this._htOption.spriteX),null!==this._htOption.spriteY&&this._setSpritePosition("spriteY",this._htOption.spriteY)),"hitArea"===a&&b instanceof Array&&this._makeHitAreaBoundary(),("width"===a||"height"===a||"originX"===a||"originY"===a)&&this._setOrigin(),"backgroundRepeat"===a&&"no-repeat"!==b&&this.set("useCache",!0),"useCache"===a&&null!==this._oDrawing&&this._oDrawing.loadCache&&(b?this._oDrawing.loadCache():this._oDrawing.unloadCache())},get:function(a){return a?this._htOption[a]:this._htOption},setDirty:function(a){if(null===this._htDirty&&(this._htDirty={}),"undefined"==typeof a)for(var b in this._htOption)this._htDirty[b]=!0;else this._htDirty[a]=!0},getDirty:function(a){return a?this._htDirty[a]?!0:!1:this._htDirty},_resetDirty:function(){this._htDirty=null},addChild:function(a){collie.util.pushWithSort(this._aDisplayObjects,a),a.setParent(this),null!==this._oLayer&&a.setLayer(this._oLayer),this.setChanged()},removeChild:function(a,b){if("undefined"!=typeof b)this._aDisplayObjects[b].unsetLayer(),this._aDisplayObjects[b].unsetParent(),this._aDisplayObjects.splice(b,1);else for(var c=0,d=this._aDisplayObjects.length;d>c;c++)if(this._aDisplayObjects[c]===a){this._aDisplayObjects[c].unsetLayer(),this._aDisplayObjects[c].unsetParent(),this._aDisplayObjects.splice(c,1);break}this.setChanged()},changeDisplayObjectZIndex:function(a){this.removeChild(a),this.addChild(a)},addTo:function(a){if(this._oLayer||this._oParent){if(this._oLayer===a||this._oParent===a)return this;this.leave()}return a.addChild(this),this},hasChild:function(){return this._aDisplayObjects.length>0},getChildren:function(){return this._aDisplayObjects},getParent:function(){return this._oParent||!1},setParent:function(a){this._oParent=a},unsetParent:function(){this._oParent=null},leave:function(){var a=null;return null!==this._oParent?a=this._oParent:this._oLayer&&(a=this.getLayer()),a&&a.removeChild(this),this},getId:function(){return this._sId},getImage:function(){return this._elImage||null},getImageSize:function(){return this._htImageSize||!1},setImage:function(a){return"string"!=typeof a&&a?(this._elImage&&this._elImage===a||(this._elImage=a,this._nImageWidth=a.width,this._nImageHeight=a.height,this._htImageSize={width:this._bRetinaDisplay?this._nImageWidth/2:this._nImageWidth,height:this._bRetinaDisplay?this._nImageHeight/2:this._nImageHeight},this._htSpriteSheet=collie.ImageManager.getSprite(this._htOption.backgroundImage),this._bCustomSize||this.set({width:this._htImageSize.width,height:this._htImageSize.height}),this._setSpritePosition("spriteSheet",this._htOption.spriteSheet),this._setSpritePosition("spriteX",this._htOption.spriteX),this._setSpritePosition("spriteY",this._htOption.spriteY),this.setDirty("backgroundImage"),this.setChanged()),void 0):(null!==this._htGetImageData&&this._htGetImageData.name!==a&&(collie.ImageManager.cancelGetImage(this._htGetImageData.name,this._htGetImageData.callback),this._htGetImageData=null),a?(this._htGetImageData={name:a,callback:function(a){this.setImage(a)}.bind(this)},collie.ImageManager.getImage(this._htGetImageData.name,this._htGetImageData.callback)):(this._elImage=null,this.setChanged()),void 0)},getDrawing:function(){return this._oDrawing},setChanged:function(a){this._bChanged||a&&this._bChangedTransforms||(null!==this._oLayer&&this._oLayer.setChanged(),a||(this._bChanged=!0),this._bChangedTransforms=!0,this._oParent&&this._oParent.setChanged(!1))},unsetChanged:function(){this._bChanged=!1,this._bChangedTransforms=!1},isChanged:function(a){return a?!this._bChanged&&this._bChangedTransforms:this._bChanged||this._bChangedTransforms},setLayer:function(a){if(this._sId in collie.DisplayObject.htFactory)throw new Error("Exists DisplayObject Id "+this._sId);collie.DisplayObject.htFactory[this._sId]=this,this._oLayer=a,this._sRenderingMode=this._oLayer.getRenderingMode(),this._makeDrawing(),this._oDrawing.load(),this.setChanged(),("string"==typeof this._htOption.x||"string"==typeof this._htOption.y)&&this.align("string"==typeof this._htOption.x?this._htOption.x:!1,"string"==typeof this._htOption.y?this._htOption.y:!1),null!==this._nPositionRight&&(this.right(this._nPositionRight),this._nPositionRight=null),null!==this._nPositionBottom&&(this.bottom(this._nPositionBottom),this._nPositionBottom=null);for(var b=0,c=this._aDisplayObjects.length;c>b;b++)this._aDisplayObjects[b].setLayer(a)},unsetLayer:function(){if(this.getLayer()){for(var a=0,b=this._aDisplayObjects.length;b>a;a++)this._aDisplayObjects[a].unsetLayer();this._oDrawing.unload(),this.setDirty(),this.setChanged(),this._sRenderingMode=null,this._oDrawing=null,this._oLayer=null,delete collie.DisplayObject.htFactory[this._sId]}},_makeDrawing:function(){null===this._oDrawing&&(this._oDrawing="dom"===this._sRenderingMode?new collie.DisplayObjectDOM(this):new collie.DisplayObjectCanvas(this))},getLayer:function(){return this._oLayer||!1},addMatrix:function(a){if(a instanceof Array)for(var b=0,c=a.length;c>b;b++)this.addMatrix(a[b]);else this._htMatrix[a.name]=a,delete this._htMatrix[a.name].name},changeMatrix:function(a){a in this._htMatrix&&this.set(this._htMatrix[a])},update:function(a,b,c,d,e,f){if(this._updateMovableOption(a),"canvas"===this._sRenderingMode&&!this._htOption.visible)return this.unsetChanged(),void 0;if(b+=this._htOption.x,c+=this._htOption.y,("dom"===this._sRenderingMode&&this.isChanged()||"canvas"===this._sRenderingMode&&(b+this._htOption.width>=0||d>=b||c+this._htOption.height>=0||e>=c))&&this._oDrawing.draw(a,b,c,d,e,f),this.unsetChanged(),this._resetDirty(),(0!==this._htOption.velocityX||0!==this._htOption.velocityY||0!==this._htOption.velocityRotate||0!==this._htOption.forceX||0!==this._htOption.forceY||0!==this._htOption.forceRotate)&&this.setChanged(!0),"canvas"!==this._sRenderingMode&&this._htOption.visible&&this.hasChild())for(var g=0,h=this._aDisplayObjects.length;h>g;g++)this._aDisplayObjects[g].update(a,b,c,d,e)},_updateMovableOption:function(a){if(0!==this._htOption.velocityX||0!==this._htOption.velocityY||0!==this._htOption.velocityRotate||0!==this._htOption.forceX||0!==this._htOption.forceY||0!==this._htOption.forceRotate){var b=Math.max(17,a)/1e3;this._htOption.useRealTime||(b=1);var c=this._htOption.velocityX,d=this._htOption.velocityY,e=this._htOption.x,f=this._htOption.y;c+=this._htOption.forceX/this._htOption.mass*b,d+=this._htOption.forceY/this._htOption.mass*b;var g=this._htOption.friction*c*this._htOption.mass*b,h=this._htOption.friction*d*this._htOption.mass*b;if(0!==c&&(c=Math.abs(c)/c!==Math.abs(c-g)/(c-g)?0:c-g),0!==d&&(d=Math.abs(d)/d!==Math.abs(d-h)/(d-h)?0:d-h),e+=c*b,f+=d*b,c=Math.floor(1e3*c)/1e3,d=Math.floor(1e3*d)/1e3,this._htOption.friction&&Math.abs(c)<.05&&(c=0),this._htOption.friction&&Math.abs(d)<.05&&(d=0),(e!==this._htOption.x||f!==this._htOption.y||c!==this._htOption.velocityX||d!==this._htOption.velocityY)&&(this.set("x",e),this.set("y",f),this.set("velocityX",c),this.set("velocityY",d)),0!==this._htOption.forceRotate&&this.set("velocityRotate",this._htOption.velocityRotate+this._htOption.forceRotate),0!==this._htOption.velocityRotate){var i=collie.util.fixAngle(collie.util.toRad(this._htOption.angle+this._htOption.velocityRotate*b));this.set("angle",Math.round(1e3*collie.util.toDeg(i))/1e3)}}},getRelatedPosition:function(){if(null===this._htRelatedPosition.x&&(this._htRelatedPosition.x=this._htOption.x,this._htRelatedPosition.y=this._htOption.y,this._oParent)){var a=this._oParent.getRelatedPosition();this._htRelatedPosition.x+=a.x,this._htRelatedPosition.y+=a.y}return this._htRelatedPosition},getBoundary:function(a,b){var c=collie.Transform.getBoundary(this,b);if(this._htBoundary.left=c.left,this._htBoundary.right=c.right,this._htBoundary.top=c.top,this._htBoundary.bottom=c.bottom,this._htBoundary.isTransform=c.isTransform,this._htBoundary.points=c.points,a){var d=this.getRelatedPosition();if(this._htBoundary.points)for(var e=0,f=this._htBoundary.points.length;f>e;e++)this._htBoundary.points[e][0]+=d.x,this._htBoundary.points[e][1]+=d.y;this._htBoundary.left+=d.x,this._htBoundary.right+=d.x,this._htBoundary.top+=d.y,this._htBoundary.bottom+=d.y}return this._htBoundary},resetPositionCache:function(){if(this._htRelatedPosition.x=null,this._htRelatedPosition.y=null,this.hasChild())for(var a=0,b=this._aDisplayObjects.length;b>a;a++)this._aDisplayObjects[a].resetPositionCache()},getHitAreaBoundary:function(){if(this._htOption.hitArea){if(this._htOption.hitArea instanceof Array){var a=collie.Transform.points(this,collie.util.getBoundaryToPoints(this._htHitAreaBoundary)),b=collie.util.getBoundary(a),c=this.getRelatedPosition();return{left:b.left+c.x,right:b.right+c.x,top:b.top+c.y,bottom:b.bottom+c.y}}return this._htOption.hitArea.getBoundary(!0)}return this.getBoundary(!0)},getOrigin:function(){return this._htOrigin},_setOrigin:function(){switch(this._htOption.originX){case"left":this._htOrigin.x=0;break;case"right":this._htOrigin.x=this._htOption.width;break;case"center":this._htOrigin.x=this._htOption.width/2;break;default:this._htOrigin.x=parseInt(this._htOption.originX,10)}switch(this._htOption.originY){case"top":this._htOrigin.y=0;break;case"bottom":this._htOrigin.y=this._htOption.height;break;case"center":this._htOrigin.y=this._htOption.height/2;break;default:this._htOrigin.y=parseInt(this._htOption.originY,10)}},_fixPosition:function(){var a,b,c,d,e=this._htOption.x,f=this._htOption.y;if(this._htOption.rangeX){if(a=this._htOption.rangeX[0],b=this._htOption.rangeX[1],this._htOption.positionRepeat){if(a>e){do e+=b-a;while(a>e)}else if(e>b)do e-=b-a;while(e>b)}else e=Math.max(a,e),e=Math.min(b,e);e!==this._htOption.x&&this.set("x",e,!0)}if(this._htOption.rangeY){if(c=this._htOption.rangeY[0],d=this._htOption.rangeY[1],this._htOption.positionRepeat){if(c>f){do f+=d-c;while(c>f)}else if(f>d)do f-=d-c;while(f>d)}else f=Math.max(c,f),f=Math.min(d,f);f!==this._htOption.y&&this.set("y",f,!0)}},_makeHitAreaBoundary:function(){this._htHitAreaBoundary=collie.util.getBoundary(this._htOption.hitArea)},align:function(a,b,c){if(this.getLayer()){c=c||this.getParent();var d=0,e=0,f=0,g=0;c?(d=c._htOption.width,e=c._htOption.height):(d=this._oLayer._htOption.width,e=this._oLayer._htOption.height),a!==!1&&(f="right"===a?d-this._htOption.width:d/2-this._htOption.width/2,this.set("x",f)),b!==!1&&(g="bottom"===b?e-this._htOption.height:e/2-this._htOption.height/2,this.set("y",g))}},right:function(a){var b=0;return this._oParent&&(b=this._oParent._htOption.width),!b&&this._oLayer&&(b=this._oLayer._htOption.width),b?this.set("x",b-(this._htOption.width+a)):this._nPositionRight=a,this},bottom:function(a){var b=0;return this._oParent&&(b=this._oParent.get("height")),!b&&this._oLayer&&(b=this._oLayer.option("height")),b?this.set("y",b-(this._htOption.height+a)):this._nPositionBottom=a,this},resizeFixedRatio:function(a,b){if(this.getImage()){var c=this.getImage().width,d=this.getImage().height;a?b=a*(d/c):b&&(a=b*(c/d)),this.set("width",Math.round(a)),this.set("height",Math.round(b))
}},_setSpritePosition:function(a,b){if(this._elImage&&null!==b)if(null!==this._htOption.spriteSheet){var c,d,e=this._htSpriteSheet[this._htOption.spriteSheet];"spriteSheet"===a&&this._htSpriteSheet&&this._htSpriteSheet[b]?("undefined"!=typeof e[0][0]?null!==this._htOption.spriteX?(c=e[this._htOption.spriteX][0],d=e[this._htOption.spriteX][1]):(c=e[0][0],d=e[0][1]):(c=e[0],d=e[1]),this.set("offsetX",c,!0),this.set("offsetY",d,!0)):"spriteX"===a&&"undefined"!=typeof e[b]&&(this.set("offsetX",e[b][0],!0),this.set("offsetY",e[b][1],!0))}else{var f=this.getImageSize(),g=this._htOption.width,h=this._htOption.height,i=this._htOption.spriteLength-1,j=f.width/this._htOption.width-1,k=f.height/this._htOption.height-1,l=f.width-1,m=f.height-1;switch(i>=0&&h<f.height&&(l=j*f.width,m=k*f.height),a){case"spriteX":var c=0,d=0;i>j&&h<f.height?(d=Math.floor(b/(j+1))*h,c=b%(j+1)*g):c=Math.min(b,j)*g,this.set("offsetX",c,!0),this.set("offsetY",d,!0);break;case"spriteY":b=Math.min(b,k),this.set("offsetY",b*h,!0)}}},hasAttachedHandler:function(){return this._htHandler&&"click"in this._htHandler&&this._htHandler.click.length>0||"mousedown"in this._htHandler&&this._htHandler.mousedown.length>0||"mouseup"in this._htHandler&&this._htHandler.mouseup.length>0?!0:!1},move:function(a,b,c,d){var e=this._htOption.x,f=this._htOption.y,g=collie.util.getDistance(e,f,a,b),h=Math.round(g/c*1e3);if(null!==this._oTimerMove&&(this._oTimerMove.stop(),this._oTimerMove=null),c&&!(h<collie.Renderer.getInfo().fps)){var i={from:[e,f],to:[a,b],set:["x","y"]};return d&&(i.onComplete=function(){d(this)}),this._oTimerMove=collie.Timer.transition(this,h,i),this._oTimerMove}this.set({x:a,y:b}),d&&d(this)},moveBy:function(a,b,c,d){var e=this._htOption.x,f=this._htOption.y;return this.move(e+a,f+b,c,d)},toString:function(){return"DisplayObject"+(this._htOption.name?" "+this._htOption.name:"")+" #"+this.getId()+(this.getImage()?"(image:"+this.getImage().src+")":"")},clone:function(a){var b=new this.constructor(this._htOption);if(a&&this._aDisplayObjects.length)for(var c=0,d=this._aDisplayObjects.length;d>c;c++)this._aDisplayObjects[c].clone(!0).addTo(b);return b}},collie.Component),collie.DisplayObject._idx=0,collie.DisplayObject.htFactory={},collie.MovableObject=collie.Class({$init:function(){}},collie.DisplayObject),collie.Rectangle=collie.Class({$init:function(){this.option({radius:0,strokeColor:"",strokeWidth:0,fillColor:"",fillImage:""},null,!0),this._sBorderRadius=collie.util.getCSSPrefix("border-radius",!0)},onDOMDraw:function(a){this._bChanged&&(this._htOption.radius&&(a.element.style[this._sBorderRadius]=this._htOption.radius+"px",a.element.style.borderRadius=this._htOption.radius+"px"),this._htOption.fillImage?collie.ImageManager.getImage(this._htOption.fillImage,function(b){a.element.style.backgroundImage="url('"+b.src+"')"}):this._htOption.fillColor&&(a.element.style.backgroundColor=this._htOption.fillColor),this._htOption.strokeWidth&&(a.element.style.border=this._htOption.strokeWidth+"px solid "+this._htOption.strokeColor),this._bChanged=!1)},onCanvasDraw:function(a){var b=a.context,c=this._htOption.radius,d=collie.Renderer.isRetinaDisplay(),e=this._htOption.width,f=this._htOption.height,g=this._htOption.strokeWidth;if(d&&(e*=2,f*=2,c*=2,g*=2),htInfo.fillImage){var h=collie.ImageManager.getImage(htInfo.fillImage);if(h){var i=b.createPattern(h,"repeat");b.fillStyle=i}else collie.ImageManager.getImage(htInfo.fillImage,function(){this.setChanged()}.bind(this))}else htInfo.fillColor&&(b.fillStyle=htInfo.fillColor);this._htOption.strokeColor&&(b.strokeStyle=this._htOption.strokeColor),this._htOption.strokeWidth&&(b.lineWidth=g),c?(b.save(),b.translate(a.x,a.y),b.beginPath(),b.moveTo(c,0),b.lineTo(e-c,0),b.quadraticCurveTo(e,0,e,c),b.lineTo(e,f-c),b.quadraticCurveTo(e,f,e-c,f),b.lineTo(c,f),b.quadraticCurveTo(0,f,0,f-c),b.lineTo(0,c),b.quadraticCurveTo(0,0,c,0),b.closePath(),b.restore(),(this._htOption.fillColor||this._htOption.fillImage)&&b.fill(),this._htOption.strokeWidth&&b.stroke()):((this._htOption.fillColor||this._htOption.fillImage)&&b.fillRect(a.x,a.y,e,f),this._htOption.strokeWidth&&b.strokeRect(a.x,a.y,e,f)),this._bChanged=!1},toString:function(){return"Rectangle"+(this.get("name")?" "+this.get("name"):"")+" #"+this.getId()+(this.getImage()?"(image:"+this.getImage().src+")":"")}},collie.DisplayObject),collie.Circle=collie.Class({$init:function(){this.option({radius:0,strokeColor:"#000000",strokeWidth:0,fillColor:"",fillImage:"",startAngle:0,endAngle:360,closePath:!1,anticlockwise:!1,autoExpand:!0},null,!0),this._oPaper=null,this.optionSetter("radius",this._expandSize.bind(this)),this._expandSize()},_expandSize:function(){if(this._htOption.autoExpand&&this._htOption.radius){var a=2*this._htOption.radius+this._htOption.strokeWidth;this.set("width",a),this.set("height",a)}},onDOMDraw:function(a){var b=a.element;if("undefined"!=typeof Raphael){var c,d=this.get(),e=d.strokeWidth,f=d.radius,g=d.width,h=d.height,i=this.getDirty();if(null===this._oPaper?(this._oPaper=Raphael(b,g+e,h+e),this._oPaper.canvas.style.zIndex=10):i&&(i.width||i.height)&&this._oPaper.setSize(g,h),b.style.left=-(e/2)+"px",b.style.top=-(e/2)+"px",this._oPaper.clear(),f){var j=f,k=f,l=j+f*Math.cos(collie.util.toRad(d.startAngle)),m=k+f*Math.sin(collie.util.toRad(d.startAngle)),n=j+f*Math.cos(collie.util.toRad(d.endAngle)),o=k+f*Math.sin(collie.util.toRad(d.endAngle)),p=d.anticlockwise?d.startAngle-d.endAngle:d.endAngle-d.startAngle;Math.abs(p)>=360?p=360:0>p&&(p+=360);var q=p>180?1:0,r=d.anticlockwise?0:1;c=p>=360?this._oPaper.circle(j,k,f):this._oPaper.path("M"+l+","+m+"a"+f+","+f+",0,"+q+","+r+","+(n-l)+","+(o-m)+(d.closePath?"L"+j+","+k+"L"+l+","+m+"Z":""))}c&&(c.transform("t"+e/2+","+e/2),d.fillImage?collie.ImageManager.getImage(d.fillImage,function(a){c.attr("fill","url('"+a.src+"')")}):d.fillColor&&c.attr("fill",d.fillColor),d.strokeColor&&c.attr("stroke",d.strokeColor),c.attr("stroke-width",d.strokeWidth))}},onCanvasDraw:function(a){var b=this.get(),c=a.context,d=a.x,e=a.y,f=collie.Renderer.isRetinaDisplay(),g=b.radius,h=b.strokeWidth,i=b.width,j=b.height;if(f&&(i*=2,j*=2,g*=2,h*=2),b.fillImage){var k=collie.ImageManager.getImage(b.fillImage);if(k){var l=c.createPattern(k,"repeat");c.fillStyle=l}else collie.ImageManager.getImage(b.fillImage,function(){this.setChanged()}.bind(this))}else b.fillColor&&(c.fillStyle=b.fillColor);if(b.strokeColor&&(c.strokeStyle=b.strokeColor),h&&(c.lineWidth=h),g){var m=d+g,n=e+g,o=Math.abs(b.startAngle-b.endAngle)>=360;c.beginPath(),b.closePath&&!o&&c.moveTo(m,n),c.arc(m,n,g,collie.util.toRad(b.startAngle),collie.util.toRad(b.endAngle),b.anticlockwise),b.closePath&&c.closePath(),(b.fillColor||b.fillImage)&&c.fill(),b.strokeWidth&&c.stroke()}},center:function(a,b){return this.set("x",a-this._htOption.radius),this.set("y",b-this._htOption.radius),this},toString:function(){return"Circle"+(this._htOption.name?" "+this._htOption.name:"")+" #"+this.getId()+(this.getImage()?"(image:"+this.getImage().src+")":"")}},collie.DisplayObject),collie.Polyline=collie.Class({$init:function(){this.option({strokeColor:"#000000",strokeWidth:1,fillColor:"",fillImage:"",lineCap:"butt",lineJoin:"miter",miterLimit:10,dashArray:"",closePath:!1},null,!0),this._aPointData=[],this._oPaper=null,this._htPointBoundary={right:null,bottom:null}},setPointData:function(a,b){this._aPointData=a,this.setChanged(),b||this._expandBoundary(a)},getPointData:function(){return this._aPointData},addPoint:function(a,b,c){this._aPointData.push([a,b]),this.setChanged(),c||this._expandBoundary(a,b)},moveTo:function(a,b){this._aPointData.push([a,b,!0])},lineTo:function(a,b,c){this.addPoint(a,b,c)},resetPointData:function(){this._aPointData=[],this._htPointBoundary={right:null,bottom:null},this.setChanged()},_expandBoundary:function(a,b,c){if(a instanceof Array)for(var d=0,e=a.length;e>d;d++)this._expandBoundary(a[d][0],a[d][1],!0);else this._htPointBoundary.right=null===this._htPointBoundary.right?a:Math.max(a,this._htPointBoundary.right),this._htPointBoundary.bottom=null===this._htPointBoundary.bottom?b:Math.max(b,this._htPointBoundary.bottom);if(!c){var f=this._htOption.strokeWidth*(collie.Renderer.isRetinaDisplay()?2:1),g=this._htPointBoundary.right+2*f,h=this._htPointBoundary.bottom+2*f;this.set({width:g,height:h}),null!==this._oPaper&&this._oPaper.setSize(g,h)}},onDOMDraw:function(a){var b=a.element;if(!(this._aPointData.length<2)&&"undefined"!=typeof Raphael){var c=this.get(),d=c.strokeWidth,e=this.getDirty();null===this._oPaper?(this._oPaper=Raphael(b,c.width,c.height),this._oPaper.canvas.style.zIndex=10):e&&(e.width||e.height)&&this._oPaper.setSize(c.width,c.height),b.style.left=-(d/2)+"px",b.style.top=-(d/2)+"px",this._oPaper.clear();for(var f="M"+this._aPointData[0][0]+","+this._aPointData[0][1],g=1,h=this._aPointData.length;h>g;g++)f+=(this._aPointData[g][2]?"M":"L")+this._aPointData[g][0]+","+this._aPointData[g][1];!c.closePath||this._aPointData[0][0]===this._aPointData[this._aPointData.length-1][0]&&this._aPointData[0][1]===this._aPointData[this._aPointData.length-1][1]||(f+="L"+this._aPointData[0][0]+","+this._aPointData[0][1]);var i=this._oPaper.path(f+(c.closePath?"Z":""));i.transform("t"+d/2+","+d/2),c.fillImage?collie.ImageManager.getImage(c.fillImage,function(a){i.attr("fill","url('"+a.src+"')")}):c.fillColor&&i.attr("fill",c.fillColor),c.lineCap&&i.attr("stroke-linecap",c.lineCap),c.lineJoin&&i.attr("stroke-linejoin",c.lineJoin),null!==c.miterLimit&&i.attr("stroke-miterlimit",c.miterLimit),c.strokeColor&&i.attr("stroke",c.strokeColor),i.attr("stroke-width",d),c.dashArray&&i.attr("stroke-dasharray",c.dashArray)}},onCanvasDraw:function(a){if(!(this._aPointData.length<2)){var b=this.get(),c=a.context,d=collie.Renderer.isRetinaDisplay(),e=b.strokeWidth,f=d?2:1;if(c.save(),c.translate(a.x,a.y),d&&(e*=2),b.fillImage){var g=collie.ImageManager.getImage(b.fillImage);if(g){var h=c.createPattern(g,"repeat");c.fillStyle=h}else collie.ImageManager.getImage(b.fillImage,function(){this.setChanged()}.bind(this))}else b.fillColor&&(c.fillStyle=b.fillColor);if(b.strokeColor&&(c.strokeStyle=b.strokeColor),c.lineWidth=e,b.lineCap&&(c.lineCap=b.lineCap),b.lineJoin&&(c.lineJoin=b.lineJoin),b.miterLimit&&(c.miterLimit=b.miterLimit),b.dashArray){if(b.fillColor||b.fillImage){c.beginPath(),c.moveTo(this._aPointData[0][0]*f,this._aPointData[0][1]*f);for(var i=1,j=this._aPointData.length;j>i;i++)this._aPointData[i][2]?c.moveTo(this._aPointData[i][0]*f,this._aPointData[i][1]*f):c.lineTo(this._aPointData[i][0]*f,this._aPointData[i][1]*f);b.closePath&&c.closePath(),c.fill()}c.resetDashedLine()}c.beginPath(),c.moveTo(this._aPointData[0][0]*f,this._aPointData[0][1]*f);for(var i=1,j=this._aPointData.length;j>i;i++)this._aPointData[i][2]?c.moveTo(this._aPointData[i][0]*f,this._aPointData[i][1]*f):b.dashArray?c.dashedLine(this._aPointData[i-1][0]*f,this._aPointData[i-1][1]*f,this._aPointData[i][0]*f,this._aPointData[i][1]*f,collie.raphaelDashArray[b.dashArray],e):c.lineTo(this._aPointData[i][0]*f,this._aPointData[i][1]*f);b.dashArray&&b.closePath&&(this._aPointData[0][0]!==this._aPointData[this._aPointData.length-1][0]||this._aPointData[0][1]!==this._aPointData[this._aPointData.length-1][1])&&c.dashedLine(this._aPointData[i-1][0]*f,this._aPointData[i-1][1]*f,this._aPointData[0][0]*f,this._aPointData[0][1]*f,collie.raphaelDashArray[b.dashArray],e),b.closePath&&c.closePath(),b.dashArray||!b.fillColor&&!b.fillImage||c.fill(),b.strokeWidth&&c.stroke(),c.restore()}},toString:function(){return"Polyline"+(this._htOption.name?" "+this._htOption.name:"")+" #"+this.getId()+(this.getImage()?"(image:"+this.getImage().src+")":"")}},collie.DisplayObject),collie.Text=collie.Class({$init:function(){this._sText="",this.option({fontFamily:"Arial",fontWeight:"",fontSize:12,fontColor:"#000000",lineHeight:"auto",textAlign:"left",padding:"0 0 0 0",ellipsisMaxLine:0,ellipsisString:"...",useEllipsis:!1,useCache:!0},null,!0),this._elText=null,this._nTextWidth=0,this._nRatio=1,this._aCallbackTextWidth=[]},_initElement:function(){null===this._elText&&(this._elText=document.createElement("div"),this._elText.style.display="inline",this.getDrawing().getItemElement().appendChild(this._elText))},onCanvasDraw:function(a){this._nRatio="canvas"===this._sRenderingMode&&this._bRetinaDisplay?2:1,this._oContext=a.context;var b=this._getMaxWidth();this._oContext.font=this._getFontText(),this._oContext.fillStyle=this._htOption.fontColor,this._oContext.textBaseline="top",this._fillTextMultiline(this._wordWrap(b).split("\n"),a.x,a.y),this._triggerGetTextWidth()},onDOMDraw:function(a){this._initElement();var b=(this.getDrawing(),a.element),c=this._sText.replace(/\n/g,"<br />"),d=b.style;d.font=this._getFontText(),d.color=this._htOption.fontColor,d.padding=this._getPadding().replace(/ /g,"px ")+"px",d.width=this._getMaxWidth()+"px",d.height=this._getMaxHeight()+"px",d.lineHeight=this._getLineHeight()+"px",d.textAlign=this._htOption.textAlign,this._elText.innerHTML!=c&&(this._elText.innerHTML=c),this.unsetChanged(),this._getDOMTextWidth(),this._triggerGetTextWidth()},_getDOMTextWidth:function(){null!==this._elText&&(this._nTextWidth=this._elText.offsetWidth)},_getFontText:function(){return this._htOption.fontWeight+" "+this._htOption.fontSize*this._nRatio+"px "+this._htOption.fontFamily},_getLineHeight:function(){return"auto"===this._htOption.lineHeight?this._htOption.fontSize*this._nRatio:this._htOption.lineHeight*this._nRatio},_fillTextMultiline:function(a,b,c){var d=this._getPadding("left"),e=this._htOption.ellipsisMaxLine;this._nTextWidth=0;for(var f=0;f<a.length;f++){e&&f>=e-1&&a.length>e&&(a[f]=this._insertEllipsisText(a[f]),a.splice(f+1,a.length-(f+1)));var g=this._oContext.measureText(a[f]).width;"center"===this._htOption.textAlign?d=this._getMaxWidth()/2-g/2+this._getPadding("left"):"right"===this._htOption.textAlign&&(d=this._htOption.width*this._nRatio-this._getPadding("right")-g),this._oContext.fillText(a[f],b+d,c+this._getTopPosition(f+1)),this._nTextWidth=Math.max(this._nTextWidth,g)}},_getMaxWidth:function(){return this._htOption.width*this._nRatio-(this._getPadding("left")+this._getPadding("right"))},_getMaxHeight:function(){return this._htOption.height*this._nRatio-(this._getPadding("top")+this._getPadding("bottom"))},_getTopPosition:function(a){return this._getLineHeight()*(a-1)+this._getPadding("top")},_getPadding:function(a){for(var b=this._htOption.padding||"0 0 0 0",c=b.split(" "),d=0,e=c.length;e>d;d++)c[d]=parseInt(c[d],10)*this._nRatio;switch(a){case"top":return c[0];case"right":return c[1];case"bottom":return c[2];case"left":return c[3];default:return c.join(" ")}},_insertEllipsisText:function(a){for(var b=this._getMaxWidth(),c="",d=a.length;d>0;d--)if(c=a.substr(0,d)+this._htOption.ellipsisString,this._oContext.measureText(c).width<=b)return c;return a},_wordWrap:function(a,b){var c=b||this._sText,d=1;if(!c)return"";for(b=c.substr(0,1);this._oContext.measureText(b).width<=a;){if(d++,d>c.length)return b;if(b=c.substr(0,d),"\n"===c.substr(d-1,1))break}return d=Math.max(1,d-1),b=c.substr(0,d),"\n"===c.substr(d,1)&&d++,c.length>d&&(b+="\n"+this._wordWrap(a,c.substr(d))),b},text:function(a){return this._nTextWidth=0,this._aCallbackTextWidth=[],this._sText=a.toString(),this.setChanged(),this},getTextWidth:function(a){return a&&this._aCallbackTextWidth.push(a),this._nTextWidth?(this._triggerGetTextWidth(),this._nTextWidth/this._nRatio):void 0},_triggerGetTextWidth:function(){if(this._aCallbackTextWidth.length>0){for(var a=0,b=this._aCallbackTextWidth.length;b>a;a++)this._aCallbackTextWidth[a](this._nTextWidth/this._nRatio);this._aCallbackTextWidth=[]}},toString:function(){return"Text"+(this._htOption.name?" "+this._htOption.name:"")+" #"+this.getId()+(this.getImage()?"(image:"+this.getImage().src+")":"")}},collie.DisplayObject),collie.Animation=collie.Class({$init:function(a,b,c){this._nId=++collie.Animation._idx,this._bIsPlaying=!1,this._fCallback=a,this._oTimerList=null,this.option("useAutoStart",!0),this.option(("object"==typeof b?b:c)||{}),this.setDuration(b),this.setOptionEvent(c)},setOptionEvent:function(a){if(a)for(var b in a)0===b.toString().indexOf("on")&&this.attach(b.toString().replace(/^on/,"").toLowerCase(),a[b])},triggerCallback:function(a){if("function"!=typeof this._fCallback&&this._htOption.set){var b={};if(this._htOption.set instanceof Array)for(var c=0,d=this._htOption.set.length;d>c;c++)b[this._htOption.set[c]]=a.value instanceof Array?a.value[c]:a.value;else b[this._htOption.set]=a.value;if(this._fCallback instanceof Array)for(var e=0,d=this._fCallback.length;d>e;e++)this._fCallback[e].set(b);else this._fCallback.set(b)}else this._fCallback&&this._fCallback(a)},setDuration:function(a){this._nDuration=parseInt(a,10)},getDuration:function(){return this._nDuration},setTimerList:function(a){this._oTimerList=a,this._htOption.useAutoStart&&this.start()},getId:function(){return this._nId},run:function(){throw new Error("abstract method")},reset:function(){throw new Error("abstract method")},stop:function(a){this.isPlaying()&&(null!==this._oTimerList&&this._oTimerList.remove(this),this._bIsPlaying=!1,this.reset(),a||this.fireEvent("stop"))},pause:function(){this.isPlaying()&&(this._bIsPlaying=!1,this.fireEvent("pause"),null!==this._oTimerList&&this._oTimerList.remove(this))},start:function(){this.isPlaying()||(this._bIsPlaying=!0,null!==this._oTimerList&&this._oTimerList.add(this),this.fireEvent("start"))},isPlaying:function(){return this._bIsPlaying},complete:function(){this.isPlaying()&&(this._fCallbackComplete&&this._fCallbackComplete(),this.stop(!0),this.fireEvent("complete"))}},collie.Component),collie.Animation._idx=0,collie.AnimationTransition=collie.Class({$init:function(a,b,c){this.option({from:null,to:null,set:"",loop:1,effect:collie.Effect.linear}),this._htCallback={},this.option(c||{});var d=this.reset.bind(this);this.optionSetter("from",d),this.optionSetter("to",d),this._nCount=0,this._nCountCycle=0,this._nFrameAtRunLastest=null,this._nRunningTime=null,this._bIsArrayValue=!1},start:function(){null===this._htOption.from&&"function"!=typeof this._fCallback&&this._setDefaultFromValues(),null===this._nFrameAtRunLastest&&this.reset(),this.constructor.$super.start.call(this)},_setDefaultFromValues:function(){var a=null;if(this._htOption.set){if(this._htOption.set instanceof Array){a=[];for(var b=0,c=this._htOption.set.length;c>b;b++)a.push(this._fCallback.get(this._htOption.set[b]))}else a=this._fCallback.get(this._htOption.set);this.option("from",a)}},reset:function(){if(this._nFrameAtRunLastest=null,this._nRunningTime=null,this._nValue=this._htOption.from,this._bIsArrayValue=this._htOption.from instanceof Array,this._nCount=0,this._nCountCycle=0,this._bIsArrayValue){this._fEffect=[];for(var a=null,b=0,c=this._htOption.from.length;c>b;b++)a=this._htOption.effect instanceof Array?this._htOption.effect[b]:this._htOption.effect,this._fEffect[b]=a(this._htOption.from[b],this._htOption.to[b])}else this._fEffect=this._htOption.effect(this._htOption.from,this._htOption.to)},setValue:function(a){this._nValue=a},getValue:function(){return this._nValue},run:function(a,b){if(void 0===a&&(a=collie.Renderer.getInfo().frame),this._nFrameAtRunLastest>a)return this.reset(),void 0;if(null===this._nFrameAtRunLastest&&(this._nFrameAtRunLastest=a,this._nRunningTime=0,b=0),this._nRunningTime+=b,this._nCount++,this._nRunningTime>=this._nDuration)if(this._nCountCycle++,!this._isEndValue()&&this._htOption.loop&&this._htOption.loop<=this._nCountCycle)this._setEndValue();else{if(this._htOption.loop&&!(this._htOption.loop>this._nCountCycle))return this.complete(),void 0;this.fireEvent("end"),this._nFrameAtRunLastest=a,this._nRunningTime=this._nRunningTime-this._nDuration,this._nValue=this._htOption.from,this._transitionValue(this._nRunningTime)}else this._nRunningTime>0&&this._transitionValue(this._nRunningTime);this._htCallback.timer=this,this._htCallback.frame=a,this._htCallback.duration=this._nDuration,this._htCallback.cycle=this._nCountCycle,this._htCallback.runningTime=this._nRunningTime,this._htCallback.from=this._htOption.from,this._htCallback.to=this._htOption.to,this._htCallback.value=this._nValue,this.triggerCallback(this._htCallback),this._nRunningTime>0&&(this._nFrameAtRunLastest=a)},_transitionValue:function(a){if(this._bIsArrayValue){this._nValue=[];for(var b=0,c=this._htOption.from.length;c>b;b++)this._nValue[b]=parseFloat(this._fEffect[b](Math.max(0,Math.min(1,a/this._nDuration))))}else this._nValue=parseFloat(this._fEffect(Math.max(0,Math.min(1,a/this._nDuration))))},_isEndValue:function(){if(this._bIsArrayValue){for(var a=0,b=this._htOption.to.length;b>a;a++)if(this._nValue[a]!==parseFloat(this._fEffect[a](1)))return!1;return!0}return this._nValue===parseFloat(this._fEffect(1))},_setEndValue:function(){if(this._bIsArrayValue)for(var a=0,b=this._htOption.to.length;b>a;a++)this._nValue[a]=parseFloat(this._fEffect[a](1));else this._nValue=parseFloat(this._fEffect(1))}},collie.Animation),collie.AnimationRepeat=collie.Class({$init:function(a,b,c){this.option({beforeDelay:0,afterDelay:0,loop:0,useRealTime:!0}),this.option(c||{}),this.reset(),this.setDuration(b),this._nFrameAtRunLastest=null},setDuration:function(a){a=parseInt(a,10),a<collie.Renderer.getDuration()&&(a=collie.Renderer.getDuration()),this._nDuration=a},reset:function(){this._nCount=0,this._nFrameAtRunLastest=null,this._nRunningTime=null,this._nRunLastestTime=null,this._nBeforeDelay=this._htOption.beforeDelay},run:function(a,b){if(void 0===a&&(a=collie.Renderer.getInfo().frame),this._nFrameAtRunLastest>a)return this.reset(),void 0;null===this._nFrameAtRunLastest&&(this._nFrameAtRunLastest=a,this._nRunningTime=0,this._nRunLastestTime=0,b=0),this._nRunningTime+=b;var c=Math.max(1,Math.floor((this._nRunningTime-this._nRunLastestTime)/this._nDuration))-1;if(0===this._nCount&&this._nBeforeDelay)return this._nRunLastestTime+this._nBeforeDelay<=this._nRunningTime&&(this.reset(),this._nBeforeDelay=0),void 0;if(0===this._nRunningTime||this._nRunLastestTime+this._nDuration<=this._nRunningTime){if(this._nCount+=this._htOption.useRealTime?1+c:1,this._fCallback({timer:this,frame:a,duration:this._nDuration,count:this._nCount,skippedCount:c,runningTime:this._nRunningTime}),this._htOption.loop&&this._htOption.loop<=this._nCount)return this.complete(),void 0;this._nFrameAtRunLastest=a,this._nRunLastestTime=this._nRunningTime}}},collie.Animation),collie.AnimationCycle=collie.Class({$init:function(a,b,c){this._nFPS=null,this._htCallback={};var d=this._setterFPS.bind(this);this.optionSetter("valueSet",this._setterValueSet.bind(this)),this.optionSetter("to",d),this.optionSetter("from",d),this.option({delay:0,from:0,to:0,step:1,loop:0,set:"spriteX",useRealTime:!0,valueSet:null,start:null}),this.option(c||{}),this._nFrameAtRunLastest=null,this._nRunLastestTime=null,this._nRunningTime=null,this._nCountCycle=0,this._nCountCycleBefore=0,this.setDuration(b),this.reset()},reset:function(){this._nCount=0,this._nCountCycle=0,this._nCountCycleBefore=0,this._nFrameAtRunLastest=null,this._nRunningTime=null,this._nRunLastestTime=null,this._nValue=(null!==this._htOption.start?this._htOption.start:this._htOption.from)-this._htOption.step},_setterValueSet:function(){var a=this._htOption.valueSet;a&&a instanceof Array&&this.option({from:0,to:a.length-1,step:1})},_setterFPS:function(){if(null!==this._nFPS&&"undefined"!=typeof this._htOption.to&&"undefined"!=typeof this._htOption.from){var a=this._htOption.to-this._htOption.from+1;this._nDuration=Math.round(1e3/this._nFPS*a)}},setDuration:function(a){this._nDuration=parseInt(a,10),/fps/i.test(a)&&"undefined"!=typeof this._htOption.to&&"undefined"!=typeof this._htOption.from?(this._nFPS=parseInt(a,10),this._setterFPS()):this._nFPS=null},setValue:function(a){this._nValue=a},getValue:function(){return this._htOption.valueSet?this._htOption.valueSet[this._nValue]:this._nValue},run:function(a,b){if("undefined"==typeof a&&(a=collie.Renderer.getInfo().frame),this._nFrameAtRunLastest>a)return this.reset(),void 0;null===this._nFrameAtRunLastest&&(this._nFrameAtRunLastest=a,this._nRunLastestTime=0,this._nRunningTime=0,b=0),b||(b=0);var c=this._htOption,d=c.to-c.from;this._nTotalCount=d/c.step,this._nTerm=this._nDuration/this._nTotalCount,this._nRunningTime+=b;var e=c.useRealTime?Math.max(1,Math.floor((this._nRunningTime-this._nRunLastestTime)/this._nTerm))-1:0;if(0===this._nRunningTime||this._nRunLastestTime+this._nTerm<=this._nRunningTime){if(this._nCountCycleBefore!==this._nCountCycle&&this.fireEvent("end"),c.loop&&this._nCountCycle>=c.loop)return this.complete(),void 0;if(this._nValue===c.to&&(this._nValue=c.from-c.step),this._nValue+=c.step*(1+e),this._nCount+=1+e,this._nCountCycleBefore=this._nCountCycle,c.from<=c.to?this._nValue>=c.to:this._nValue<=c.to){var f=(this._nValue-c.to)/c.step,g=Math.ceil(f/(this._nTotalCount+1));f%=this._nTotalCount+1,f?(this._nCountCycle+=g,this._nValue=c.from+(f-1)*c.step):(this._nCountCycle+=1,this._nValue=c.to)}this._htCallback.timer=this,this._htCallback.frame=a,this._htCallback.duration=this._nDuration,this._htCallback.count=this._nCount,this._htCallback.skippedCount=e,this._htCallback.runningTime=this._nRunningTime,this._htCallback.value=this.getValue(),this._htCallback.cycle=this._nCountCycle,this._htCallback.step=c.step,this._htCallback.from=c.from,this._htCallback.to=c.to,this.triggerCallback(this._htCallback),this._nFrameAtRunLastest=a,this._nRunLastestTime=this._nRunningTime}}},collie.Animation),collie.AnimationDelay=collie.Class({$init:function(){this.reset()},reset:function(){this._nFrameAtRunLastest=null,this._nRunningTime=null,this._nRunLastestTime=null},run:function(a,b){return void 0===a&&(a=collie.Renderer.getInfo().frame),this._nFrameAtRunLastest>a?(this.reset(),void 0):(null===this._nFrameAtRunLastest&&(this._nFrameAtRunLastest=a,this._nRunLastestTime=0,this._nRunningTime=0,b=0),this._nRunningTime+=b,this._nRunLastestTime+this._nDuration<=this._nRunningTime&&(this._fCallback&&this._fCallback({timer:this,frame:a,duration:this._nDuration,runningTime:this._nRunningTime}),this.complete()),void 0)}},collie.Animation),collie.AnimationTimeline=collie.Class({$init:function(a,b){if(this.option("loop",1),this.option(b||{}),this.setOptionEvent(b),this._htAnimations={},this._aTimeline=null,this._aRunningAnimation=null,this._nRunningTime=null,this._nCountCycle=0,a)for(var c=0,d=a.length;d>c;c++)this.addTimeline.apply(this,a[c]);this.reset()},add:function(a,b,c,d,e){var f;switch(b){case"delay":f=new collie.AnimationDelay(c,d,e);break;case"repeat":f=new collie.AnimationRepeat(c,d,e);break;case"transition":f=new collie.AnimationTransition(c,d,e);break;case"cycle":f=new collie.AnimationCycle(c,d,e);break;case"queue":f=new collie.AnimationQueue(c);break;default:if(!(b instanceof collie.Animation))throw new Error(b+" timer is not defined");f=b}return this._addTimeline(a,f),f},_addTimeline:function(a,b){a=parseInt(a,10),this._htAnimations[a]=this._htAnimations[a]||[],this._htAnimations[a].push(b),null!==this._aTimeline&&this.reset()},remove:function(a,b){if(a=parseInt(a,10),this._htAnimations&&this._htAnimations[a]){for(var c=0;c<this._htAnimations[a].length&&("undefined"!=typeof b&&b!==this._htAnimations[a][c]||(this._htAnimations[a][c].stop(),this._htAnimations[a].splice(c,1),c--,"undefined"==typeof b));c++);this._htAnimations[a].length<1&&(delete this._htAnimations[a],this._removeTimelineStartTime(a))}},_removeTimelineStartTime:function(a){if(this._aTimeline)for(var b=0,c=this._aTimeline.length;c>b;b++)if(this._aTimeline[b]===a){this._aTimeline.splice(b,1);break}},_initTimeline:function(){this._aTimeline=[],this._aRunningAnimation=[];for(var a in this._htAnimations)this._aTimeline.push(parseInt(a,10));this._aTimeline.sort(function(a,b){return a-b})},getAnimation:function(a){return a=parseInt(a,10),this._htAnimations&&this._htAnimations[a]?this._htAnimations[a]:!1},getRunningTime:function(){return this._nRunningTime||0},getCycle:function(){return this._nCountCycle||0},reset:function(){this._nFrameAtRunLastest=null,this._nRunningTime=null,this._aTimeline=null,this._aRunningAnimation=null,this._nCountCycle=0,this._initTimeline()},run:function(a,b){if(void 0===a&&(a=collie.Renderer.getInfo().frame),this._nFrameAtRunLastest>a)return this.reset(),void 0;if(null===this._nFrameAtRunLastest&&(this._nFrameAtRunLastest=a,this._nRunningTime=0,b=0),this._nRunningTime+=b,this._aTimeline.length>0)for(;this._aTimeline[0]<=this._nRunningTime;)for(var c=this._aTimeline.shift(),d=0,e=this._htAnimations[c].length;e>d;d++)this._aRunningAnimation.push(this._htAnimations[c][d]),this._htAnimations[c][d].start();if(this._aRunningAnimation.length>0)for(var d=0;d<this._aRunningAnimation.length;d++)this._aRunningAnimation[d]&&this._aRunningAnimation[d].run(a,b),this._aRunningAnimation[d]&&this._aRunningAnimation[d].isPlaying()||(this._aRunningAnimation[d]&&this._aRunningAnimation[d].reset(),this._aRunningAnimation.splice(d,1),d--,this._checkComplete())},_checkComplete:function(){this._aRunningAnimation.length<1&&this._aTimeline.length<1&&(this._nCountCycle++,this._htOption.loop&&this._htOption.loop<=this._nCountCycle?this.complete():(this.fireEvent("end"),this._nFrameAtRunLastest=null,this._nRunningTime=null,this._aTimeline=null,this._aRunningAnimation=null,this._initTimeline()))}},collie.Animation),collie.AnimationQueue=collie.Class({$init:function(a){this.option("loop",1),this.option(a||{}),this.setOptionEvent(a),this._aAnimations=[],this._fOnCompleteAnimation=this._onCompleteAnimation.bind(this),this.reset()},delay:function(a,b,c){return this._add(new collie.AnimationDelay(a,b,c)),this},repeat:function(a,b,c){return this._add(new collie.AnimationRepeat(a,b,c)),this},transition:function(a,b,c){return this._add(new collie.AnimationTransition(a,b,c)),this},cycle:function(a,b,c){return this._add(new collie.AnimationCycle(a,b,c)),this},getAnimation:function(a){return this._aAnimations[a]||!1},_add:function(a){a.attach("complete",this._fOnCompleteAnimation),this._aAnimations.push(a)},_onCompleteAnimation:function(){this.next()},next:function(){if(null===this._nAnimationIdx?this._nAnimationIdx=0:this._nAnimationIdx++,this._nAnimationIdx>=this._aAnimations.length){if(this._nCount++,this.fireEvent("end",{count:this._nCount}),this._htOption.loop&&!(this._htOption.loop>this._nCount))return this.complete(),void 0;this._nAnimationIdx=0}this._aAnimations[this._nAnimationIdx].stop(),this._aAnimations[this._nAnimationIdx].start()},reset:function(){this._nFrameAtRunLastest=null,this._nAnimationIdx=null,this._nCount=0},removeAll:function(){this._aAnimations=[],this.reset()},removeAfter:function(){if(this._nAnimationIdx+1<=this._aAnimations.length-1){var a=this._aAnimations.length-(this._nAnimationIdx+1);this._aAnimations.splice(this._nAnimationIdx+1,a)}},run:function(a,b){if(!(this._aAnimations.length<1)){if(void 0===a&&(a=collie.Renderer.getInfo().frame),this._nFrameAtRunLastest>a)return this.reset(),void 0;null===this._nFrameAtRunLastest&&(this._nFrameAtRunLastest=a),null===this._nAnimationIdx&&this.next(),this._aAnimations[this._nAnimationIdx].run(a,b)}}},collie.Animation),collie.TimerList=collie.Class({$init:function(){this._aList=[]},add:function(a){this._aList.unshift(a)},remove:function(a){for(var b=0,c=this._aList.length;c>b;b++)if(this._aList[b]===a){this._aList.splice(b,1);break}},removeAll:function(){this._aList=[]},stopAll:function(){for(var a=this._aList.length-1;a>=0;a--)this._aList[a].stop()},run:function(a,b){for(var c=this._aList.length-1;c>=0;c--)this._aList[c]&&(this._aList[c].isPlaying()?this._aList[c].run(a,b):this._aList.splice(c,1))}}),collie.Timer=collie.Timer||new(collie.Class({$init:function(){this._oList=new collie.TimerList},run:function(a,b){this._oList.run(a,b)},stopAll:function(){this._oList.stopAll()},removeAll:function(){this._oList.removeAll()},queue:function(a){var b=new collie.AnimationQueue(a);return b.setTimerList(this._oList),b},repeat:function(a,b,c){var d=new collie.AnimationRepeat(a,b,c);return d.setTimerList(this._oList),d
},transition:function(a,b,c){var d=new collie.AnimationTransition(a,b,c);return d.setTimerList(this._oList),d},cycle:function(a,b,c){var d=new collie.AnimationCycle(a,b,c);return d.setTimerList(this._oList),d},delay:function(a,b,c){var d=new collie.AnimationDelay(a,b,c);return d.setTimerList(this._oList),d},timeline:function(a,b){var c=new collie.AnimationTimeline(a,b);return c.setTimerList(this._oList),c}})),collie.Renderer=collie.Renderer||new(collie.Class({DEFAULT_FPS:"60fps",RETINA_DISPLAY:!1,DEBUG_USE_DELAY:!1,DEBUG_MAX_DELAY:200,DEBUG_RENDERING_MODE:"auto",USE_AUTO_PAUSE:!0,DELAY_LIMIT:3e3,$init:function(){this._sVisibilityChange=this._getNamePageVisibility(),this._bPlaying=!1,this._bPause=!1,this._nFPS=0,this._nDuration=0,this._nCurrentFrame=0,this._nSkippedFrame=0,this._nBeforeFrameTime=null,this._nBeforeRenderingTime=0,this._aLayerList=[],this._fRender=this._render.bind(this),this._fCallback=null,this._htCallback={},this._elContainer=document.createElement("div"),this._elContainer.className="_collie_container",this._elContainer.style.position="relative",this._elContainer.style.overflow="hidden",this._elParent=null,this._nDebugDelayedTime=0,this._oRenderingTimer=null,this._bLoaded=!1,this._sRenderingMode=null,this._bUseRetinaDisplay=null,this._htEventStatus={},this._htPosition={},this._bIsPreventDefault=!0,this._htDeviceInfo=collie.util.getDeviceInfo(),this._fOnChangeVisibility=this._onChangeVisibility.bind(this),this._fOnPageShow=this._onPageShow.bind(this),this._fOnPageHide=this._onPageHide.bind(this),this._fRefresh=this.refresh.bind(this)},_onPageShow:function(){this.USE_AUTO_PAUSE&&!this.isPlaying()&&this._bPause&&this.resume()},_onPageHide:function(){this.USE_AUTO_PAUSE&&this.isPlaying()&&this.pause()},_onChangeVisibility:function(){if(this.USE_AUTO_PAUSE){var a=document.visibilityState||document.webkitVisibilityState||document.mozVisibilityState;"hidden"===a?this.pause():"visible"===a&&this.resume()}},refresh:function(){null!==this._elParent&&(this._htPosition=collie.util.getPosition(this._elParent))},getPosition:function(){return this._bLoaded?this._htPosition:!1},addLayer:function(a){if(!(a&&"type"in a&&"layer"===a.type))throw new Error("oLayer is not Layer instnace");for(var b=0,c=this._aLayerList.length;c>b;b++)if(this._aLayerList[b]===a)return;this._aLayerList.push(a),this._bLoaded&&(a.load(this._elContainer,this._aLayerList.length),this.resetLayerEvent())},removeLayer:function(a){for(var b=0,c=this._aLayerList.length;c>b;b++)if(this._aLayerList[b]===a)return this._aLayerList[b].unload(),this._aLayerList.splice(b,1),void 0},removeAllLayer:function(){for(var a=this._aLayerList.length-1;a>=0;a--)this._aLayerList[a].unload();this._aLayerList=[]},getLayers:function(){return this._aLayerList},resetLayerEvent:function(){for(var a=0,b=this._aLayerList.length;b>a;a++)this._aLayerList[a].detachEvent();for(var a=this._aLayerList.length-1;a>=0;a--)this._aLayerList[a].attachEvent()},getElement:function(){return this._elContainer},getDuration:function(){return this._nDuration},getInfo:function(){return this._htCallback.frame=this._nCurrentFrame,this._htCallback.skippedFrame=this._nSkippedFrame,this._htCallback.fps=this._nFPS,this._htCallback.duration=this._nDuration,this._htCallback.renderingTime=this._nBeforeRenderingTime,this._htCallback.beforeFrameTime=this._nBeforeFrameTime,this._htCallback},getRenderingMode:function(){if(null===this._sRenderingMode){var a=collie.util.getDeviceInfo();this._sRenderingMode=this.DEBUG_RENDERING_MODE,this._sRenderingMode&&"auto"!==this._sRenderingMode||(this._sRenderingMode=a.android&&!a.chrome&&(a.android<4.2&&a.android>=3||a.android<2.2)||!a.supportCanvas||a.ios&&a.ios<5?"dom":"canvas"),a.supportCanvas||(this._sRenderingMode="dom")}return this._sRenderingMode},setRenderingMode:function(a){this.DEBUG_RENDERING_MODE=a.toString().toLowerCase(),this._sRenderingMode=null},isRetinaDisplay:function(){if(null===this._bUseRetinaDisplay){this._bUseRetinaDisplay="auto"!==this.RETINA_DISPLAY?this.RETINA_DISPLAY:window.devicePixelRatio>=2&&(!collie.util.getDeviceInfo().android||collie.util.getDeviceInfo().android>=4);var a=collie.util.getDeviceInfo();a.ie&&a.ie<9&&(this._bUseRetinaDisplay=!1)}return this._bUseRetinaDisplay},setRetinaDisplay:function(a){this.RETINA_DISPLAY=a,this._bUseRetinaDisplay=null},_getNameAnimationFrame:function(a){return"undefined"!=typeof window.requestAnimationFrame?a?"cancelAnimationFrame":"requestAnimationFrame":"undefined"!=typeof window.webkitRequestAnimationFrame?a?"webkitCancelAnimationFrame":"webkitRequestAnimationFrame":"undefined"!=typeof window.msRequestAnimationFrame?a?"msCancelAnimationFrame":"msRequestAnimationFrame":"undefined"!=typeof window.mozRequestAnimationFrame?a?"mozCancelAnimationFrame":"mozRequestAnimationFrame":"undefined"!=typeof window.oRequestAnimationFrame?a?"oCancelAnimationFrame":"oRequestAnimationFrame":!1},_getNamePageVisibility:function(){return"hidden"in document?"visibilitychange":"webkitHidden"in document?"webkitvisibilitychange":"mozHidden"in document?"mozvisibilitychange":!1},load:function(a){if(this.unload(),this._bLoaded=!0,"string"==typeof a&&(a=document.getElementById(a)),this._elParent=a,this._elParent.appendChild(this._elContainer),this.refresh(),this._aLayerList.length){for(var b=0,c=this._aLayerList.length;c>b;b++)this._aLayerList[b].load(this._elContainer,b);for(var b=this._aLayerList.length-1;b>=0;b--)this._aLayerList[b].attachEvent()}this._sVisibilityChange?collie.util.addEventListener(document,this._sVisibilityChange,this._fOnChangeVisibility):this._htDeviceInfo.desktop||(collie.util.addEventListener(window,"pageshow",this._fOnPageShow),collie.util.addEventListener(window,"pagehide",this._fOnPageHide)),collie.util.addEventListener(window,"resize",this._fRefresh)},unload:function(){if(this._bLoaded){for(var a=0,b=this._aLayerList.length;b>a;a++)this._aLayerList[a].unload();this._elParent.removeChild(this._elContainer),this._elParent=null,this._bLoaded=!1,this._sVisibilityChange?collie.util.removeEventListener(document,this._sVisibilityChange,this._fOnChangeVisibility):this._htDeviceInfo.desktop||(collie.util.removeEventListener(window,"pageshow",this._fOnPageShow),collie.util.removeEventListener(window,"pagehide",this._fOnPageHide)),collie.util.removeEventListener(window,"resize",this._fRefresh)}},start:function(a,b){this._bPlaying||(a=a||this.DEFAULT_FPS,this._nDuration=/fps$/i.test(a)?1e3/parseInt(a,10):Math.max(16,a),this._fCallback=b||null,this._bPlaying=!0,this._nDuration<17?(this._sRequestAnimationFrameName=this._getNameAnimationFrame(),this._sCancelAnimationFrameName=this._getNameAnimationFrame(!0)):(this._sRequestAnimationFrameName=!1,this._sCancelAnimationFrameName=!1),this.fireEvent("start"),this._trigger(0))},_trigger:function(a){!this._sVisibilityChange&&this.USE_AUTO_PAUSE&&window.screenTop<-3e4&&this.pause(),a="undefined"==typeof a?0:parseInt(a,10),this._oRenderingTimer=this._sRequestAnimationFrameName!==!1&&!this.DEBUG_USE_DELAY&&this.USE_AUTO_PAUSE?window[this._sRequestAnimationFrameName](this._fRender):setTimeout(this._fRender,a)},_render:function(a,b){if(this._bPlaying||b){var c=this._getDate(),d=0,e=1;if(null!==this._nBeforeFrameTime){if(d=c-this._nBeforeFrameTime,e=a||Math.max(1,Math.round(d/this._nDuration)),d>this.DELAY_LIMIT)return this.pause(),void 0;this._sRequestAnimationFrameName!==!1&&this.USE_AUTO_PAUSE&&(a=0,e=1),this._nSkippedFrame+=Math.max(0,e-1),this._nFPS=Math.round(1e3/(c-this._nBeforeFrameTime))}this._nCurrentFrame+=e;var f=this.getInfo();if(null!==this._fCallback&&this._fCallback(f)===!1||this.fireEvent("process",f)===!1)this.stop();else{collie.Timer.run(this._nCurrentFrame,d),this._update(d);var g=0;this.DEBUG_USE_DELAY&&(g=Math.round(Math.random()*this.DEBUG_MAX_DELAY),this._nDebugDelayedTime+=g),this._nBeforeRenderingTime=this._getDate()-c,this._nBeforeFrameTime=c,this._bPlaying&&this._trigger(Math.max(0,this._nDuration-this._nBeforeRenderingTime+2*g))}}},draw:function(a){this._fRender(a,!0)},_getDate:function(){return+new Date+(this.DEBUG_USE_DELAY?this._nDebugDelayedTime:0)},stop:function(){this._bPlaying&&(this._bPlaying=!1,this._resetTimer(),this.fireEvent("stop",this.getInfo()),this._sRenderingMode=null,this._bUseRetinaDisplay=null,this._fCallback=null,this._nCurrentFrame=0,this._nBeforeRenderingTime=0,this._nSkippedFrame=0,this._nBeforeFrameTime=null)},_resetTimer:function(){null!==this._oRenderingTimer&&(this._sCancelAnimationFrameName!==!1?window[this._sCancelAnimationFrameName](this._oRenderingTimer):clearTimeout(this._oRenderingTimer),window.tempTimer=window.tempTimer||[],window.tempTimer.push(this._oRenderingTimer),this._oRenderingTimer=null)},pause:function(){this._bPlaying&&(this._bPlaying=!1,this._bPause=!0,this.fireEvent("pause",this.getInfo()),this._resetTimer())},resume:function(){this._bPause&&(this._nBeforeFrameTime=this._getDate(),this._nBeforeRenderingTime=0,this._bPlaying=!0,this._bPause=!1,this.fireEvent("resume",this.getInfo()),this._trigger(0))},isPlaying:function(){return this._bPlaying},_update:function(a){for(var b=0,c=this._aLayerList.length;c>b;b++)this._aLayerList[b].update(a)},setEventStatus:function(a,b){this._htEventStatus={type:a,firedOnTarget:b}},isStopEvent:function(a){return"click"===a&&(a="mouseup"),a===this._htEventStatus.type&&this._htEventStatus.firedOnTarget},getEventStatus:function(){return this._htEventStatus},setPreventDefault:function(a){this._bIsPreventDefault=!!a},isPreventDefault:function(){return this._bIsPreventDefault},resize:function(a,b,c){for(var d=0,e=this._aLayerList.length;e>d;d++)this._aLayerList[d].resize(a,b,c)}},collie.Component)),collie.Pool=collie.Class({$init:function(a,b,c){this._nSize=a||0,this._htDefaultOption=b,this._aPool=[],this._fClass=c||collie.DisplayObject,this._nLengthActiveObject=0,this._allocate()},_allocate:function(){var a=this._nLengthActiveObject+this._aPool.length;if(this._nSize&&a<this._nSize)for(var b=a;b<this._nSize;b++)this._aPool.push(new this._fClass(this._htDefaultOption))},changeSize:function(a){this._nSize=a,this._allocate()},getSize:function(){return this._nSize},changeOption:function(a){this._htDefaultOption=a},get:function(){if(!this._aPool.length)throw new Error("The Pool is empty");var a=this._aPool.pop();return this._nLengthActiveObject++,a},release:function(a){a.leave(),this._nLengthActiveObject--,this._aPool.push(a)}}),function(a){var b={};a.trafficCop=function(c,d){var e,f=c;if(2===arguments.length&&(f=a.extend(!0,d,{url:c})),e=JSON.stringify(f),e in b)for(i in{success:1,error:1,complete:1})b[e][i](f[i]);else b[e]=a.ajax(f).always(function(){delete b[e]});return b[e]}}(jQuery);var LSCP=window.LSCP||{};LSCP.randomFromInterval=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)};